<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="5 Stability of the Binomial Model | Topics in Empirical Finance" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/img/frontCover.pdf" />
<meta property="og:description" content="An open access textbook on empirical finance" />
<meta name="github-repo" content="phenaff/empirical-finance-2" />

<meta name="author" content="Patrick Hénaff" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="An open access textbook on empirical finance">

<title>5 Stability of the Binomial Model | Topics in Empirical Finance</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<!--
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@jweisber" />
<meta name="twitter:creator" content="@jweisber" />
<meta name="twitter:title" content="Odds &amp; Ends" />
<meta name="twitter:description" content="An open access textbook for introductory philosophy courses on probability and inductive logic." />
<meta name="twitter:image" content="img/social_image.png" />
-->


<!--
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["output/HTML-CSS"],
  "HTML-CSS": {
    availableFonts: ["Gyre-Pagella"],
    preferredFont: "Gyre-Pagella",
    webFont: "Gyre-Pagella",
    imageFont: "Gyre-Pagella"
  }
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
      extensions: ["color.js"]
    }
  });
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />
<link rel="stylesheet" href="custom.css" type="text/css" />

</head>

<body>


<div style="display: none;">
$$
  \newcommand{\given}{\mid}
  \renewcommand{\neg}{\mathbin{\sim}}
  \renewcommand{\wedge}{\mathbin{\&}}
  \newcommand{\p}{Pr}
  \newcommand{\degr}{^{\circ}}
  \newcommand{\E}{E}
  \newcommand{\EU}{EU}
  \newcommand{\u}{U}
  \newcommand{\pr}{Pr}
  \newcommand{\po}{Pr^*}
  \definecolor{bookred}{RGB}{228,6,19}
  \definecolor{bookblue}{RGB}{0,92,169}
  \definecolor{bookpurple}{RGB}{114,49,94} 
$$
</div>

<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#preface-to-the-second-edition">Preface to the second edition</a></li>
<li><a href="preface-to-the-first-edition.html#preface-to-the-first-edition">Preface to the first edition</a></li>
<li class="part"><span><b>Computational Framework</b></span></li>
<li class="has-sub"><a href="basic-components.html#basic-components"><span class="toc-section-number">1</span> Basic Components</a>
<ul>
<li class="has-sub"><a href="basic-components.html#the-class"><span class="toc-section-number">1.1</span> The Class</a>
<ul>
<li><a href="basic-components.html#illustration"><span class="toc-section-number">1.1.1</span> Illustration</a></li>
<li><a href="basic-components.html#design-and-implementation"><span class="toc-section-number">1.1.2</span> Design and Implementation</a></li>
</ul></li>
<li class="has-sub"><a href="basic-components.html#the-class-1"><span class="toc-section-number">1.2</span> The Class</a>
<ul>
<li><a href="basic-components.html#the-model-for-market-data"><span class="toc-section-number">1.2.1</span> The Model for Market Data</a></li>
<li><a href="basic-components.html#the-search-algorithm"><span class="toc-section-number">1.2.2</span> The Search Algorithm</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="sim-framework.html#sim-framework"><span class="toc-section-number">2</span> The Simulation Framework</a>
<ul>
<li><a href="sim-framework.html#scenario-simulator"><span class="toc-section-number">2.1</span> Scenario Simulator</a></li>
<li class="has-sub"><a href="sim-framework.html#a-delta-hedging-experiment"><span class="toc-section-number">2.2</span> A Delta Hedging Experiment</a>
<ul>
<li><a href="sim-framework.html#design-considerations"><span class="toc-section-number">2.2.1</span> Design Considerations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Discreet Models</b></span></li>
<li class="has-sub"><a href="arb-free-pricing.html#arb-free-pricing"><span class="toc-section-number">3</span> Arbitrage-Free Pricing and Risk Neutral Valuation</a>
<ul>
<li class="has-sub"><a href="arb-free-pricing.html#arbitrage-free-pricing"><span class="toc-section-number">3.1</span> Arbitrage-free Pricing</a>
<ul>
<li><a href="arb-free-pricing.html#arrow-debreu-securities"><span class="toc-section-number">3.1.1</span> Arrow-Debreu Securities</a></li>
<li><a href="arb-free-pricing.html#the-price-of-traded-securities"><span class="toc-section-number">3.1.2</span> The Price of Traded Securities</a></li>
<li><a href="arb-free-pricing.html#complete-market"><span class="toc-section-number">3.1.3</span> Complete Market</a></li>
<li><a href="arb-free-pricing.html#equivalent-probability-measures"><span class="toc-section-number">3.1.4</span> Equivalent Probability Measures</a></li>
<li><a href="arb-free-pricing.html#the-impact-of-interest-rate"><span class="toc-section-number">3.1.5</span> The Impact of Interest Rate</a></li>
<li><a href="arb-free-pricing.html#trading-strategy-and-dynamic-completeness"><span class="toc-section-number">3.1.6</span> Trading Strategy and Dynamic Completeness</a></li>
<li><a href="arb-free-pricing.html#discounted-asset-prices-as-martingales"><span class="toc-section-number">3.1.7</span> Discounted Asset Prices as Martingales</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="binomial.html#binomial"><span class="toc-section-number">4</span> Risk-Neutral Pricing in a Binomial Framework</a>
<ul>
<li class="has-sub"><a href="binomial.html#introduction"><span class="toc-section-number">4.1</span> Introduction</a>
<ul>
<li><a href="binomial.html#subsec:binomial"><span class="toc-section-number">4.1.1</span> The Binomial Model for Stocks</a></li>
</ul></li>
<li><a href="binomial.html#pricing-with-arrow-debreu-securities"><span class="toc-section-number">4.2</span> Pricing With Arrow-Debreu Securities</a></li>
<li><a href="binomial.html#multi-period-binomial-model"><span class="toc-section-number">4.3</span> Multi-Period Binomial Model</a></li>
<li><a href="binomial.html#american-exercise"><span class="toc-section-number">4.4</span> American Exercise</a></li>
<li class="has-sub"><a href="binomial.html#calibration-of-the-binomial-model"><span class="toc-section-number">4.5</span> Calibration of the Binomial Model</a>
<ul>
<li><a href="binomial.html#tree-geometry"><span class="toc-section-number">4.5.1</span> Tree Geometry</a></li>
</ul></li>
</ul></li>
<li><a href="stability-of-the-binomial-model.html#stability-of-the-binomial-model"><span class="toc-section-number">5</span> Stability of the Binomial Model</a></li>
<li class="has-sub"><a href="sec:trinomial.html#sec:trinomial"><span class="toc-section-number">6</span> Trinomial Models</a>
<ul>
<li><a href="sec:trinomial.html#the-trinomial-tree"><span class="toc-section-number">6.1</span> The Trinomial Tree</a></li>
</ul></li>
<li class="part"><span><b>Derivatives in the Black-Scholes Framework</b></span></li>
<li class="has-sub"><a href="pricing-with-black-scholes.html#pricing-with-black-scholes"><span class="toc-section-number">7</span> Pricing with Black-Scholes</a>
<ul>
<li><a href="pricing-with-black-scholes.html#relationships-among-greeks"><span class="toc-section-number">7.1</span> Relationships Among Greeks</a></li>
</ul></li>
<li class="has-sub"><a href="applicability-of-the-black-scholes-model.html#applicability-of-the-black-scholes-model"><span class="toc-section-number">8</span> Applicability of the Black-Scholes Model</a>
<ul>
<li><a href="applicability-of-the-black-scholes-model.html#self-financing-replicating-portfolio"><span class="toc-section-number">8.1</span> Self-Financing Replicating Portfolio</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#hedging-error-due-to-discrete-hedging"><span class="toc-section-number">8.2</span> Hedging Error due to Discrete Hedging</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#error-due-to-unknown-volatility"><span class="toc-section-number">8.3</span> Error due to Unknown Volatility</a></li>
<li class="has-sub"><a href="applicability-of-the-black-scholes-model.html#second-order-hedging"><span class="toc-section-number">8.4</span> Second-Order Hedging</a>
<ul>
<li><a href="applicability-of-the-black-scholes-model.html#gamma-smoothing"><span class="toc-section-number">8.4.1</span> Gamma Smoothing</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#dynamic-delta-gamma-hedge"><span class="toc-section-number">8.4.2</span> Dynamic Delta-Gamma hedge</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="price-and-greeks-in-the-black-scholes-model.html#price-and-greeks-in-the-black-scholes-model"><span class="toc-section-number">9</span> Price and Greeks in the Black-Scholes Model</a>
<ul>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#solving-the-pricing-equation"><span class="toc-section-number">9.1</span> Solving the Pricing Equation</a></li>
<li class="has-sub"><a href="price-and-greeks-in-the-black-scholes-model.html#an-option-dashboard"><span class="toc-section-number">9.2</span> An Option Dashboard</a>
<ul>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#vanilla-option"><span class="toc-section-number">9.2.1</span> Vanilla Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#binary-option"><span class="toc-section-number">9.2.2</span> Binary Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#barrier-option"><span class="toc-section-number">9.2.3</span> Barrier Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#asian-option"><span class="toc-section-number">9.2.4</span> Asian Option</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-with-the-black-scholes-model.html#dynamic-hedging-with-the-black-scholes-model"><span class="toc-section-number">10</span> Dynamic Hedging with the Black-Scholes Model</a>
<ul>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#self-financing-replicating-portfolio-1"><span class="toc-section-number">10.1</span> Self-Financing Replicating Portfolio</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#hedging-error-due-to-discrete-hedging-1"><span class="toc-section-number">10.2</span> Hedging Error due to Discrete Hedging</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#error-due-to-unknown-volatility-1"><span class="toc-section-number">10.3</span> Error due to Unknown Volatility</a></li>
<li class="has-sub"><a href="dynamic-hedging-with-the-black-scholes-model.html#second-order-hedging-1"><span class="toc-section-number">10.4</span> Second-Order Hedging</a>
<ul>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#gamma-smoothing-1"><span class="toc-section-number">10.4.1</span> Gamma Smoothing</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#dynamic-delta-gamma-hedge-1"><span class="toc-section-number">10.4.2</span> Dynamic Delta-Gamma hedge</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#dynamic-hedging-in-the-black-scholes-framework"><span class="toc-section-number">11</span> Dynamic Hedging in the Black-Scholes Framework</a>
<ul>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#self-financing-replicating-portfolio-2"><span class="toc-section-number">11.1</span> Self-Financing Replicating Portfolio</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#continuous-rebalancing"><span class="toc-section-number">11.1.1</span> Continuous rebalancing</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#discreet-rebalancing"><span class="toc-section-number">11.1.2</span> Discreet rebalancing</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#illustration-1"><span class="toc-section-number">11.1.3</span> Illustration</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#a-more-realistic-example"><span class="toc-section-number">11.1.4</span> A More Realistic Example</a></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-discrete-hedging-2"><span class="toc-section-number">11.2</span> Hedging Error due to Discrete Hedging</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#empirical-test"><span class="toc-section-number">11.2.1</span> Empirical Test</a></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-transaction-cost"><span class="toc-section-number">11.3</span> Hedging Error due to Transaction Cost</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#empirical-test-1"><span class="toc-section-number">11.3.1</span> Empirical Test</a></li>
</ul></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-unknown-volatility"><span class="toc-section-number">11.4</span> Hedging Error due to Unknown Volatility</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#conclusion"><span class="toc-section-number">11.5</span> Conclusion</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#second-order-hedging-2"><span class="toc-section-number">11.6</span> Second-Order Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="the-implied-volatility.html#the-implied-volatility"><span class="toc-section-number">12</span> The implied volatility</a>
<ul>
<li><a href="the-implied-volatility.html#market-data"><span class="toc-section-number">12.1</span> Market Data</a></li>
<li class="has-sub"><a href="the-implied-volatility.html#calculation-of-implied-volatility"><span class="toc-section-number">12.2</span> Calculation of implied volatility</a>
<ul>
<li><a href="the-implied-volatility.html#newtons-method"><span class="toc-section-number">12.2.1</span> Newton’s method</a></li>
<li><a href="the-implied-volatility.html#implied-volatility-by-newtons-method"><span class="toc-section-number">12.2.2</span> Implied Volatility by Newton’s Method</a></li>
<li><a href="the-implied-volatility.html#secant-method"><span class="toc-section-number">12.2.3</span> Secant Method</a></li>
<li><a href="the-implied-volatility.html#jaeckels-method"><span class="toc-section-number">12.2.4</span> Jaeckel’s method</a></li>
<li><a href="the-implied-volatility.html#normalized-call-price-as-a-function-of-sigma"><span class="toc-section-number">12.2.5</span> Normalized Call price as a function of <span class="math inline">\(\sigma\)</span></a></li>
<li><a href="the-implied-volatility.html#transformed-objective-function"><span class="toc-section-number">12.2.6</span> Transformed objective function</a></li>
<li><a href="the-implied-volatility.html#impact-of-dividends"><span class="toc-section-number">12.2.7</span> Impact of Dividends</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-pricing-and-hedging"><span class="toc-section-number">13</span> Vanna-Volga Pricing and Hedging</a>
<ul>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#principle"><span class="toc-section-number">13.1</span> Principle</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-dynamic-hedging"><span class="toc-section-number">13.1.1</span> Vanna-Volga Dynamic Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#implementation"><span class="toc-section-number">13.2</span> Implementation</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-dynamic-hedging-1"><span class="toc-section-number">13.2.1</span> Vanna-Volga Dynamic Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#illustrations"><span class="toc-section-number">13.3</span> Illustrations</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#volatility-interpolation"><span class="toc-section-number">13.3.1</span> Volatility Interpolation</a></li>
<li><a href="vanna-volga-pricing-and-hedging.html#pricing-a-binary-option"><span class="toc-section-number">13.3.2</span> Pricing a Binary Option</a></li>
</ul></li>
</ul></li>
<li><a href="bibliography.html#bibliography"><span class="toc-section-number">14</span> Bibliography</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="stability-of-the-binomial-model" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Stability of the Binomial Model</h1>
<p><span class="newthought">We</span> would like to verify the convergence of the Cox-Ross model to the
Black-Scholes price as the number of steps <span class="math inline">\(N\)</span> increases. This can be
investigated with the following script:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="stability-of-the-binomial-model.html#cb46-1" aria-hidden="true" tabindex="-1"></a>Strike <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb46-2"><a href="stability-of-the-binomial-model.html#cb46-2" aria-hidden="true" tabindex="-1"></a>Spot <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb46-3"><a href="stability-of-the-binomial-model.html#cb46-3" aria-hidden="true" tabindex="-1"></a>T1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span></span>
<span id="cb46-4"><a href="stability-of-the-binomial-model.html#cb46-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb46-5"><a href="stability-of-the-binomial-model.html#cb46-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb46-6"><a href="stability-of-the-binomial-model.html#cb46-6" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb46-7"><a href="stability-of-the-binomial-model.html#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="stability-of-the-binomial-model.html#cb46-8" aria-hidden="true" tabindex="-1"></a>NN <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">20</span>, <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb46-9"><a href="stability-of-the-binomial-model.html#cb46-9" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">length</span>(NN)</span>
<span id="cb46-10"><a href="stability-of-the-binomial-model.html#cb46-10" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> nb, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb46-11"><a href="stability-of-the-binomial-model.html#cb46-11" aria-hidden="true" tabindex="-1"></a>bs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb46-12"><a href="stability-of-the-binomial-model.html#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="stability-of-the-binomial-model.html#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The Black-Scholes price</span></span>
<span id="cb46-14"><a href="stability-of-the-binomial-model.html#cb46-14" aria-hidden="true" tabindex="-1"></a>bs[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">GBSOption</span>(<span class="at">TypeFlag =</span> <span class="st">&quot;c&quot;</span>, <span class="at">S =</span> Spot, <span class="at">X =</span> Strike,</span>
<span id="cb46-15"><a href="stability-of-the-binomial-model.html#cb46-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time =</span> T1, <span class="at">r =</span> r, <span class="at">b =</span> b, <span class="at">sigma =</span> sigma)<span class="sc">@</span>price</span>
<span id="cb46-16"><a href="stability-of-the-binomial-model.html#cb46-16" aria-hidden="true" tabindex="-1"></a>bs[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">GBSOption</span>(<span class="at">TypeFlag =</span> <span class="st">&quot;c&quot;</span>, <span class="at">S =</span> Spot, <span class="at">X =</span> Strike <span class="sc">+</span></span>
<span id="cb46-17"><a href="stability-of-the-binomial-model.html#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="dv">10</span>, <span class="at">Time =</span> T1, <span class="at">r =</span> r, <span class="at">b =</span> b, <span class="at">sigma =</span> sigma)<span class="sc">@</span>price</span>
<span id="cb46-18"><a href="stability-of-the-binomial-model.html#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="stability-of-the-binomial-model.html#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Binomial price, function of number of</span></span>
<span id="cb46-20"><a href="stability-of-the-binomial-model.html#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="co"># steps</span></span>
<span id="cb46-21"><a href="stability-of-the-binomial-model.html#cb46-21" aria-hidden="true" tabindex="-1"></a>res[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(NN, <span class="cf">function</span>(n) <span class="fu">CRRBinomialTreeOption</span>(<span class="at">TypeFlag =</span> <span class="st">&quot;ce&quot;</span>,</span>
<span id="cb46-22"><a href="stability-of-the-binomial-model.html#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">S =</span> Spot, <span class="at">X =</span> Strike, <span class="at">Time =</span> T1, <span class="at">r =</span> r, <span class="at">b =</span> b,</span>
<span id="cb46-23"><a href="stability-of-the-binomial-model.html#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma =</span> sigma, n)<span class="sc">@</span>price)</span>
<span id="cb46-24"><a href="stability-of-the-binomial-model.html#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="stability-of-the-binomial-model.html#cb46-25" aria-hidden="true" tabindex="-1"></a>res[, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(NN, <span class="cf">function</span>(n) <span class="fu">CRRBinomialTreeOption</span>(<span class="at">TypeFlag =</span> <span class="st">&quot;ce&quot;</span>,</span>
<span id="cb46-26"><a href="stability-of-the-binomial-model.html#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">S =</span> Spot, <span class="at">X =</span> Strike <span class="sc">+</span> <span class="dv">10</span>, <span class="at">Time =</span> T1, <span class="at">r =</span> r,</span>
<span id="cb46-27"><a href="stability-of-the-binomial-model.html#cb46-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">b =</span> b, <span class="at">sigma =</span> sigma, n)<span class="sc">@</span>price)</span></code></pre></div>
<p>A plot of the prices as a function of the number of steps
(Figure <span class="math display">\[fig:bin-conv\]</span>) shows an oscillating pattern:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="stability-of-the-binomial-model.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb47-2"><a href="stability-of-the-binomial-model.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(NN, res[, <span class="dv">1</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;ATM&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Number of steps&quot;</span>,</span>
<span id="cb47-3"><a href="stability-of-the-binomial-model.html#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;price&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(res[,</span>
<span id="cb47-4"><a href="stability-of-the-binomial-model.html#cb47-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>]), <span class="fu">max</span>(res[, <span class="dv">1</span>])))</span>
<span id="cb47-5"><a href="stability-of-the-binomial-model.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> bs[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb47-6"><a href="stability-of-the-binomial-model.html#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="stability-of-the-binomial-model.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(NN, res[, <span class="dv">2</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;OTM&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Number of steps&quot;</span>,</span>
<span id="cb47-8"><a href="stability-of-the-binomial-model.html#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;price&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(res[,</span>
<span id="cb47-9"><a href="stability-of-the-binomial-model.html#cb47-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>]), <span class="fu">max</span>(res[, <span class="dv">2</span>])))</span>
<span id="cb47-10"><a href="stability-of-the-binomial-model.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> bs[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb47-11"><a href="stability-of-the-binomial-model.html#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="203-Binomial2_files/figure-html/fig-bin-conv-a-1.png" width="576"  /></p>
<p>Other binomial algorithms, such as Tian’s, exhibit a similar pattern, as
evidenced in Figure <span class="math display">\[fig:bin-conv-2\]</span>. The horizontal line marks the
Black-Scholes price.</p>
<p><img src="203-Binomial2_files/figure-html/fig-bin-conv-2-a-1.png" width="576"  /></p>
<p>This sawtooth pattern is due to the position of the strike relative to
the sequence of nodes at expiry;
we describe below some computational strategies
for smoothing these oscillations and speeding up the convergence of
binomial trees. See
<span class="citation">Joshi (<label for="tufte-mn-4" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-4" class="margin-toggle">2007<span class="marginnote">Joshi, Mark S. 2007. <span>“<span class="nocase">The Convergence of Binomial Trees for Pricing the American Put</span>.”</span> <a href="ssrn.com/abstract=1030143" class="uri">ssrn.com/abstract=1030143</a>.</span>)</span> for an extensive survey of binomial models with
improved convergence properties.</p>
<p>Since the oscillations are caused by the variations in the relative
position of the strike with respect to nodes at expiry, a natural
strategy, introduced by <span class="citation">Leisen and Reimer (<label for="tufte-mn-5" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-5" class="margin-toggle">1996<span class="marginnote">Leisen, D P J, and M Reimer. 1996. <span>“<span class="nocase">Binomial Models for Option Valuation - Examining and Improving Convergence</span>.”</span> <em>Applied Mathematical Finance</em> 3: 319–46.</span>)</span>, is to construct the tree such that
the strike coincides with a node. This is achieved by setting
<span class="math display">\[\mu = \frac{1}{T} \log \left(\frac{K}{S_0} \right)\]</span></p>
<p>The resulting tree is centered on <span class="math inline">\(K\)</span> in log space. The pricing method
is implemented as follows:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="stability-of-the-binomial-model.html#cb48-1" aria-hidden="true" tabindex="-1"></a>CRRWithDrift <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">TypeFlag =</span> <span class="fu">c</span>(<span class="st">&quot;ce&quot;</span>, <span class="st">&quot;pe&quot;</span>,</span>
<span id="cb48-2"><a href="stability-of-the-binomial-model.html#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ca&quot;</span>, <span class="st">&quot;pa&quot;</span>), S, X, Time, r, mu, sigma, n) {</span>
<span id="cb48-3"><a href="stability-of-the-binomial-model.html#cb48-3" aria-hidden="true" tabindex="-1"></a>    TypeFlag <span class="ot">=</span> TypeFlag[<span class="dv">1</span>]</span>
<span id="cb48-4"><a href="stability-of-the-binomial-model.html#cb48-4" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb48-5"><a href="stability-of-the-binomial-model.html#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (TypeFlag <span class="sc">==</span> <span class="st">&quot;ce&quot;</span> <span class="sc">||</span> TypeFlag <span class="sc">==</span> <span class="st">&quot;ca&quot;</span>)</span>
<span id="cb48-6"><a href="stability-of-the-binomial-model.html#cb48-6" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">=</span> <span class="sc">+</span><span class="dv">1</span></span>
<span id="cb48-7"><a href="stability-of-the-binomial-model.html#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (TypeFlag <span class="sc">==</span> <span class="st">&quot;pe&quot;</span> <span class="sc">||</span> TypeFlag <span class="sc">==</span> <span class="st">&quot;pa&quot;</span>)</span>
<span id="cb48-8"><a href="stability-of-the-binomial-model.html#cb48-8" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb48-9"><a href="stability-of-the-binomial-model.html#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(z))</span>
<span id="cb48-10"><a href="stability-of-the-binomial-model.html#cb48-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;TypeFlag misspecified: ce|ca|pe|pa&quot;</span>)</span>
<span id="cb48-11"><a href="stability-of-the-binomial-model.html#cb48-11" aria-hidden="true" tabindex="-1"></a>    dt <span class="ot">=</span> Time<span class="sc">/</span>n</span>
<span id="cb48-12"><a href="stability-of-the-binomial-model.html#cb48-12" aria-hidden="true" tabindex="-1"></a>    u <span class="ot">=</span> <span class="fu">exp</span>(mu <span class="sc">*</span> dt <span class="sc">+</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(dt))</span>
<span id="cb48-13"><a href="stability-of-the-binomial-model.html#cb48-13" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">=</span> <span class="fu">exp</span>(mu <span class="sc">*</span> dt <span class="sc">-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(dt))</span>
<span id="cb48-14"><a href="stability-of-the-binomial-model.html#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="stability-of-the-binomial-model.html#cb48-15" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> (<span class="fu">exp</span>(r <span class="sc">*</span> dt) <span class="sc">-</span> d)<span class="sc">/</span>(u <span class="sc">-</span> d)</span>
<span id="cb48-16"><a href="stability-of-the-binomial-model.html#cb48-16" aria-hidden="true" tabindex="-1"></a>    Df <span class="ot">=</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt)</span>
<span id="cb48-17"><a href="stability-of-the-binomial-model.html#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="stability-of-the-binomial-model.html#cb48-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># underlying asset at step N-1</span></span>
<span id="cb48-19"><a href="stability-of-the-binomial-model.html#cb48-19" aria-hidden="true" tabindex="-1"></a>    ST <span class="ot">&lt;-</span> S <span class="sc">*</span> (d<span class="sc">^</span>(n <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">*</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>((u<span class="sc">/</span>d),</span>
<span id="cb48-20"><a href="stability-of-the-binomial-model.html#cb48-20" aria-hidden="true" tabindex="-1"></a>        n <span class="sc">-</span> <span class="dv">1</span>)))</span>
<span id="cb48-21"><a href="stability-of-the-binomial-model.html#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># at step (n-1), value an European</span></span>
<span id="cb48-22"><a href="stability-of-the-binomial-model.html#cb48-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># option of maturity dt</span></span>
<span id="cb48-23"><a href="stability-of-the-binomial-model.html#cb48-23" aria-hidden="true" tabindex="-1"></a>    BSTypeFlag <span class="ot">&lt;-</span> <span class="fu">substr</span>(TypeFlag, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb48-24"><a href="stability-of-the-binomial-model.html#cb48-24" aria-hidden="true" tabindex="-1"></a>    OptionValue <span class="ot">&lt;-</span> <span class="fu">GBSOption</span>(BSTypeFlag, ST, X,</span>
<span id="cb48-25"><a href="stability-of-the-binomial-model.html#cb48-25" aria-hidden="true" tabindex="-1"></a>        dt, r, b, sigma)<span class="sc">@</span>price</span>
<span id="cb48-26"><a href="stability-of-the-binomial-model.html#cb48-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-27"><a href="stability-of-the-binomial-model.html#cb48-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (TypeFlag <span class="sc">==</span> <span class="st">&quot;ce&quot;</span> <span class="sc">||</span> TypeFlag <span class="sc">==</span> <span class="st">&quot;pe&quot;</span>) {</span>
<span id="cb48-28"><a href="stability-of-the-binomial-model.html#cb48-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">from =</span> n <span class="sc">-</span> <span class="dv">2</span>, <span class="at">to =</span> <span class="dv">0</span>, <span class="at">by =</span> <span class="sc">-</span><span class="dv">1</span>)) OptionValue <span class="ot">&lt;-</span> (p <span class="sc">*</span></span>
<span id="cb48-29"><a href="stability-of-the-binomial-model.html#cb48-29" aria-hidden="true" tabindex="-1"></a>            OptionValue[<span class="dv">2</span><span class="sc">:</span>(j <span class="sc">+</span> <span class="dv">2</span>)] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span></span>
<span id="cb48-30"><a href="stability-of-the-binomial-model.html#cb48-30" aria-hidden="true" tabindex="-1"></a>            OptionValue[<span class="dv">1</span><span class="sc">:</span>(j <span class="sc">+</span> <span class="dv">1</span>)]) <span class="sc">*</span> Df</span>
<span id="cb48-31"><a href="stability-of-the-binomial-model.html#cb48-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-32"><a href="stability-of-the-binomial-model.html#cb48-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-33"><a href="stability-of-the-binomial-model.html#cb48-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (TypeFlag <span class="sc">==</span> <span class="st">&quot;ca&quot;</span> <span class="sc">||</span> TypeFlag <span class="sc">==</span> <span class="st">&quot;pa&quot;</span>) {</span>
<span id="cb48-34"><a href="stability-of-the-binomial-model.html#cb48-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">from =</span> n <span class="sc">-</span> <span class="dv">2</span>, <span class="at">to =</span> <span class="dv">0</span>, <span class="at">by =</span> <span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb48-35"><a href="stability-of-the-binomial-model.html#cb48-35" aria-hidden="true" tabindex="-1"></a>            ContValue <span class="ot">&lt;-</span> (p <span class="sc">*</span> OptionValue[<span class="dv">2</span><span class="sc">:</span>(j <span class="sc">+</span></span>
<span id="cb48-36"><a href="stability-of-the-binomial-model.html#cb48-36" aria-hidden="true" tabindex="-1"></a>                <span class="dv">2</span>)] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> OptionValue[<span class="dv">1</span><span class="sc">:</span>(j <span class="sc">+</span></span>
<span id="cb48-37"><a href="stability-of-the-binomial-model.html#cb48-37" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>)]) <span class="sc">*</span> Df</span>
<span id="cb48-38"><a href="stability-of-the-binomial-model.html#cb48-38" aria-hidden="true" tabindex="-1"></a>            ST <span class="ot">&lt;-</span> S <span class="sc">*</span> (d<span class="sc">^</span>j) <span class="sc">*</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>((u<span class="sc">/</span>d),</span>
<span id="cb48-39"><a href="stability-of-the-binomial-model.html#cb48-39" aria-hidden="true" tabindex="-1"></a>                j)))</span>
<span id="cb48-40"><a href="stability-of-the-binomial-model.html#cb48-40" aria-hidden="true" tabindex="-1"></a>            OptionValue <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>(j <span class="sc">+</span> <span class="dv">1</span>), <span class="cf">function</span>(i) <span class="fu">max</span>(ST[i] <span class="sc">-</span></span>
<span id="cb48-41"><a href="stability-of-the-binomial-model.html#cb48-41" aria-hidden="true" tabindex="-1"></a>                X, ContValue[i]))</span>
<span id="cb48-42"><a href="stability-of-the-binomial-model.html#cb48-42" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb48-43"><a href="stability-of-the-binomial-model.html#cb48-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-44"><a href="stability-of-the-binomial-model.html#cb48-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-45"><a href="stability-of-the-binomial-model.html#cb48-45" aria-hidden="true" tabindex="-1"></a>    OptionValue[<span class="dv">1</span>]</span>
<span id="cb48-46"><a href="stability-of-the-binomial-model.html#cb48-46" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Convergence of the model as <span class="math inline">\(N\)</span> increases is significantly improved, as
evidenced by the graphs in Figure <span class="math display">\[fig:CRRWithDrift\]</span>.</p>
<p><img src="203-Binomial2_files/figure-html/fig-crrwithdrift-1.png" width="576"  /></p>
<p>In the context of an American option, note that if the option has not
been exercised at step <span class="math inline">\(N-1\)</span>, the option is now European, and can be
priced at these nodes with the Black-Scholes model, rather than with the
backward recursion from step <span class="math inline">\(N\)</span> (the expiry date). This simple
modification smooths the option value at step <span class="math inline">\(N-1\)</span> and cancels the
oscillations, as illustrated in figure <span class="math display">\[fig:bin-conv-crr-bs\]</span>, but at
the price of a substantial increase in computation time.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="stability-of-the-binomial-model.html#cb49-1" aria-hidden="true" tabindex="-1"></a>CRRWithBS <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">TypeFlag =</span> <span class="fu">c</span>(<span class="st">&quot;ce&quot;</span>, <span class="st">&quot;pe&quot;</span>,</span>
<span id="cb49-2"><a href="stability-of-the-binomial-model.html#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ca&quot;</span>, <span class="st">&quot;pa&quot;</span>), S, X, Time, r, b, sigma, n) {</span>
<span id="cb49-3"><a href="stability-of-the-binomial-model.html#cb49-3" aria-hidden="true" tabindex="-1"></a>    TypeFlag <span class="ot">=</span> TypeFlag[<span class="dv">1</span>]</span>
<span id="cb49-4"><a href="stability-of-the-binomial-model.html#cb49-4" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb49-5"><a href="stability-of-the-binomial-model.html#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (TypeFlag <span class="sc">==</span> <span class="st">&quot;ce&quot;</span> <span class="sc">||</span> TypeFlag <span class="sc">==</span> <span class="st">&quot;ca&quot;</span>)</span>
<span id="cb49-6"><a href="stability-of-the-binomial-model.html#cb49-6" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">=</span> <span class="sc">+</span><span class="dv">1</span></span>
<span id="cb49-7"><a href="stability-of-the-binomial-model.html#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (TypeFlag <span class="sc">==</span> <span class="st">&quot;pe&quot;</span> <span class="sc">||</span> TypeFlag <span class="sc">==</span> <span class="st">&quot;pa&quot;</span>)</span>
<span id="cb49-8"><a href="stability-of-the-binomial-model.html#cb49-8" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb49-9"><a href="stability-of-the-binomial-model.html#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(z))</span>
<span id="cb49-10"><a href="stability-of-the-binomial-model.html#cb49-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;TypeFlag misspecified: ce|ca|pe|pa&quot;</span>)</span>
<span id="cb49-11"><a href="stability-of-the-binomial-model.html#cb49-11" aria-hidden="true" tabindex="-1"></a>    dt <span class="ot">=</span> Time<span class="sc">/</span>n</span>
<span id="cb49-12"><a href="stability-of-the-binomial-model.html#cb49-12" aria-hidden="true" tabindex="-1"></a>    u <span class="ot">=</span> <span class="fu">exp</span>(sigma <span class="sc">*</span> <span class="fu">sqrt</span>(dt))</span>
<span id="cb49-13"><a href="stability-of-the-binomial-model.html#cb49-13" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>u</span>
<span id="cb49-14"><a href="stability-of-the-binomial-model.html#cb49-14" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> (<span class="fu">exp</span>(b <span class="sc">*</span> dt) <span class="sc">-</span> d)<span class="sc">/</span>(u <span class="sc">-</span> d)</span>
<span id="cb49-15"><a href="stability-of-the-binomial-model.html#cb49-15" aria-hidden="true" tabindex="-1"></a>    Df <span class="ot">=</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> dt)</span>
<span id="cb49-16"><a href="stability-of-the-binomial-model.html#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="stability-of-the-binomial-model.html#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># underlying asset at step N-1</span></span>
<span id="cb49-18"><a href="stability-of-the-binomial-model.html#cb49-18" aria-hidden="true" tabindex="-1"></a>    ST <span class="ot">&lt;-</span> S <span class="sc">*</span> (d<span class="sc">^</span>(n <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">*</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>((u<span class="sc">/</span>d),</span>
<span id="cb49-19"><a href="stability-of-the-binomial-model.html#cb49-19" aria-hidden="true" tabindex="-1"></a>        n <span class="sc">-</span> <span class="dv">1</span>)))</span>
<span id="cb49-20"><a href="stability-of-the-binomial-model.html#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># at step (n-1), value an European</span></span>
<span id="cb49-21"><a href="stability-of-the-binomial-model.html#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># option of maturity dt</span></span>
<span id="cb49-22"><a href="stability-of-the-binomial-model.html#cb49-22" aria-hidden="true" tabindex="-1"></a>    BSTypeFlag <span class="ot">&lt;-</span> <span class="fu">substr</span>(TypeFlag, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb49-23"><a href="stability-of-the-binomial-model.html#cb49-23" aria-hidden="true" tabindex="-1"></a>    OptionValue <span class="ot">&lt;-</span> <span class="fu">GBSOption</span>(BSTypeFlag, ST, X,</span>
<span id="cb49-24"><a href="stability-of-the-binomial-model.html#cb49-24" aria-hidden="true" tabindex="-1"></a>        dt, r, b, sigma)<span class="sc">@</span>price</span>
<span id="cb49-25"><a href="stability-of-the-binomial-model.html#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="stability-of-the-binomial-model.html#cb49-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (TypeFlag <span class="sc">==</span> <span class="st">&quot;ce&quot;</span> <span class="sc">||</span> TypeFlag <span class="sc">==</span> <span class="st">&quot;pe&quot;</span>) {</span>
<span id="cb49-27"><a href="stability-of-the-binomial-model.html#cb49-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">from =</span> n <span class="sc">-</span> <span class="dv">2</span>, <span class="at">to =</span> <span class="dv">0</span>, <span class="at">by =</span> <span class="sc">-</span><span class="dv">1</span>)) OptionValue <span class="ot">&lt;-</span> (p <span class="sc">*</span></span>
<span id="cb49-28"><a href="stability-of-the-binomial-model.html#cb49-28" aria-hidden="true" tabindex="-1"></a>            OptionValue[<span class="dv">2</span><span class="sc">:</span>(j <span class="sc">+</span> <span class="dv">2</span>)] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span></span>
<span id="cb49-29"><a href="stability-of-the-binomial-model.html#cb49-29" aria-hidden="true" tabindex="-1"></a>            OptionValue[<span class="dv">1</span><span class="sc">:</span>(j <span class="sc">+</span> <span class="dv">1</span>)]) <span class="sc">*</span> Df</span>
<span id="cb49-30"><a href="stability-of-the-binomial-model.html#cb49-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb49-31"><a href="stability-of-the-binomial-model.html#cb49-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-32"><a href="stability-of-the-binomial-model.html#cb49-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (TypeFlag <span class="sc">==</span> <span class="st">&quot;ca&quot;</span> <span class="sc">||</span> TypeFlag <span class="sc">==</span> <span class="st">&quot;pa&quot;</span>) {</span>
<span id="cb49-33"><a href="stability-of-the-binomial-model.html#cb49-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">from =</span> n <span class="sc">-</span> <span class="dv">2</span>, <span class="at">to =</span> <span class="dv">0</span>, <span class="at">by =</span> <span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb49-34"><a href="stability-of-the-binomial-model.html#cb49-34" aria-hidden="true" tabindex="-1"></a>            ContValue <span class="ot">&lt;-</span> (p <span class="sc">*</span> OptionValue[<span class="dv">2</span><span class="sc">:</span>(j <span class="sc">+</span></span>
<span id="cb49-35"><a href="stability-of-the-binomial-model.html#cb49-35" aria-hidden="true" tabindex="-1"></a>                <span class="dv">2</span>)] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> OptionValue[<span class="dv">1</span><span class="sc">:</span>(j <span class="sc">+</span></span>
<span id="cb49-36"><a href="stability-of-the-binomial-model.html#cb49-36" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>)]) <span class="sc">*</span> Df</span>
<span id="cb49-37"><a href="stability-of-the-binomial-model.html#cb49-37" aria-hidden="true" tabindex="-1"></a>            ST <span class="ot">&lt;-</span> S <span class="sc">*</span> (d<span class="sc">^</span>j) <span class="sc">*</span> <span class="fu">cumprod</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>((u<span class="sc">/</span>d),</span>
<span id="cb49-38"><a href="stability-of-the-binomial-model.html#cb49-38" aria-hidden="true" tabindex="-1"></a>                j)))</span>
<span id="cb49-39"><a href="stability-of-the-binomial-model.html#cb49-39" aria-hidden="true" tabindex="-1"></a>            OptionValue <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>(j <span class="sc">+</span> <span class="dv">1</span>), <span class="cf">function</span>(i) <span class="fu">max</span>(ST[i] <span class="sc">-</span></span>
<span id="cb49-40"><a href="stability-of-the-binomial-model.html#cb49-40" aria-hidden="true" tabindex="-1"></a>                X, ContValue[i]))</span>
<span id="cb49-41"><a href="stability-of-the-binomial-model.html#cb49-41" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb49-42"><a href="stability-of-the-binomial-model.html#cb49-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb49-43"><a href="stability-of-the-binomial-model.html#cb49-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-44"><a href="stability-of-the-binomial-model.html#cb49-44" aria-hidden="true" tabindex="-1"></a>    OptionValue[<span class="dv">1</span>]</span>
<span id="cb49-45"><a href="stability-of-the-binomial-model.html#cb49-45" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="203-Binomial2_files/figure-html/fig-CRRWithBS-1.png" width="480"  /></p>

</div>
<p style="text-align: center;">
<a href="binomial.html"><button class="btn btn-default">Previous</button></a>
<a href="sec:trinomial.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
