<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="1 Basic Components | Topics in Empirical Finance" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/img/frontCover.pdf" />
<meta property="og:description" content="An open access textbook on empirical finance" />
<meta name="github-repo" content="phenaff/empirical-finance-2" />

<meta name="author" content="Patrick Hénaff" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="An open access textbook on empirical finance">

<title>1 Basic Components | Topics in Empirical Finance</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<!--
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@jweisber" />
<meta name="twitter:creator" content="@jweisber" />
<meta name="twitter:title" content="Odds &amp; Ends" />
<meta name="twitter:description" content="An open access textbook for introductory philosophy courses on probability and inductive logic." />
<meta name="twitter:image" content="img/social_image.png" />
-->


<!--
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["output/HTML-CSS"],
  "HTML-CSS": {
    availableFonts: ["Gyre-Pagella"],
    preferredFont: "Gyre-Pagella",
    webFont: "Gyre-Pagella",
    imageFont: "Gyre-Pagella"
  }
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
      extensions: ["color.js"]
    }
  });
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />
<link rel="stylesheet" href="custom.css" type="text/css" />

</head>

<body>


<div style="display: none;">
$$
  \newcommand{\given}{\mid}
  \renewcommand{\neg}{\mathbin{\sim}}
  \renewcommand{\wedge}{\mathbin{\&}}
  \newcommand{\p}{Pr}
  \newcommand{\degr}{^{\circ}}
  \newcommand{\E}{E}
  \newcommand{\EU}{EU}
  \newcommand{\u}{U}
  \newcommand{\pr}{Pr}
  \newcommand{\po}{Pr^*}
  \definecolor{bookred}{RGB}{228,6,19}
  \definecolor{bookblue}{RGB}{0,92,169}
  \definecolor{bookpurple}{RGB}{114,49,94} 
$$
</div>

<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#preface-to-the-second-edition">Preface to the second edition</a></li>
<li><a href="preface-to-the-first-edition.html#preface-to-the-first-edition">Preface to the first edition</a></li>
<li class="part"><span><b>Computational Framework</b></span></li>
<li class="has-sub"><a href="basic-components.html#basic-components"><span class="toc-section-number">1</span> Basic Components</a>
<ul>
<li class="has-sub"><a href="basic-components.html#the-class"><span class="toc-section-number">1.1</span> The Class</a>
<ul>
<li><a href="basic-components.html#illustration"><span class="toc-section-number">1.1.1</span> Illustration</a></li>
<li><a href="basic-components.html#design-and-implementation"><span class="toc-section-number">1.1.2</span> Design and Implementation</a></li>
</ul></li>
<li class="has-sub"><a href="basic-components.html#the-class-1"><span class="toc-section-number">1.2</span> The Class</a>
<ul>
<li><a href="basic-components.html#the-model-for-market-data"><span class="toc-section-number">1.2.1</span> The Model for Market Data</a></li>
<li><a href="basic-components.html#the-search-algorithm"><span class="toc-section-number">1.2.2</span> The Search Algorithm</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="sim-framework.html#sim-framework"><span class="toc-section-number">2</span> The Simulation Framework</a>
<ul>
<li><a href="sim-framework.html#scenario-simulator"><span class="toc-section-number">2.1</span> Scenario Simulator</a></li>
<li class="has-sub"><a href="sim-framework.html#a-delta-hedging-experiment"><span class="toc-section-number">2.2</span> A Delta Hedging Experiment</a>
<ul>
<li><a href="sim-framework.html#design-considerations"><span class="toc-section-number">2.2.1</span> Design Considerations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Discreet Models</b></span></li>
<li class="has-sub"><a href="arb-free-pricing.html#arb-free-pricing"><span class="toc-section-number">3</span> Arbitrage-Free Pricing and Risk Neutral Valuation</a>
<ul>
<li class="has-sub"><a href="arb-free-pricing.html#arbitrage-free-pricing"><span class="toc-section-number">3.1</span> Arbitrage-free Pricing</a>
<ul>
<li><a href="arb-free-pricing.html#arrow-debreu-securities"><span class="toc-section-number">3.1.1</span> Arrow-Debreu Securities</a></li>
<li><a href="arb-free-pricing.html#the-price-of-traded-securities"><span class="toc-section-number">3.1.2</span> The Price of Traded Securities</a></li>
<li><a href="arb-free-pricing.html#complete-market"><span class="toc-section-number">3.1.3</span> Complete Market</a></li>
<li><a href="arb-free-pricing.html#equivalent-probability-measures"><span class="toc-section-number">3.1.4</span> Equivalent Probability Measures</a></li>
<li><a href="arb-free-pricing.html#the-impact-of-interest-rate"><span class="toc-section-number">3.1.5</span> The Impact of Interest Rate</a></li>
<li><a href="arb-free-pricing.html#trading-strategy-and-dynamic-completeness"><span class="toc-section-number">3.1.6</span> Trading Strategy and Dynamic Completeness</a></li>
<li><a href="arb-free-pricing.html#discounted-asset-prices-as-martingales"><span class="toc-section-number">3.1.7</span> Discounted Asset Prices as Martingales</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="binomial.html#binomial"><span class="toc-section-number">4</span> Risk-Neutral Pricing in a Binomial Framework</a>
<ul>
<li class="has-sub"><a href="binomial.html#introduction"><span class="toc-section-number">4.1</span> Introduction</a>
<ul>
<li><a href="binomial.html#subsec:binomial"><span class="toc-section-number">4.1.1</span> The Binomial Model for Stocks</a></li>
</ul></li>
<li><a href="binomial.html#pricing-with-arrow-debreu-securities"><span class="toc-section-number">4.2</span> Pricing With Arrow-Debreu Securities</a></li>
<li><a href="binomial.html#multi-period-binomial-model"><span class="toc-section-number">4.3</span> Multi-Period Binomial Model</a></li>
<li><a href="binomial.html#american-exercise"><span class="toc-section-number">4.4</span> American Exercise</a></li>
<li class="has-sub"><a href="binomial.html#calibration-of-the-binomial-model"><span class="toc-section-number">4.5</span> Calibration of the Binomial Model</a>
<ul>
<li><a href="binomial.html#tree-geometry"><span class="toc-section-number">4.5.1</span> Tree Geometry</a></li>
</ul></li>
</ul></li>
<li><a href="stability-of-the-binomial-model.html#stability-of-the-binomial-model"><span class="toc-section-number">5</span> Stability of the Binomial Model</a></li>
<li class="has-sub"><a href="sec:trinomial.html#sec:trinomial"><span class="toc-section-number">6</span> Trinomial Models</a>
<ul>
<li><a href="sec:trinomial.html#the-trinomial-tree"><span class="toc-section-number">6.1</span> The Trinomial Tree</a></li>
</ul></li>
<li class="part"><span><b>Derivatives in the Black-Scholes Framework</b></span></li>
<li class="has-sub"><a href="pricing-with-black-scholes.html#pricing-with-black-scholes"><span class="toc-section-number">7</span> Pricing with Black-Scholes</a>
<ul>
<li><a href="pricing-with-black-scholes.html#relationships-among-greeks"><span class="toc-section-number">7.1</span> Relationships Among Greeks</a></li>
</ul></li>
<li class="has-sub"><a href="applicability-of-the-black-scholes-model.html#applicability-of-the-black-scholes-model"><span class="toc-section-number">8</span> Applicability of the Black-Scholes Model</a>
<ul>
<li><a href="applicability-of-the-black-scholes-model.html#self-financing-replicating-portfolio"><span class="toc-section-number">8.1</span> Self-Financing Replicating Portfolio</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#hedging-error-due-to-discrete-hedging"><span class="toc-section-number">8.2</span> Hedging Error due to Discrete Hedging</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#error-due-to-unknown-volatility"><span class="toc-section-number">8.3</span> Error due to Unknown Volatility</a></li>
<li class="has-sub"><a href="applicability-of-the-black-scholes-model.html#second-order-hedging"><span class="toc-section-number">8.4</span> Second-Order Hedging</a>
<ul>
<li><a href="applicability-of-the-black-scholes-model.html#gamma-smoothing"><span class="toc-section-number">8.4.1</span> Gamma Smoothing</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#dynamic-delta-gamma-hedge"><span class="toc-section-number">8.4.2</span> Dynamic Delta-Gamma hedge</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="price-and-greeks-in-the-black-scholes-model.html#price-and-greeks-in-the-black-scholes-model"><span class="toc-section-number">9</span> Price and Greeks in the Black-Scholes Model</a>
<ul>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#solving-the-pricing-equation"><span class="toc-section-number">9.1</span> Solving the Pricing Equation</a></li>
<li class="has-sub"><a href="price-and-greeks-in-the-black-scholes-model.html#an-option-dashboard"><span class="toc-section-number">9.2</span> An Option Dashboard</a>
<ul>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#vanilla-option"><span class="toc-section-number">9.2.1</span> Vanilla Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#binary-option"><span class="toc-section-number">9.2.2</span> Binary Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#barrier-option"><span class="toc-section-number">9.2.3</span> Barrier Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#asian-option"><span class="toc-section-number">9.2.4</span> Asian Option</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-with-the-black-scholes-model.html#dynamic-hedging-with-the-black-scholes-model"><span class="toc-section-number">10</span> Dynamic Hedging with the Black-Scholes Model</a>
<ul>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#self-financing-replicating-portfolio-1"><span class="toc-section-number">10.1</span> Self-Financing Replicating Portfolio</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#hedging-error-due-to-discrete-hedging-1"><span class="toc-section-number">10.2</span> Hedging Error due to Discrete Hedging</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#error-due-to-unknown-volatility-1"><span class="toc-section-number">10.3</span> Error due to Unknown Volatility</a></li>
<li class="has-sub"><a href="dynamic-hedging-with-the-black-scholes-model.html#second-order-hedging-1"><span class="toc-section-number">10.4</span> Second-Order Hedging</a>
<ul>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#gamma-smoothing-1"><span class="toc-section-number">10.4.1</span> Gamma Smoothing</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#dynamic-delta-gamma-hedge-1"><span class="toc-section-number">10.4.2</span> Dynamic Delta-Gamma hedge</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#dynamic-hedging-in-the-black-scholes-framework"><span class="toc-section-number">11</span> Dynamic Hedging in the Black-Scholes Framework</a>
<ul>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#self-financing-replicating-portfolio-2"><span class="toc-section-number">11.1</span> Self-Financing Replicating Portfolio</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#continuous-rebalancing"><span class="toc-section-number">11.1.1</span> Continuous rebalancing</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#discreet-rebalancing"><span class="toc-section-number">11.1.2</span> Discreet rebalancing</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#illustration-1"><span class="toc-section-number">11.1.3</span> Illustration</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#a-more-realistic-example"><span class="toc-section-number">11.1.4</span> A More Realistic Example</a></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-discrete-hedging-2"><span class="toc-section-number">11.2</span> Hedging Error due to Discrete Hedging</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#empirical-test"><span class="toc-section-number">11.2.1</span> Empirical Test</a></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-transaction-cost"><span class="toc-section-number">11.3</span> Hedging Error due to Transaction Cost</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#empirical-test-1"><span class="toc-section-number">11.3.1</span> Empirical Test</a></li>
</ul></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-unknown-volatility"><span class="toc-section-number">11.4</span> Hedging Error due to Unknown Volatility</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#conclusion"><span class="toc-section-number">11.5</span> Conclusion</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#second-order-hedging-2"><span class="toc-section-number">11.6</span> Second-Order Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="the-implied-volatility.html#the-implied-volatility"><span class="toc-section-number">12</span> The implied volatility</a>
<ul>
<li><a href="the-implied-volatility.html#market-data"><span class="toc-section-number">12.1</span> Market Data</a></li>
<li class="has-sub"><a href="the-implied-volatility.html#calculation-of-implied-volatility"><span class="toc-section-number">12.2</span> Calculation of implied volatility</a>
<ul>
<li><a href="the-implied-volatility.html#newtons-method"><span class="toc-section-number">12.2.1</span> Newton’s method</a></li>
<li><a href="the-implied-volatility.html#implied-volatility-by-newtons-method"><span class="toc-section-number">12.2.2</span> Implied Volatility by Newton’s Method</a></li>
<li><a href="the-implied-volatility.html#secant-method"><span class="toc-section-number">12.2.3</span> Secant Method</a></li>
<li><a href="the-implied-volatility.html#jaeckels-method"><span class="toc-section-number">12.2.4</span> Jaeckel’s method</a></li>
<li><a href="the-implied-volatility.html#normalized-call-price-as-a-function-of-sigma"><span class="toc-section-number">12.2.5</span> Normalized Call price as a function of <span class="math inline">\(\sigma\)</span></a></li>
<li><a href="the-implied-volatility.html#transformed-objective-function"><span class="toc-section-number">12.2.6</span> Transformed objective function</a></li>
<li><a href="the-implied-volatility.html#impact-of-dividends"><span class="toc-section-number">12.2.7</span> Impact of Dividends</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-pricing-and-hedging"><span class="toc-section-number">13</span> Vanna-Volga Pricing and Hedging</a>
<ul>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#principle"><span class="toc-section-number">13.1</span> Principle</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-dynamic-hedging"><span class="toc-section-number">13.1.1</span> Vanna-Volga Dynamic Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#implementation"><span class="toc-section-number">13.2</span> Implementation</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-dynamic-hedging-1"><span class="toc-section-number">13.2.1</span> Vanna-Volga Dynamic Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#illustrations"><span class="toc-section-number">13.3</span> Illustrations</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#volatility-interpolation"><span class="toc-section-number">13.3.1</span> Volatility Interpolation</a></li>
<li><a href="vanna-volga-pricing-and-hedging.html#pricing-a-binary-option"><span class="toc-section-number">13.3.2</span> Pricing a Binary Option</a></li>
</ul></li>
</ul></li>
<li><a href="bibliography.html#bibliography"><span class="toc-section-number">14</span> Bibliography</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="basic-components" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Basic Components</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="basic-components.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fOptions)</span>
<span id="cb1-2"><a href="basic-components.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fExoticOptions)</span>
<span id="cb1-3"><a href="basic-components.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fInstrument)</span>
<span id="cb1-4"><a href="basic-components.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DynamicSimulation)</span>
<span id="cb1-5"><a href="basic-components.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(empfin)</span>
<span id="cb1-6"><a href="basic-components.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code></pre></div>
<p><code>{r tufte::newthought("This")}</code> chapter provides a tutorial and explains the design of the object framework that has been build on top of the Rmetrics library.
As mentioned earlier, this layer is meant to hide
most of the implementation details, and allows us to focus on the key features of the
financial instruments and models.</p>
<p>The reader is encouraged to work through the examples, but the sections on design and implementation can be skipped.</p>
<p>The object framework involves two main entities:</p>
<ul>
<li>the class models an abstract financial instrument, and exposes
generic methods for computing the net present value (NPV) and the risk
indicators (the ``greeks’’). With this class, one can perform calculations on portfolio of instruments, without being concerned about the implementation details specific to each type of asset. This will be illustrated below with the detailed description of a delta-hedging algorithm.</li>
<li>the class is a container for market data, derived from the built-in . It greatly simplifies the signature of pricing functions. Instead of passing as arguments all the necessary market data, we simply pass one argument. The pricing methods fetch the necessary data from the , as needed.</li>
</ul>
<p>Each entity is now described and illustrated.</p>
<div id="the-class" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> The Class</h2>
<p>As mentioned, the purpose of the class is to create a layer of abstraction over the large variety of pricing models found in Rmetrics. With this class, we can express calculation algorithms in a generic manner. This is best explained by an example.</p>
<div id="illustration" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Illustration</h3>
<p>Consider a portfolio made of two options, a vanilla European call and a binary (cash-or-nothing) option, both written on the same underlying asset. We would like to compute the NPV and delta of this portfolio. Let’s contrast the process, first performed with the Rmetrics functions, and then with the class.</p>
<p>Starting with the Rmetrics functions, you first compute the price and delta of the European call:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="basic-components.html#cb2-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">2</span>)</span>
<span id="cb2-2"><a href="basic-components.html#cb2-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="basic-components.html#cb3-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">2</span>)</span>
<span id="cb3-2"><a href="basic-components.html#cb3-2" aria-hidden="true" tabindex="-1"></a>cp <span class="ot">&lt;-</span> <span class="st">&quot;c&quot;</span></span>
<span id="cb3-3"><a href="basic-components.html#cb3-3" aria-hidden="true" tabindex="-1"></a>Spot <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb3-4"><a href="basic-components.html#cb3-4" aria-hidden="true" tabindex="-1"></a>Strike <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb3-5"><a href="basic-components.html#cb3-5" aria-hidden="true" tabindex="-1"></a>Ttm <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-6"><a href="basic-components.html#cb3-6" aria-hidden="true" tabindex="-1"></a>int.rate <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb3-7"><a href="basic-components.html#cb3-7" aria-hidden="true" tabindex="-1"></a>div.yield <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb3-8"><a href="basic-components.html#cb3-8" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb3-9"><a href="basic-components.html#cb3-9" aria-hidden="true" tabindex="-1"></a>p[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">GBSOption</span>(<span class="at">TypeFlag =</span> cp, <span class="at">S =</span> Spot, <span class="at">X =</span> Strike,</span>
<span id="cb3-10"><a href="basic-components.html#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time =</span> Ttm, <span class="at">r =</span> int.rate, <span class="at">b =</span> int.rate <span class="sc">-</span> div.yield,</span>
<span id="cb3-11"><a href="basic-components.html#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma =</span> sigma)<span class="sc">@</span>price</span>
<span id="cb3-12"><a href="basic-components.html#cb3-12" aria-hidden="true" tabindex="-1"></a>d[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">GBSGreeks</span>(<span class="at">Selection =</span> <span class="st">&quot;delta&quot;</span>, <span class="at">TypeFlag =</span> cp,</span>
<span id="cb3-13"><a href="basic-components.html#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">S =</span> Spot, <span class="at">X =</span> Strike, <span class="at">Time =</span> Ttm, <span class="at">r =</span> int.rate,</span>
<span id="cb3-14"><a href="basic-components.html#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">b =</span> int.rate <span class="sc">-</span> div.yield, <span class="at">sigma =</span> sigma)</span></code></pre></div>
<p>Perform the same calculation for the binary option. The delta is computed
by finite difference.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="basic-components.html#cb4-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">2</span>)</span>
<span id="cb4-2"><a href="basic-components.html#cb4-2" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-3"><a href="basic-components.html#cb4-3" aria-hidden="true" tabindex="-1"></a>p[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">CashOrNothingOption</span>(<span class="at">TypeFlag =</span> cp, <span class="at">S =</span> Spot,</span>
<span id="cb4-4"><a href="basic-components.html#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> Strike, <span class="at">K =</span> K, <span class="at">Time =</span> Ttm, <span class="at">r =</span> int.rate, <span class="at">b =</span> int.rate <span class="sc">-</span></span>
<span id="cb4-5"><a href="basic-components.html#cb4-5" aria-hidden="true" tabindex="-1"></a>        div.yield, <span class="at">sigma =</span> sigma)<span class="sc">@</span>price</span>
<span id="cb4-6"><a href="basic-components.html#cb4-6" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> Spot <span class="sc">*</span> <span class="fl">0.001</span></span>
<span id="cb4-7"><a href="basic-components.html#cb4-7" aria-hidden="true" tabindex="-1"></a>dh <span class="ot">&lt;-</span> <span class="fu">CashOrNothingOption</span>(<span class="at">TypeFlag =</span> cp, <span class="at">S =</span> <span class="fu">c</span>(Spot <span class="sc">+</span></span>
<span id="cb4-8"><a href="basic-components.html#cb4-8" aria-hidden="true" tabindex="-1"></a>    h, Spot <span class="sc">-</span> h), <span class="at">X =</span> Strike, <span class="at">K =</span> K, <span class="at">Time =</span> Ttm, <span class="at">r =</span> int.rate,</span>
<span id="cb4-9"><a href="basic-components.html#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">b =</span> int.rate <span class="sc">-</span> div.yield, <span class="at">sigma =</span> sigma)<span class="sc">@</span>price</span>
<span id="cb4-10"><a href="basic-components.html#cb4-10" aria-hidden="true" tabindex="-1"></a>d[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">diff</span>(dh)<span class="sc">/</span>(<span class="dv">2</span> <span class="sc">*</span> h)</span></code></pre></div>
<p>Finally, sum both vectors to get the portfolio NPV and delta.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="basic-components.html#cb5-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">2</span>)</span>
<span id="cb5-2"><a href="basic-components.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Price:&quot;</span>, <span class="fu">round</span>(<span class="fu">sum</span>(p), <span class="dv">2</span>), <span class="st">&quot;Delta:&quot;</span>, <span class="fu">round</span>(<span class="fu">sum</span>(d),</span>
<span id="cb5-3"><a href="basic-components.html#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;Price: 0 Delta: 0.536&quot;</code></pre>
<p>With the class, the calculation steps are quite different.</p>
<p>You first create a vanilla instrument with the function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="basic-components.html#cb7-1" aria-hidden="true" tabindex="-1"></a>dtExpiry <span class="ot">&lt;-</span> <span class="fu">myDate</span>(<span class="st">&quot;01jan2011&quot;</span>)</span>
<span id="cb7-2"><a href="basic-components.html#cb7-2" aria-hidden="true" tabindex="-1"></a>underlying <span class="ot">&lt;-</span> <span class="st">&quot;IBM&quot;</span></span>
<span id="cb7-3"><a href="basic-components.html#cb7-3" aria-hidden="true" tabindex="-1"></a>Strike <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb7-4"><a href="basic-components.html#cb7-4" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-5"><a href="basic-components.html#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="basic-components.html#cb7-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">fInstrumentFactory</span>(<span class="st">&quot;vanilla&quot;</span>, <span class="at">quantity =</span> <span class="dv">1</span>, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">cp =</span> <span class="st">&quot;c&quot;</span>,</span>
<span id="cb7-7"><a href="basic-components.html#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">strike =</span> Strike, <span class="at">dtExpiry =</span> dtExpiry, <span class="at">underlying =</span> underlying,</span>
<span id="cb7-8"><a href="basic-components.html#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">discountRef =</span> <span class="st">&quot;USD.LIBOR&quot;</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<p>Next, use again the to create the binary option:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="basic-components.html#cb8-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">fInstrumentFactory</span>(<span class="st">&quot;binary&quot;</span>, <span class="at">quantity =</span> <span class="dv">1</span>, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">cp =</span> <span class="st">&quot;c&quot;</span>,</span>
<span id="cb8-2"><a href="basic-components.html#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">strike =</span> Strike, <span class="at">dtExpiry =</span> dtExpiry, <span class="at">K =</span> K, <span class="at">underlying =</span> underlying,</span>
<span id="cb8-3"><a href="basic-components.html#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">discountRef =</span> <span class="st">&quot;USD.LIBOR&quot;</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<p>Insert the relevant market data into a (this will be explained in the next section):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="basic-components.html#cb9-1" aria-hidden="true" tabindex="-1"></a>base.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>()</span>
<span id="cb9-2"><a href="basic-components.html#cb9-2" aria-hidden="true" tabindex="-1"></a>dtCalc <span class="ot">&lt;-</span> <span class="fu">myDate</span>(<span class="st">&quot;01jan2010&quot;</span>)</span>
<span id="cb9-3"><a href="basic-components.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;Price&quot;</span>, dtCalc, <span class="dv">100</span>)</span>
<span id="cb9-4"><a href="basic-components.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;DivYield&quot;</span>, dtCalc, div.yield)</span>
<span id="cb9-5"><a href="basic-components.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;ATMVol&quot;</span>, dtCalc, sigma)</span>
<span id="cb9-6"><a href="basic-components.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, <span class="st">&quot;USD.LIBOR&quot;</span>, <span class="st">&quot;Yield&quot;</span>, dtCalc, int.rate)</span></code></pre></div>
<p>Construct a portfolio, as a list of objects:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="basic-components.html#cb10-1" aria-hidden="true" tabindex="-1"></a>portfolio <span class="ot">=</span> <span class="fu">c</span>(v, b)</span></code></pre></div>
<p>and finally compute the price and delta of the portfolio:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="basic-components.html#cb11-1" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(portfolio, <span class="cf">function</span>(a) <span class="fu">getValue</span>(a,</span>
<span id="cb11-2"><a href="basic-components.html#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Price&quot;</span>, dtCalc, base.env)))</span>
<span id="cb11-3"><a href="basic-components.html#cb11-3" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(portfolio, <span class="cf">function</span>(a) <span class="fu">getValue</span>(a,</span>
<span id="cb11-4"><a href="basic-components.html#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Delta&quot;</span>, dtCalc, base.env)))</span>
<span id="cb11-5"><a href="basic-components.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Price:&quot;</span>, <span class="fu">round</span>(price, <span class="dv">2</span>), <span class="st">&quot;Delta:&quot;</span>, <span class="fu">round</span>(delta,</span>
<span id="cb11-6"><a href="basic-components.html#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;Price: 13.31 Delta: 0.599&quot;</code></pre>
</div>
<div id="design-and-implementation" class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Design and Implementation</h3>
objects are instantiated by the class
method, which takes as argument:
<p>The method is simply a switch that delegates the
object instantiation the the concrete subclasses of . The following code fragment is extracted from the file in package :</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="basic-components.html#cb13-1" aria-hidden="true" tabindex="-1"></a>fInstrumentFactory <span class="ot">&lt;-</span> <span class="cf">function</span>(type, quantity, params) {</span>
<span id="cb13-2"><a href="basic-components.html#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span>(<span class="fu">toupper</span>(type), <span class="at">VANILLA =</span> <span class="fu">Vanilla</span>(quantity,</span>
<span id="cb13-3"><a href="basic-components.html#cb13-3" aria-hidden="true" tabindex="-1"></a>        params), <span class="at">BINARY =</span> <span class="fu">Binary</span>(quantity, params),</span>
<span id="cb13-4"><a href="basic-components.html#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ASIAN =</span> <span class="fu">Asian</span>(quantity, params), <span class="at">STANDARDBARRIER =</span> <span class="fu">StandardBarrier</span>(quantity,</span>
<span id="cb13-5"><a href="basic-components.html#cb13-5" aria-hidden="true" tabindex="-1"></a>            params))</span>
<span id="cb13-6"><a href="basic-components.html#cb13-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
There is only one method defined on objects. This method is , and takes as argument:
<p>Again, this method simply delegates to the concrete classes the requested calculation:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="basic-components.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="at">f =</span> <span class="st">&quot;getValue&quot;</span>, <span class="at">signature =</span> <span class="fu">signature</span>(<span class="st">&quot;fInstrument&quot;</span>),</span>
<span id="cb14-2"><a href="basic-components.html#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">definition =</span> <span class="cf">function</span>(object, selection, dtCalc,</span>
<span id="cb14-3"><a href="basic-components.html#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">env =</span> <span class="cn">NULL</span>) {</span>
<span id="cb14-4"><a href="basic-components.html#cb14-4" aria-hidden="true" tabindex="-1"></a>        res <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-5"><a href="basic-components.html#cb14-5" aria-hidden="true" tabindex="-1"></a>        res <span class="ot">&lt;-</span> <span class="cf">switch</span>(<span class="fu">toupper</span>(selection), <span class="at">PRICE =</span> object<span class="sc">@</span><span class="fu">p</span>(dtCalc,</span>
<span id="cb14-6"><a href="basic-components.html#cb14-6" aria-hidden="true" tabindex="-1"></a>            env), <span class="at">DELTA =</span> object<span class="sc">@</span><span class="fu">d</span>(dtCalc, env), <span class="at">GAMMA =</span> object<span class="sc">@</span><span class="fu">g</span>(dtCalc,</span>
<span id="cb14-7"><a href="basic-components.html#cb14-7" aria-hidden="true" tabindex="-1"></a>            env), <span class="at">VEGA =</span> object<span class="sc">@</span><span class="fu">v</span>(dtCalc, env))</span>
<span id="cb14-8"><a href="basic-components.html#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(res <span class="sc">*</span> object<span class="sc">@</span>quantity)</span>
<span id="cb14-9"><a href="basic-components.html#cb14-9" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>As an illustration, the price calculation for vanilla options is implemented as follows in
:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="basic-components.html#cb15-1" aria-hidden="true" tabindex="-1"></a>getP <span class="ot">&lt;-</span> <span class="cf">function</span>(dtCalc, env) {</span>
<span id="cb15-2"><a href="basic-components.html#cb15-2" aria-hidden="true" tabindex="-1"></a>    Spot <span class="ot">&lt;-</span> <span class="fu">getData</span>(env, Underlying, <span class="st">&quot;Price&quot;</span>, dtCalc)</span>
<span id="cb15-3"><a href="basic-components.html#cb15-3" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">getData</span>(env, Underlying, <span class="st">&quot;ATMVol&quot;</span>, dtCalc)</span>
<span id="cb15-4"><a href="basic-components.html#cb15-4" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">getData</span>(env, df, <span class="st">&quot;Yield&quot;</span>, dtCalc)</span>
<span id="cb15-5"><a href="basic-components.html#cb15-5" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> <span class="fu">getData</span>(env, Underlying, <span class="st">&quot;DivYield&quot;</span>, dtCalc)</span>
<span id="cb15-6"><a href="basic-components.html#cb15-6" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> <span class="fu">tDiff</span>(dtCalc, dtExpiry)</span>
<span id="cb15-7"><a href="basic-components.html#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trace) {</span>
<span id="cb15-8"><a href="basic-components.html#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Calling GBSOption with Spot=&quot;</span>,</span>
<span id="cb15-9"><a href="basic-components.html#cb15-9" aria-hidden="true" tabindex="-1"></a>            Spot, <span class="st">&quot;Strike=&quot;</span>, Strike, <span class="st">&quot;t=&quot;</span>, t, <span class="st">&quot;r=&quot;</span>,</span>
<span id="cb15-10"><a href="basic-components.html#cb15-10" aria-hidden="true" tabindex="-1"></a>            r, <span class="st">&quot;b=&quot;</span>, b, <span class="st">&quot;sigma=&quot;</span>, s))</span>
<span id="cb15-11"><a href="basic-components.html#cb15-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-12"><a href="basic-components.html#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">GBSOption</span>(<span class="at">TypeFlag =</span> cp, <span class="at">S =</span> Spot, <span class="at">X =</span> Strike,</span>
<span id="cb15-13"><a href="basic-components.html#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">Time =</span> t, <span class="at">r =</span> r, <span class="at">b =</span> b, <span class="at">sigma =</span> s)<span class="sc">@</span>price</span>
<span id="cb15-14"><a href="basic-components.html#cb15-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The actual calculation being performed by the Rmetrics function. The model can be easily extended to accommodate other instruments.</p>
</div>
</div>
<div id="the-class-1" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> The Class</h2>
<p>The class is a container of market data, from which the pricing algorithm will fetch the necessary market information, as illustrated in the code fragment above.
We first describe the representation of market data, then the algorithm for searching data in a .</p>
<div id="the-model-for-market-data" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> The Model for Market Data</h3>
<p>The model for market data is strongly inspired by M. Folwer <span class="citation">(<label for="tufte-mn-1" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-1" class="margin-toggle">1996<span class="marginnote">Fowler, Martin. 1996. <em><span>Analysis Patterns: Reusable Object Models</span></em>. Addison-Wesley.</span>)</span>. To summarize, a piece of market data is modeled as an observed phenomenon on a financial instrument. Therefore, every market data item is identified by three attributes:</p>
<ul>
<li>the financial instrument being observed (e.g. a stock)</li>
<li>item the observed phenomenon (e.g. the implied volatility, or the price)</li>
<li>the observation date</li>
</ul>
<p>In order to optimize storage, the data is stored in a hash table. The first two attributes are combined to created the key, and the data for all observation dates is stored as a time series, with one column for actual data, and many additional columns when performing a simulation.</p>
</div>
<div id="the-search-algorithm" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> The Search Algorithm</h3>
<p>The inherits from the built-in class. In particular, it inherits the parent/child relationship: if a has a parent, the data not found in the child environment is fetched from the parent, if possible, or from the grand-parent, and so forth.</p>
<p>This is useful when performing a scenario analysis where only a few variables are modified: The data held constant is stored in the parent scenario, and the modified data is stored in the child scenario which is passed as argument. This scheme is illustrated by the following example.</p>
<p>Let’s define a vanilla option:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="basic-components.html#cb16-1" aria-hidden="true" tabindex="-1"></a>dtExpiry <span class="ot">&lt;-</span> <span class="fu">myDate</span>(<span class="st">&quot;01jan2011&quot;</span>)</span>
<span id="cb16-2"><a href="basic-components.html#cb16-2" aria-hidden="true" tabindex="-1"></a>underlying <span class="ot">&lt;-</span> <span class="st">&quot;IBM&quot;</span></span>
<span id="cb16-3"><a href="basic-components.html#cb16-3" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb16-4"><a href="basic-components.html#cb16-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">fInstrumentFactory</span>(<span class="st">&quot;vanilla&quot;</span>, <span class="at">quantity =</span> <span class="dv">1</span>,</span>
<span id="cb16-5"><a href="basic-components.html#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">cp =</span> <span class="st">&quot;c&quot;</span>, <span class="at">strike =</span> K, <span class="at">dtExpiry =</span> dtExpiry,</span>
<span id="cb16-6"><a href="basic-components.html#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">underlying =</span> underlying, <span class="at">discountRef =</span> <span class="st">&quot;USD.LIBOR&quot;</span>,</span>
<span id="cb16-7"><a href="basic-components.html#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">trace =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<p>and populate a DataProvider with the necessary market data:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="basic-components.html#cb17-1" aria-hidden="true" tabindex="-1"></a>base.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>()</span>
<span id="cb17-2"><a href="basic-components.html#cb17-2" aria-hidden="true" tabindex="-1"></a>dtCalc <span class="ot">&lt;-</span> <span class="fu">myDate</span>(<span class="st">&quot;01jan2010&quot;</span>)</span>
<span id="cb17-3"><a href="basic-components.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="basic-components.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;Price&quot;</span>, dtCalc, <span class="dv">100</span>)</span>
<span id="cb17-5"><a href="basic-components.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;DivYield&quot;</span>, dtCalc, <span class="fl">0.02</span>)</span>
<span id="cb17-6"><a href="basic-components.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;ATMVol&quot;</span>, dtCalc, <span class="fl">0.3</span>)</span>
<span id="cb17-7"><a href="basic-components.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, <span class="st">&quot;USD.LIBOR&quot;</span>, <span class="st">&quot;Yield&quot;</span>, dtCalc, <span class="fl">0.02</span>)</span></code></pre></div>
<p>The NPV of the derivative is obtained by:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="basic-components.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getValue</span>(a, <span class="st">&quot;Price&quot;</span>, dtCalc, base.env)</span>
<span id="cb18-2"><a href="basic-components.html#cb18-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">12.82158</span></span></code></pre></div>
<p>Next, we investigate the relationship between the underlying price and the value of the derivative, by inserting a set of scenarios for the underlying asset price in a child :</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="basic-components.html#cb19-1" aria-hidden="true" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">seq</span>(<span class="dv">80</span>, <span class="dv">120</span>, <span class="at">length.out =</span> <span class="dv">30</span>)))</span>
<span id="cb19-2"><a href="basic-components.html#cb19-2" aria-hidden="true" tabindex="-1"></a>sce.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>(<span class="at">parent =</span> base.env)</span>
<span id="cb19-3"><a href="basic-components.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(sce.env, underlying, <span class="st">&quot;Price&quot;</span>, dtCalc, sce)</span></code></pre></div>
and compute the NPV of the derivative for each scenario. The relationship between the underlying price and the value of the call is illustrated in figure <a href="basic-components.html#fig:102-sce-plot">1.1</a>.
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span style="display:block;" id="fig:102-sce-plot"></span>
<img src="102-simBasicClasses_files/figure-html/102-sce-plot-1.png" alt="Call Price as a function of spot value. Strike: 100, maturity: 1 Year" width="672"  />
<!--
<p class="caption marginnote">-->Figure 1.1: Call Price as a function of spot value. Strike: 100, maturity: 1 Year<!--</p>-->
<!--</div>--></span>
</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="basic-components.html#cb20-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">getValue</span>(a, <span class="st">&quot;Price&quot;</span>, dtCalc, sce.env)</span>
<span id="cb20-2"><a href="basic-components.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sce, p, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&quot;Spot&quot;</span>,</span>
<span id="cb20-3"><a href="basic-components.html#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Price&quot;</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>

</div>
</div>
</div>
<p style="text-align: center;">
<a href="preface-to-the-first-edition.html"><button class="btn btn-default">Previous</button></a>
<a href="sim-framework.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
