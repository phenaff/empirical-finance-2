<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="11 Dynamic Hedging in the Black-Scholes Framework | Topics in Empirical Finance" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/img/frontCover.pdf" />
<meta property="og:description" content="An open access textbook on empirical finance" />
<meta name="github-repo" content="phenaff/empirical-finance-2" />

<meta name="author" content="Patrick Hénaff" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="An open access textbook on empirical finance">

<title>11 Dynamic Hedging in the Black-Scholes Framework | Topics in Empirical Finance</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<!--
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@jweisber" />
<meta name="twitter:creator" content="@jweisber" />
<meta name="twitter:title" content="Odds &amp; Ends" />
<meta name="twitter:description" content="An open access textbook for introductory philosophy courses on probability and inductive logic." />
<meta name="twitter:image" content="img/social_image.png" />
-->


<!--
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["output/HTML-CSS"],
  "HTML-CSS": {
    availableFonts: ["Gyre-Pagella"],
    preferredFont: "Gyre-Pagella",
    webFont: "Gyre-Pagella",
    imageFont: "Gyre-Pagella"
  }
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
      extensions: ["color.js"]
    }
  });
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />
<link rel="stylesheet" href="custom.css" type="text/css" />

</head>

<body>


<div style="display: none;">
$$
  \newcommand{\given}{\mid}
  \renewcommand{\neg}{\mathbin{\sim}}
  \renewcommand{\wedge}{\mathbin{\&}}
  \newcommand{\p}{Pr}
  \newcommand{\degr}{^{\circ}}
  \newcommand{\E}{E}
  \newcommand{\EU}{EU}
  \newcommand{\u}{U}
  \newcommand{\pr}{Pr}
  \newcommand{\po}{Pr^*}
  \definecolor{bookred}{RGB}{228,6,19}
  \definecolor{bookblue}{RGB}{0,92,169}
  \definecolor{bookpurple}{RGB}{114,49,94} 
$$
</div>

<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#preface-to-the-second-edition">Preface to the second edition</a></li>
<li><a href="preface-to-the-first-edition.html#preface-to-the-first-edition">Preface to the first edition</a></li>
<li class="part"><span><b>Computational Framework</b></span></li>
<li class="has-sub"><a href="basic-components.html#basic-components"><span class="toc-section-number">1</span> Basic Components</a>
<ul>
<li class="has-sub"><a href="basic-components.html#the-class"><span class="toc-section-number">1.1</span> The Class</a>
<ul>
<li><a href="basic-components.html#illustration"><span class="toc-section-number">1.1.1</span> Illustration</a></li>
<li><a href="basic-components.html#design-and-implementation"><span class="toc-section-number">1.1.2</span> Design and Implementation</a></li>
</ul></li>
<li class="has-sub"><a href="basic-components.html#the-class-1"><span class="toc-section-number">1.2</span> The Class</a>
<ul>
<li><a href="basic-components.html#the-model-for-market-data"><span class="toc-section-number">1.2.1</span> The Model for Market Data</a></li>
<li><a href="basic-components.html#the-search-algorithm"><span class="toc-section-number">1.2.2</span> The Search Algorithm</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="sim-framework.html#sim-framework"><span class="toc-section-number">2</span> The Simulation Framework</a>
<ul>
<li><a href="sim-framework.html#scenario-simulator"><span class="toc-section-number">2.1</span> Scenario Simulator</a></li>
<li class="has-sub"><a href="sim-framework.html#a-delta-hedging-experiment"><span class="toc-section-number">2.2</span> A Delta Hedging Experiment</a>
<ul>
<li><a href="sim-framework.html#design-considerations"><span class="toc-section-number">2.2.1</span> Design Considerations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Discreet Models</b></span></li>
<li class="has-sub"><a href="arb-free-pricing.html#arb-free-pricing"><span class="toc-section-number">3</span> Arbitrage-Free Pricing and Risk Neutral Valuation</a>
<ul>
<li class="has-sub"><a href="arb-free-pricing.html#arbitrage-free-pricing"><span class="toc-section-number">3.1</span> Arbitrage-free Pricing</a>
<ul>
<li><a href="arb-free-pricing.html#arrow-debreu-securities"><span class="toc-section-number">3.1.1</span> Arrow-Debreu Securities</a></li>
<li><a href="arb-free-pricing.html#the-price-of-traded-securities"><span class="toc-section-number">3.1.2</span> The Price of Traded Securities</a></li>
<li><a href="arb-free-pricing.html#complete-market"><span class="toc-section-number">3.1.3</span> Complete Market</a></li>
<li><a href="arb-free-pricing.html#equivalent-probability-measures"><span class="toc-section-number">3.1.4</span> Equivalent Probability Measures</a></li>
<li><a href="arb-free-pricing.html#the-impact-of-interest-rate"><span class="toc-section-number">3.1.5</span> The Impact of Interest Rate</a></li>
<li><a href="arb-free-pricing.html#trading-strategy-and-dynamic-completeness"><span class="toc-section-number">3.1.6</span> Trading Strategy and Dynamic Completeness</a></li>
<li><a href="arb-free-pricing.html#discounted-asset-prices-as-martingales"><span class="toc-section-number">3.1.7</span> Discounted Asset Prices as Martingales</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="binomial.html#binomial"><span class="toc-section-number">4</span> Risk-Neutral Pricing in a Binomial Framework</a>
<ul>
<li class="has-sub"><a href="binomial.html#introduction"><span class="toc-section-number">4.1</span> Introduction</a>
<ul>
<li><a href="binomial.html#subsec:binomial"><span class="toc-section-number">4.1.1</span> The Binomial Model for Stocks</a></li>
</ul></li>
<li><a href="binomial.html#pricing-with-arrow-debreu-securities"><span class="toc-section-number">4.2</span> Pricing With Arrow-Debreu Securities</a></li>
<li><a href="binomial.html#multi-period-binomial-model"><span class="toc-section-number">4.3</span> Multi-Period Binomial Model</a></li>
<li><a href="binomial.html#american-exercise"><span class="toc-section-number">4.4</span> American Exercise</a></li>
<li class="has-sub"><a href="binomial.html#calibration-of-the-binomial-model"><span class="toc-section-number">4.5</span> Calibration of the Binomial Model</a>
<ul>
<li><a href="binomial.html#tree-geometry"><span class="toc-section-number">4.5.1</span> Tree Geometry</a></li>
</ul></li>
</ul></li>
<li><a href="stability-of-the-binomial-model.html#stability-of-the-binomial-model"><span class="toc-section-number">5</span> Stability of the Binomial Model</a></li>
<li class="has-sub"><a href="sec:trinomial.html#sec:trinomial"><span class="toc-section-number">6</span> Trinomial Models</a>
<ul>
<li><a href="sec:trinomial.html#the-trinomial-tree"><span class="toc-section-number">6.1</span> The Trinomial Tree</a></li>
</ul></li>
<li class="part"><span><b>Derivatives in the Black-Scholes Framework</b></span></li>
<li class="has-sub"><a href="pricing-with-black-scholes.html#pricing-with-black-scholes"><span class="toc-section-number">7</span> Pricing with Black-Scholes</a>
<ul>
<li><a href="pricing-with-black-scholes.html#relationships-among-greeks"><span class="toc-section-number">7.1</span> Relationships Among Greeks</a></li>
</ul></li>
<li class="has-sub"><a href="applicability-of-the-black-scholes-model.html#applicability-of-the-black-scholes-model"><span class="toc-section-number">8</span> Applicability of the Black-Scholes Model</a>
<ul>
<li><a href="applicability-of-the-black-scholes-model.html#self-financing-replicating-portfolio"><span class="toc-section-number">8.1</span> Self-Financing Replicating Portfolio</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#hedging-error-due-to-discrete-hedging"><span class="toc-section-number">8.2</span> Hedging Error due to Discrete Hedging</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#error-due-to-unknown-volatility"><span class="toc-section-number">8.3</span> Error due to Unknown Volatility</a></li>
<li class="has-sub"><a href="applicability-of-the-black-scholes-model.html#second-order-hedging"><span class="toc-section-number">8.4</span> Second-Order Hedging</a>
<ul>
<li><a href="applicability-of-the-black-scholes-model.html#gamma-smoothing"><span class="toc-section-number">8.4.1</span> Gamma Smoothing</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#dynamic-delta-gamma-hedge"><span class="toc-section-number">8.4.2</span> Dynamic Delta-Gamma hedge</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="price-and-greeks-in-the-black-scholes-model.html#price-and-greeks-in-the-black-scholes-model"><span class="toc-section-number">9</span> Price and Greeks in the Black-Scholes Model</a>
<ul>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#solving-the-pricing-equation"><span class="toc-section-number">9.1</span> Solving the Pricing Equation</a></li>
<li class="has-sub"><a href="price-and-greeks-in-the-black-scholes-model.html#an-option-dashboard"><span class="toc-section-number">9.2</span> An Option Dashboard</a>
<ul>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#vanilla-option"><span class="toc-section-number">9.2.1</span> Vanilla Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#binary-option"><span class="toc-section-number">9.2.2</span> Binary Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#barrier-option"><span class="toc-section-number">9.2.3</span> Barrier Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#asian-option"><span class="toc-section-number">9.2.4</span> Asian Option</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-with-the-black-scholes-model.html#dynamic-hedging-with-the-black-scholes-model"><span class="toc-section-number">10</span> Dynamic Hedging with the Black-Scholes Model</a>
<ul>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#self-financing-replicating-portfolio-1"><span class="toc-section-number">10.1</span> Self-Financing Replicating Portfolio</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#hedging-error-due-to-discrete-hedging-1"><span class="toc-section-number">10.2</span> Hedging Error due to Discrete Hedging</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#error-due-to-unknown-volatility-1"><span class="toc-section-number">10.3</span> Error due to Unknown Volatility</a></li>
<li class="has-sub"><a href="dynamic-hedging-with-the-black-scholes-model.html#second-order-hedging-1"><span class="toc-section-number">10.4</span> Second-Order Hedging</a>
<ul>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#gamma-smoothing-1"><span class="toc-section-number">10.4.1</span> Gamma Smoothing</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#dynamic-delta-gamma-hedge-1"><span class="toc-section-number">10.4.2</span> Dynamic Delta-Gamma hedge</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#dynamic-hedging-in-the-black-scholes-framework"><span class="toc-section-number">11</span> Dynamic Hedging in the Black-Scholes Framework</a>
<ul>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#self-financing-replicating-portfolio-2"><span class="toc-section-number">11.1</span> Self-Financing Replicating Portfolio</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#continuous-rebalancing"><span class="toc-section-number">11.1.1</span> Continuous rebalancing</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#discreet-rebalancing"><span class="toc-section-number">11.1.2</span> Discreet rebalancing</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#illustration-1"><span class="toc-section-number">11.1.3</span> Illustration</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#a-more-realistic-example"><span class="toc-section-number">11.1.4</span> A More Realistic Example</a></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-discrete-hedging-2"><span class="toc-section-number">11.2</span> Hedging Error due to Discrete Hedging</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#empirical-test"><span class="toc-section-number">11.2.1</span> Empirical Test</a></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-transaction-cost"><span class="toc-section-number">11.3</span> Hedging Error due to Transaction Cost</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#empirical-test-1"><span class="toc-section-number">11.3.1</span> Empirical Test</a></li>
</ul></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-unknown-volatility"><span class="toc-section-number">11.4</span> Hedging Error due to Unknown Volatility</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#conclusion"><span class="toc-section-number">11.5</span> Conclusion</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#second-order-hedging-2"><span class="toc-section-number">11.6</span> Second-Order Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="the-implied-volatility.html#the-implied-volatility"><span class="toc-section-number">12</span> The implied volatility</a>
<ul>
<li><a href="the-implied-volatility.html#market-data"><span class="toc-section-number">12.1</span> Market Data</a></li>
<li class="has-sub"><a href="the-implied-volatility.html#calculation-of-implied-volatility"><span class="toc-section-number">12.2</span> Calculation of implied volatility</a>
<ul>
<li><a href="the-implied-volatility.html#newtons-method"><span class="toc-section-number">12.2.1</span> Newton’s method</a></li>
<li><a href="the-implied-volatility.html#implied-volatility-by-newtons-method"><span class="toc-section-number">12.2.2</span> Implied Volatility by Newton’s Method</a></li>
<li><a href="the-implied-volatility.html#secant-method"><span class="toc-section-number">12.2.3</span> Secant Method</a></li>
<li><a href="the-implied-volatility.html#jaeckels-method"><span class="toc-section-number">12.2.4</span> Jaeckel’s method</a></li>
<li><a href="the-implied-volatility.html#normalized-call-price-as-a-function-of-sigma"><span class="toc-section-number">12.2.5</span> Normalized Call price as a function of <span class="math inline">\(\sigma\)</span></a></li>
<li><a href="the-implied-volatility.html#transformed-objective-function"><span class="toc-section-number">12.2.6</span> Transformed objective function</a></li>
<li><a href="the-implied-volatility.html#impact-of-dividends"><span class="toc-section-number">12.2.7</span> Impact of Dividends</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-pricing-and-hedging"><span class="toc-section-number">13</span> Vanna-Volga Pricing and Hedging</a>
<ul>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#principle"><span class="toc-section-number">13.1</span> Principle</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-dynamic-hedging"><span class="toc-section-number">13.1.1</span> Vanna-Volga Dynamic Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#implementation"><span class="toc-section-number">13.2</span> Implementation</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-dynamic-hedging-1"><span class="toc-section-number">13.2.1</span> Vanna-Volga Dynamic Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#illustrations"><span class="toc-section-number">13.3</span> Illustrations</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#volatility-interpolation"><span class="toc-section-number">13.3.1</span> Volatility Interpolation</a></li>
<li><a href="vanna-volga-pricing-and-hedging.html#pricing-a-binary-option"><span class="toc-section-number">13.3.2</span> Pricing a Binary Option</a></li>
</ul></li>
</ul></li>
<li><a href="bibliography.html#bibliography"><span class="toc-section-number">14</span> Bibliography</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="dynamic-hedging-in-the-black-scholes-framework" class="section level1" number="11">
<h1><span class="header-section-number">11</span> Dynamic Hedging in the Black-Scholes Framework</h1>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fInstrument)</span></code></pre></div>
<pre><code>## Loading required package: fOptions</code></pre>
<pre><code>## Loading required package: timeDate</code></pre>
<pre><code>## Loading required package: timeSeries</code></pre>
<pre><code>## Loading required package: fBasics</code></pre>
<pre><code>## Loading required package: fExoticOptions</code></pre>
<pre><code>## Loading required package: fAsianOptions</code></pre>
<pre><code>## Loading required package: lubridate</code></pre>
<pre><code>## Loading required package: timechange</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DynamicSimulation)</span></code></pre></div>
<pre><code>## Loading required package: Hmisc</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## Loading required package: survival</code></pre>
<pre><code>## Loading required package: Formula</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## 
## Attaching package: &#39;Hmisc&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     format.pval, units</code></pre>
<pre><code>## Loading required package: xtable</code></pre>
<pre><code>## 
## Attaching package: &#39;xtable&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:Hmisc&#39;:
## 
##     label, label&lt;-</code></pre>
<pre><code>## The following object is masked from &#39;package:timeSeries&#39;:
## 
##     align</code></pre>
<pre><code>## The following object is masked from &#39;package:timeDate&#39;:
## 
##     align</code></pre>
<pre><code>## Loading required package: empfin</code></pre>
<pre><code>## Loading required package: fImport</code></pre>
<pre><code>## Loading required package: RCurl</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(empfin)</span>
<span id="cb106-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gplots)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;gplots&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     lowess</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BB)</span>
<span id="cb109-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb109-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SuppDists)</span>
<span id="cb109-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(moments)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;moments&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:fBasics&#39;:
## 
##     kurtosis, skewness</code></pre>
<pre><code>## The following objects are masked from &#39;package:timeDate&#39;:
## 
##     kurtosis, skewness</code></pre>
<p>In this chapter, we investigate the effectiveness of hedging strategies
in the Black-Scholes framework, and assess the impact of departures from
the assumptions of the Black-Scholes model. Indeed, the ultimate measure
of risk is the quality of the dynamic replicating strategy, and the
distribution of the residual wealth at expiry of the option. Throughout
this chapter, we place ourselves in the situation of a financial
institution that sells a derivative and dynamically hedges the risk.</p>
<div id="self-financing-replicating-portfolio-2" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Self-Financing Replicating Portfolio</h2>
<div id="continuous-rebalancing" class="section level3" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Continuous rebalancing</h3>
<p>Let <span class="math inline">\(C(S_t,t)\)</span> be the price of a call option at time
<span class="math inline">\(t, 0 \leq t \leq T\)</span>, with the spot price being <span class="math inline">\(S_t\)</span>. We first show
that we can construct a trading strategy involving the underlying asset
and a bank account, which will replicate exactly the option payoff
<span class="math inline">\(\max(S_T - K, 0)\)</span> at time <span class="math inline">\(T\)</span> . This strategy is self-financing,
meaning that it does not require any cash inflow, nor does it generate
any cash outflow after <span class="math inline">\(t = 0\)</span>. Because of this self-financing property,
the value of the option must be equal to the initial value of this
replicating portfolio. Otherwise, a sure profit could be gained by
trading the option against the replicating portfolio. The replicating
portfolio <span class="math inline">\(P\)</span> is made of <span class="math inline">\(\alpha_t\)</span> shares and a notional amount
<span class="math inline">\(\beta_t\)</span> of risk-free bond. The portfolio value is thus:</p>
<p><span class="math display">\[P_t = \alpha_t S_t + \beta_t B_t
\label{eq:portfolio-1}\]</span></p>
<p>where <span class="math inline">\(B_t\)</span> is the price of the risk-free bond at time <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[B_t = e^{-r(T-t)}\]</span></p>
<p>and <span class="math inline">\(\alpha_t = \frac{\partial C}{\partial S}\)</span>. At <span class="math inline">\(t=0\)</span> the portfolio
has by definition the same value as the option:</p>
<p><span class="math display">\[P_0 = C(S_0 , 0)\]</span></p>
<p>The residual wealth, <span class="math inline">\(V_t\)</span> is the difference between the replicating
portfolio and the option:</p>
<p><span class="math display">\[V_t = P_t - C(S_t, t)\]</span></p>
<p>We show that in fact <span class="math inline">\(V_t = 0, \ 0 \leq t \leq T\)</span>. Using the definition
of the hedge portfolio, we have:</p>
<p><span class="math display">\[\begin{aligned}
V_t &amp;=&amp; \frac{\partial C}{\partial S} S_t + \beta_t B_t - C(S_t, t) \\
&amp;=&amp; \Pi_t + \beta_t B_t
\beta_t B_t\end{aligned}\]</span></p>
<p>Differentiate:</p>
<p><span class="math display">\[dV_t = d\Pi_t + \beta_t dB_t\]</span></p>
<p>From the derivation of the Black-Scholes equation (see Appendix or
<span class="citation">Hull (<label for="tufte-mn-6" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-6" class="margin-toggle">1997<span class="marginnote">Hull, John. 1997. <em><span class="nocase">Options, Futures and Other Derivatives</span></em>. Prentice Hall.</span>)</span>), we know that the portfolio <span class="math inline">\(\Pi_t\)</span> is riskless:
<span class="math display">\[d\Pi_t = r\Pi dt\]</span></p>
<p>therefore,</p>
<p><span class="math display">\[\begin{aligned}
d V_t &amp;=&amp; r \Pi_t dt + \beta_t r B dt \nonumber \\
&amp;=&amp; r V_t dt \label{eq:ct-1}\end{aligned}\]</span></p>
<p>Since <span class="math inline">\(V_0 = 0\)</span>, equation <span class="math display">\[eq:ct-1\]</span> has a unique solution which is:</p>
<p><span class="math display">\[V_t = 0, \ 0 \leq t \leq T\]</span></p>
<p>and we conclude, that portfolio <span class="math inline">\(P\)</span> replicates the option at all time,
and in particular at expiry. The dynamic of the replication is governed
by the assumptions of the Black-Scholes framework,which are recalled
here:</p>
<ul>
<li><p>The underlying asset follows a geometric Brownian motion process,
with constant and known volatility. The actual drift does not
matter.</p></li>
<li><p>The interest rate is constant.</p></li>
<li><p>Trading is frictionless: there are no trading costs, shares can be
purchase in arbitrary fractions, trading can take place
continuously.</p></li>
</ul>
<p>Clearly, none of these assumptions are verified in real life, and we
expect that departure from these assumptions will affect the quality of
the dynamic replication described by the Black-Scholes model. The
purpose of this chapter is to investigate the effect of departures from
these assumptions, and address the question: how useful is the
Black-Scholes model in a environment where Black-Scholes assumptions are
not verified?</p>
<p>We will adress this question by means of simulations that are now
described.</p>
</div>
<div id="discreet-rebalancing" class="section level3" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Discreet rebalancing</h3>
<p>Since trading does not occur continuously, a replicating strategy must
consist in a decision rule that is implemented at regular intervals. In
the case of the delta-hedging strategy the rule will be:</p>
<ol style="list-style-type: decimal">
<li><p>Define a rebalancing interval <span class="math inline">\(\Delta t\)</span>. Trading dates with
therefore be <span class="math inline">\(\Delta t, 2\Delta t, \ldots, T-\Delta t\)</span>.</p></li>
<li><p>At each trading date <span class="math inline">\(t\)</span>, buy or sell the underlying stock so that
the hedge portfolio holds a quantity of risky asset equal to
<span class="math inline">\(\frac{\partial C_t}{\partial S_t}\)</span>.</p></li>
</ol>
<p>To describe the process step by step, we use the following notation:</p>
<dl>
<dt><span class="math inline">\(C_t\)</span></dt>
<dd>
<p>Value of derivative at time <span class="math inline">\(t\)</span></p>
</dd>
<dt><span class="math inline">\(V_t\)</span></dt>
<dd>
<p>Value of hedge portfolio</p>
</dd>
<dt><span class="math inline">\(B_t\)</span></dt>
<dd>
<p>Value of a pure discount bond maturing at T</p>
</dd>
<dt><span class="math inline">\(\alpha_t\)</span></dt>
<dd>
<p>Delta of derivative, also the quantity of risky asset in the
replicating portfolio</p>
</dd>
<dt><span class="math inline">\(\beta_t\)</span></dt>
<dd>
<p>Quantity of riskless asset in hedge.</p>
</dd>
</dl>
<p>At <span class="math inline">\(t = 0\)</span>, the derivative is sold at price <span class="math inline">\(C_0\)</span> and the proceeds are
used to purchase a hedge portfolio. The initial hedge is
<span class="math inline">\(\alpha_0 S_0 + \beta_0 B_0\)</span>, where <span class="math inline">\(\beta_0\)</span> is computed from the
acounting identity: <span class="math display">\[C_0 = \alpha_0 S_0 + \beta_0 B_0\]</span></p>
<p>At trading time <span class="math inline">\(t\)</span>, the decision rule is as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Compute the value of the hedge portfolio formed at the previous time
step:</p>
<p><span class="math display">\[V_t = \alpha_{t-\Delta t} S_t + \beta_{t-\Delta t} B_t\]</span></p></li>
<li><p>Compute the amount of risky security to hold:</p>
<p><span class="math display">\[\alpha_t = \frac{\partial C_t}{\partial S_t}\]</span></p></li>
<li><p>Since the strategy must be self-financing, determine the quantity of
bond to be lent or borrowed:
<span class="math display">\[\beta_t = \frac{V_t - \alpha_t S_t}{B_t}\]</span></p></li>
</ol>
<p>At expiry of the derivative, the bond is worth par, and the residual
wealth is:</p>
<p><span class="math display">\[-C_T + \alpha_{T-\Delta t} S_T + \beta_{T-\Delta t}\]</span></p>
<p>The quality of a model is ultimately measured by the residual error: the
liquidation value of the replicating portfolio, less the exercise value
of the option: <span class="math inline">\(V_T - C_T\)</span>.</p>
</div>
<div id="illustration-1" class="section level3" number="11.1.3">
<h3><span class="header-section-number">11.1.3</span> Illustration</h3>
<p>Let’s illustrate this rebalancing process through a simple example that
will also demonstrate the self-financing nature of the portfolio. A
financial institution writes (sells) an at-the-money option on a stock
that does not pay any dividend, and worth €100. The option expires in
two months, and for illustrative purpose, the hedge will be rebalanced
every week (in practice, of course, dynamic rebalancing is done much
more often). Interest rate is <span class="math inline">\(2\%\)</span> and volatility <span class="math inline">\(30\%\)</span>.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb113-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-2" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">12</span></span>
<span id="cb113-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-3" aria-hidden="true" tabindex="-1"></a>S0 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb113-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-4" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb113-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-5" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb113-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">GBSOption</span>(<span class="at">TypeFlag =</span> <span class="st">&quot;c&quot;</span>, <span class="at">S =</span> S0, <span class="at">X =</span> K,</span>
<span id="cb113-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time =</span> T, <span class="at">r =</span> r, <span class="at">b =</span> r, sigma)<span class="sc">@</span>price</span>
<span id="cb113-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-9" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">GBSGreeks</span>(<span class="st">&quot;delta&quot;</span>, <span class="at">TypeFlag =</span> <span class="st">&quot;c&quot;</span>, <span class="at">S =</span> S0,</span>
<span id="cb113-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb113-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> K, <span class="at">Time =</span> T, <span class="at">r =</span> r, <span class="at">b =</span> r, sigma)</span></code></pre></div>
<p>The initial hedge portfolio is constructed as follows:</p>
<ul>
<li><p>The value of the hedge portfolio is the value of the derivative:
<span class="math inline">\(P_0 = 5.04\)</span>.</p></li>
<li><p>The delta of the option is:
<span class="math display">\[\frac{\partial C_0}{\partial S_0} = 0.54\]</span></p>
<p>Thus the hedge portfolio must also hold
<span class="math inline">\(\alpha_0 = 0.54\)</span> units of stocks, for a cost of
<span class="math inline">\(\alpha_0 \times 100 = 53.52\)</span>.</p></li>
<li><p>this position is funded by a riskless borrowing of
<span class="math inline">\(\beta_0 B = P_0 - 100 \alpha_0 =  -48.48\)</span>.</p></li>
<li><p>Since the zero-coupon bond is worth <span class="math inline">\(B_0 = e^{-rT} = 0.997\)</span>, we get
<span class="math inline">\(\beta_0 = -48.64\)</span>.</p></li>
</ul>
<p>At every time step, the portfolio is adjusted acording to the algorithm
of the previous section.</p>
<p>This calculation is easily performed with the supplied packages:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-1" aria-hidden="true" tabindex="-1"></a>dtStart <span class="ot">&lt;-</span> <span class="fu">myDate</span>(<span class="st">&quot;01jun2010&quot;</span>)</span>
<span id="cb114-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-2" aria-hidden="true" tabindex="-1"></a>dtObs <span class="ot">&lt;-</span> dtStart</span>
<span id="cb114-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-3" aria-hidden="true" tabindex="-1"></a>dtExpiry <span class="ot">&lt;-</span> <span class="fu">myDate</span>(<span class="st">&quot;01aug2010&quot;</span>)</span>
<span id="cb114-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-4" aria-hidden="true" tabindex="-1"></a>underlying <span class="ot">&lt;-</span> <span class="st">&quot;IBM&quot;</span></span>
<span id="cb114-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-5" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb114-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-6" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb114-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-8" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">fInstrumentFactory</span>(<span class="st">&quot;vanilla&quot;</span>, <span class="at">quantity =</span> <span class="dv">1</span>,</span>
<span id="cb114-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">cp =</span> <span class="st">&quot;c&quot;</span>, <span class="at">strike =</span> K, <span class="at">dtExpiry =</span> dtExpiry,</span>
<span id="cb114-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">underlying =</span> underlying, <span class="at">discountRef =</span> <span class="st">&quot;USD.LIBOR&quot;</span>,</span>
<span id="cb114-11"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">trace =</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-12"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-13"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-13" aria-hidden="true" tabindex="-1"></a>base.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>()</span>
<span id="cb114-14"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-15"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-15" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;Price&quot;</span>, dtObs,</span>
<span id="cb114-16"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-16" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span>)</span>
<span id="cb114-17"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-17" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;DivYield&quot;</span>, dtObs,</span>
<span id="cb114-18"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>)</span>
<span id="cb114-19"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-19" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;ATMVol&quot;</span>, dtObs,</span>
<span id="cb114-20"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-20" aria-hidden="true" tabindex="-1"></a>    sigma)</span>
<span id="cb114-21"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-21" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;discountRef&quot;</span>, dtObs,</span>
<span id="cb114-22"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;USD.LIBOR&quot;</span>)</span>
<span id="cb114-23"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-23" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, <span class="st">&quot;USD.LIBOR&quot;</span>, <span class="st">&quot;Yield&quot;</span>, dtObs,</span>
<span id="cb114-24"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb114-24" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.02</span>)</span></code></pre></div>
<p>At this stage, we can price the asset with</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb115-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">getValue</span>(a, <span class="st">&quot;Price&quot;</span>, dtStart, base.env)</span></code></pre></div>
<p>which gives a value of <span class="math inline">\(p = 4.87\)</span>. Next, define the
parameters to simulate a dynamic hedging policy with weekly rebalancing
and two price paths:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb116-1" aria-hidden="true" tabindex="-1"></a>nbSteps <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb116-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb116-2" aria-hidden="true" tabindex="-1"></a>nbPaths <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb116-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb116-3" aria-hidden="true" tabindex="-1"></a>dtSim <span class="ot">&lt;-</span> <span class="fu">seq</span>(dtObs, dtExpiry, <span class="at">length.out =</span> nbSteps <span class="sc">+</span></span>
<span id="cb116-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb116-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>)</span></code></pre></div>
<p>The simulated price path is generated by</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb117-1" aria-hidden="true" tabindex="-1"></a>tSpot <span class="ot">&lt;-</span> <span class="fu">pathSimulator</span>(<span class="at">dtSim =</span> dtSim, <span class="at">nbPaths =</span> nbPaths,</span>
<span id="cb117-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb117-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">innovations.gen =</span> sobolInnovations, <span class="at">path.gen =</span> logNormal,</span>
<span id="cb117-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb117-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">path.param =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> sigma),</span>
<span id="cb117-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">S0 =</span> <span class="dv">100</span>, <span class="at">antithetic =</span> F, <span class="at">standardization =</span> <span class="cn">TRUE</span>,</span>
<span id="cb117-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb117-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">trace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>and the simulated paths are placed in a new data provider:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb118-1" aria-hidden="true" tabindex="-1"></a>sce.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>(<span class="at">parent =</span> base.env)</span>
<span id="cb118-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(sce.env, underlying, <span class="st">&quot;Price&quot;</span>, <span class="fu">time</span>(tSpot),</span>
<span id="cb118-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(tSpot))</span></code></pre></div>
<p>We can now run the delta-hedge strategy along each path:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb119-1" aria-hidden="true" tabindex="-1"></a>assets <span class="ot">=</span> <span class="fu">list</span>(a)</span>
<span id="cb119-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb119-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">deltaHedge</span>(assets, sce.env, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">dtSim =</span> <span class="fu">time</span>(tSpot),</span>
<span id="cb119-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">transaction.cost =</span> <span class="dv">0</span>), <span class="at">trace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The result is a data structure that containts the residual wealth
(hedging error) per scenario.</p>
<p>Tables <span class="math display">\[tab:dyn-sim-1\]</span> and <span class="math display">\[tab:dyn-sim-2\]</span> illustrate how the hedge
portfolios evolve over time, based on the path of the underlying asset.
In Table <span class="math display">\[tab:dyn-sim-2\]</span>, the option expires out of the money, and the
hedge portfolio ends up being exclusively cash. In
Table <span class="math display">\[tab:dyn-sim-1\]</span>, the option expires in the money, and the hedge
portfolio holds at expiry one unit of stock. Note the amount of leverage
required by delta hedging when the option expires in the money: the
option payoff is 45 cents, and this is replicated by a portfolio holding
€100.45 worth of stock, funded by borrowing €99.00.</p>
<p>The data shown in both tables are extracted from the simulation results
and formated with the following function.</p>
% latex table generated in R 4.2.2 by xtable 1.8-4 package
% Sun Jan 15 22:57:07 2023
% latex table generated in R 4.2.2 by xtable 1.8-4 package
% Sun Jan 15 22:57:07 2023
</div>
<div id="a-more-realistic-example" class="section level3" number="11.1.4">
<h3><span class="header-section-number">11.1.4</span> A More Realistic Example</h3>
<p>More time steps and scenarios are needed in order to accurately assess
the distribution of residual wealth. The next experiment uses the
parameters of the previous section, with 200 time steps and 1000
sceanrios.</p>
<p>Figure <span class="math display">\[fig:paths-2\]</span> displays a few simulated paths for the underlying
asset, and an histogram of the residual wealth.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-1" aria-hidden="true" tabindex="-1"></a>nbSteps <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb120-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-2" aria-hidden="true" tabindex="-1"></a>nbPaths <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb120-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-3" aria-hidden="true" tabindex="-1"></a>dtSim <span class="ot">&lt;-</span> <span class="fu">seq</span>(dtObs, dtExpiry, <span class="at">length.out =</span> nbSteps <span class="sc">+</span></span>
<span id="cb120-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>)</span>
<span id="cb120-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-5" aria-hidden="true" tabindex="-1"></a>tSpot <span class="ot">&lt;-</span> <span class="fu">pathSimulator</span>(<span class="at">dtSim =</span> dtSim, <span class="at">nbPaths =</span> nbPaths,</span>
<span id="cb120-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">innovations.gen =</span> sobolInnovations, <span class="at">path.gen =</span> logNormal,</span>
<span id="cb120-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">path.param =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> sigma),</span>
<span id="cb120-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">S0 =</span> <span class="dv">100</span>, <span class="at">antithetic =</span> F, <span class="at">standardization =</span> <span class="cn">TRUE</span>,</span>
<span id="cb120-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb120-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-10" aria-hidden="true" tabindex="-1"></a>sim.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>(<span class="at">parent =</span> base.env)</span>
<span id="cb120-11"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(sim.env, underlying, <span class="st">&quot;Price&quot;</span>, <span class="fu">time</span>(tSpot),</span>
<span id="cb120-12"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(tSpot))</span>
<span id="cb120-13"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-13" aria-hidden="true" tabindex="-1"></a>sim.deltaHedge <span class="ot">&lt;-</span> <span class="fu">deltaHedge</span>(assets, sim.env,</span>
<span id="cb120-14"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">dtSim =</span> <span class="fu">time</span>(tSpot), <span class="at">transaction.cost =</span> <span class="dv">0</span>),</span>
<span id="cb120-15"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb120-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">trace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="305-BS-DynamicHedging_files/figure-html/fig-price-plot-2-1.png" width="576"  /></p>
<p>As expected, the distribution of residual wealth is centered, and has a
standard deviation of</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb121-1" aria-hidden="true" tabindex="-1"></a>sd.wealth <span class="ot">&lt;-</span> <span class="fu">sd</span>(<span class="fu">t</span>(<span class="fu">tail</span>(sim.deltaHedge<span class="sc">$</span>wealth,</span>
<span id="cb121-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb121-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>)))</span></code></pre></div>
<p>A confidence interval (say, 80%) for the P&amp;L of the delta-hedging
strategy is readily computed:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb122-1" aria-hidden="true" tabindex="-1"></a>pl.confidence <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.2</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sd.wealth)</span></code></pre></div>
<p>which gives a value of <span class="math inline">\(-0.34\)</span>. In other words,
there is a 80% probability that this delta-hedging strategy will yield a
P&amp;L greater than <span class="math inline">\(-0.34\)</span> per € of nominal. In
the next couple of sections, we will provide a more rigorous analysis of
these observations.</p>
<p>With this simulation tool, we will now consider the effect on hedging
effectiveness of:</p>
<ul>
<li><p>discrete rather than continuous hedging,</p></li>
<li><p>transaction costs, and</p></li>
<li><p>unknown and stochastic volatility.</p></li>
</ul>
</div>
</div>
<div id="hedging-error-due-to-discrete-hedging-2" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> Hedging Error due to Discrete Hedging</h2>
<p>We first consider the risk related to discreet hedging. The dynamic of
the replicating portfolio, <span class="math inline">\(V_t\)</span> rebalanced at times
<span class="math inline">\(t_i, i= 1, \ldots, N\)</span>. For <span class="math inline">\(t \in [t_i, t_{i+1})\)</span> is:</p>
<p><span class="math display">\[dV_t = \frac{\partial C(t_i, S_{t_i})}{\partial S} dS_t
\label{eq:dV}\]</span></p>
<p>The dynamic of the option price is:</p>
<p><span class="math display">\[dC_t = \frac{\partial C(t, S_{t})}{\partial S} dS_t\]</span></p>
<p>The difference between the two processes being that in the hedge
portfolio, the quantity of stock
<span class="math inline">\(\sfrac{\partial C(t_i, S_{t_i})}{\partial S_{t_i}}\)</span> (Eq. <span class="math display">\[eq:dV\]</span>), is
held constant between two rebalancing dates.</p>
<p>The hedging error process <span class="math inline">\(\epsilon_t = C_t - V_t\)</span> is therefore:</p>
<p><span class="math display">\[d\epsilon_t = \left(\frac{\partial C(t, S_{t})}{\partial S} - \frac{\partial C(t_i, S_{t_i})}{\partial S} \right) dS_t\]</span></p>
<p>It can be shown that:</p>
<p><span class="math display">\[\varinjlim_{h \rightarrow 0} E^Q \left[ \frac{\epsilon_T^2}{\Delta t} \right] = E^Q \left[ \frac{1}{2} \int_0^T \left( \frac{\partial^2 C(S_t,t)}{\partial S_t^2} \right)^2 S^4_t \sigma^4 dt\right]\]</span></p>
<p>It can also be shown that the process <span class="math inline">\(\epsilon_t\)</span> converges in
distribution to a process that has the following expression:</p>
<p><span class="math display">\[\frac{\epsilon_t}{\sqrt{\Delta t}} \rightarrow \frac{1}{\sqrt{2}} \int_0^t \frac{\partial^2 C(S_u, u)}{\partial S^2} \sigma^2 S^2_u dZ_u\]</span></p>
<p>This expression highlights the following points:</p>
<ol style="list-style-type: decimal">
<li><p>The variance of the hedging is inversely related to the hedging
frequency, and</p></li>
<li><p>is directly related to the magnitude of
<span class="math inline">\(\frac{\partial^2 C(S_u, u)}{\partial S^2}\)</span>, which is the Gamma of
the option.</p></li>
</ol>
<div id="empirical-test" class="section level3" number="11.2.1">
<h3><span class="header-section-number">11.2.1</span> Empirical Test</h3>
<p>To test the impact of hedging frequency on the distribution of
delta-hedging error, we simulate the dynamic delta hedging of a ATM
option. The price paths are generated with the same volatility as the
one used for pricing, and there are no transaction costs. Therefore, the
only source of hedging error is the discrete hedging policy. The
simulation involves several steps that are outlined next.</p>
<p>First, define the derivative to be dynamically hedged:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb123-1" aria-hidden="true" tabindex="-1"></a>dtExpiry <span class="ot">&lt;-</span> <span class="fu">mytDate</span>(<span class="st">&quot;01jan2011&quot;</span>)</span>
<span id="cb123-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb123-2" aria-hidden="true" tabindex="-1"></a>underlying <span class="ot">&lt;-</span> <span class="st">&quot;IBM&quot;</span></span>
<span id="cb123-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb123-3" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb123-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb123-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">fInstrumentFactory</span>(<span class="st">&quot;vanilla&quot;</span>, <span class="at">quantity =</span> <span class="dv">1</span>,</span>
<span id="cb123-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb123-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">cp =</span> <span class="st">&quot;c&quot;</span>, <span class="at">strike =</span> K, <span class="at">dtExpiry =</span> dtExpiry,</span>
<span id="cb123-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb123-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">underlying =</span> underlying, <span class="at">discountRef =</span> <span class="st">&quot;USD.LIBOR&quot;</span>,</span>
<span id="cb123-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb123-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">trace =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<p>Next, we define the market data that we be used in the simulation. The
base environment holds data that will not change from one simulation to
the next.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-1" aria-hidden="true" tabindex="-1"></a>dtStart <span class="ot">&lt;-</span> <span class="fu">mytDate</span>(<span class="st">&quot;01jan2010&quot;</span>)</span>
<span id="cb124-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-2" aria-hidden="true" tabindex="-1"></a>nbPaths <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb124-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb124-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-5" aria-hidden="true" tabindex="-1"></a>base.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>()</span>
<span id="cb124-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;Price&quot;</span>, dtStart,</span>
<span id="cb124-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span>)</span>
<span id="cb124-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;DivYield&quot;</span>, dtStart,</span>
<span id="cb124-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-9" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.02</span>)</span>
<span id="cb124-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;ATMVol&quot;</span>, dtStart,</span>
<span id="cb124-11"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-11" aria-hidden="true" tabindex="-1"></a>    sigma)</span>
<span id="cb124-12"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-12" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;discountRef&quot;</span>, dtStart,</span>
<span id="cb124-13"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;USD.LIBOR&quot;</span>)</span>
<span id="cb124-14"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-14" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, <span class="st">&quot;USD.LIBOR&quot;</span>, <span class="st">&quot;Yield&quot;</span>, dtStart,</span>
<span id="cb124-15"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb124-15" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.02</span>)</span></code></pre></div>
<p>We next perform a series of dynamic hedging simulations, while varying
the number of time steps.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-1" aria-hidden="true" tabindex="-1"></a>nb.range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">500</span>, <span class="at">by =</span> <span class="dv">50</span>)</span>
<span id="cb125-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-2" aria-hidden="true" tabindex="-1"></a>mean.error <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> nb.range</span>
<span id="cb125-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-3" aria-hidden="true" tabindex="-1"></a>sd.error <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> nb.range</span>
<span id="cb125-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(nb.range)) {</span>
<span id="cb125-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-7" aria-hidden="true" tabindex="-1"></a>    nbSteps <span class="ot">&lt;-</span> nb.range[i]</span>
<span id="cb125-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-9" aria-hidden="true" tabindex="-1"></a>    dtSim <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.timeDate</span>(dtStart), <span class="fu">as.timeDate</span>(dtExpiry),</span>
<span id="cb125-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">length.out =</span> nbSteps <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb125-11"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-12"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># price paths</span></span>
<span id="cb125-13"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-13" aria-hidden="true" tabindex="-1"></a>    tSpot <span class="ot">&lt;-</span> <span class="fu">pathSimulator</span>(<span class="at">dtSim =</span> dtSim, <span class="at">nbPaths =</span> nbPaths,</span>
<span id="cb125-14"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">innovations.gen =</span> sobolInnovations, <span class="at">path.gen =</span> logNormal,</span>
<span id="cb125-15"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">path.param =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> sigma),</span>
<span id="cb125-16"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">S0 =</span> <span class="dv">100</span>, <span class="at">antithetic =</span> F, <span class="at">standardization =</span> <span class="cn">TRUE</span>,</span>
<span id="cb125-17"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb125-18"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-19"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># derived environment for scenario</span></span>
<span id="cb125-20"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># analysis</span></span>
<span id="cb125-21"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-22"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-22" aria-hidden="true" tabindex="-1"></a>    sce.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>(<span class="at">parent =</span> base.env)</span>
<span id="cb125-23"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setData</span>(sce.env, underlying, <span class="st">&quot;Price&quot;</span>, <span class="fu">time</span>(tSpot),</span>
<span id="cb125-24"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.matrix</span>(tSpot))</span>
<span id="cb125-25"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-26"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate a delta-hedge strategy along</span></span>
<span id="cb125-27"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># each path</span></span>
<span id="cb125-28"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-29"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-29" aria-hidden="true" tabindex="-1"></a>    assets <span class="ot">=</span> <span class="fu">list</span>(a)</span>
<span id="cb125-30"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-30" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">deltaHedge</span>(assets, sce.env, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">dtSim =</span> <span class="fu">time</span>(tSpot),</span>
<span id="cb125-31"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">transaction.cost =</span> <span class="dv">0</span>), <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb125-32"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-33"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-33" aria-hidden="true" tabindex="-1"></a>    expiry.error <span class="ot">&lt;-</span> <span class="fu">tail</span>(res<span class="sc">$</span>wealth, <span class="dv">1</span>)</span>
<span id="cb125-34"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-35"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-35" aria-hidden="true" tabindex="-1"></a>    mean.error[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(expiry.error)</span>
<span id="cb125-36"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-36" aria-hidden="true" tabindex="-1"></a>    sd.error[i] <span class="ot">&lt;-</span> <span class="fu">sd</span>(<span class="fu">as.vector</span>(expiry.error))</span>
<span id="cb125-37"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb125-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Figure <span class="math display">\[fig:delta-steps\]</span> illustrates the mean and standard deviation
of the hedging error as a function of the number of rehedging dates. The
figure also shows the curve <span class="math display">\[y = a + b \frac{1}{\sqrt{N}}\]</span></p>
<p>fitted to the standard deviation of the hedging error. The theory
predicts that the standard deviation of the hedging error is
proportional to <span class="math inline">\(\frac{1}{\sqrt{N}}\)</span>, where <span class="math inline">\(N\)</span> is the number of
re-hedging dates.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotCI</span>(<span class="at">x =</span> nb.range, <span class="at">y =</span> mean.error, <span class="at">uiw =</span> sd.error<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb126-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">liw =</span> sd.error<span class="sc">/</span><span class="dv">2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(mean.error <span class="sc">-</span></span>
<span id="cb126-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-3" aria-hidden="true" tabindex="-1"></a>        sd.error<span class="sc">/</span><span class="dv">2</span>), <span class="fu">max</span>(mean.error <span class="sc">+</span> sd.error<span class="sc">/</span><span class="dv">2</span>)),</span>
<span id="cb126-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Nb of rebalancings&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Hedging error&quot;</span>)</span>
<span id="cb126-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-6" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">lm</span>((mean.error <span class="sc">+</span> sd.error<span class="sc">/</span><span class="dv">2</span>) <span class="sc">~</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span>nb.range))</span>
<span id="cb126-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-7" aria-hidden="true" tabindex="-1"></a>yy <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">interpSpline</span>(nb.range, q<span class="sc">$</span>fitted.values))</span>
<span id="cb126-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(nb.range, q$fitted.values, lwd=2,</span></span>
<span id="cb126-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co"># col=&#39;red&#39;)</span></span>
<span id="cb126-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(yy, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="305-BS-DynamicHedging_files/figure-html/Delta-Hedge-1.png" width="672"  /></p>
<p><img src="305-BS-DynamicHedging_files/figure-html/fig-Delta-Hedge-1.png" width="480"  /></p>
<p>To investigate the effect of gamma on hedging error, we will compare the
effectiveness of delta hedging, applied to two options that initially
have the same price and delta. The initial Gammas are within 10% of each
other. However, the options differ substantially in one aspect: the
first option is a European call, and its Gamma varishes when the option
gets deep in the money, while the second option is a binary call, whose
Gamma remains large and actually changes sign under the same conditions.</p>
<p>To perform the experiment, we first define the data environment: the
spot price is 100, option maturity will be 1 year.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-1" aria-hidden="true" tabindex="-1"></a>dtExpiry <span class="ot">&lt;-</span> <span class="fu">myDate</span>(<span class="st">&quot;01jan2011&quot;</span>)</span>
<span id="cb127-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-2" aria-hidden="true" tabindex="-1"></a>dtStart <span class="ot">&lt;-</span> <span class="fu">myDate</span>(<span class="st">&quot;01jan2010&quot;</span>)</span>
<span id="cb127-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-3" aria-hidden="true" tabindex="-1"></a>underlying <span class="ot">&lt;-</span> <span class="st">&quot;IBM&quot;</span></span>
<span id="cb127-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-4" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb127-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-6" aria-hidden="true" tabindex="-1"></a>base.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>()</span>
<span id="cb127-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;Price&quot;</span>, dtStart,</span>
<span id="cb127-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span>)</span>
<span id="cb127-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;DivYield&quot;</span>, dtStart,</span>
<span id="cb127-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-10" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.02</span>)</span>
<span id="cb127-11"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;ATMVol&quot;</span>, dtStart,</span>
<span id="cb127-12"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-12" aria-hidden="true" tabindex="-1"></a>    sigma)</span>
<span id="cb127-13"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, underlying, <span class="st">&quot;discountRef&quot;</span>, dtStart,</span>
<span id="cb127-14"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;USD.LIBOR&quot;</span>)</span>
<span id="cb127-15"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-15" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(base.env, <span class="st">&quot;USD.LIBOR&quot;</span>, <span class="st">&quot;Yield&quot;</span>, dtStart,</span>
<span id="cb127-16"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb127-16" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.02</span>)</span></code></pre></div>
<p>The strike of the European option is set to <span class="math inline">\(K=130\)</span>.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb128-1" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">130</span></span>
<span id="cb128-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb128-2" aria-hidden="true" tabindex="-1"></a>op.eu <span class="ot">&lt;-</span> <span class="fu">fInstrumentFactory</span>(<span class="st">&quot;vanilla&quot;</span>, <span class="at">quantity =</span> <span class="dv">1</span>,</span>
<span id="cb128-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb128-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">cp =</span> <span class="st">&quot;c&quot;</span>, <span class="at">strike =</span> K, <span class="at">dtExpiry =</span> dtExpiry,</span>
<span id="cb128-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb128-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">underlying =</span> underlying, <span class="at">discountRef =</span> <span class="st">&quot;USD.LIBOR&quot;</span>,</span>
<span id="cb128-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb128-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">trace =</span> <span class="cn">FALSE</span>))</span>
<span id="cb128-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb128-7" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.eu, <span class="st">&quot;Price&quot;</span>, dtStart, base.env)</span>
<span id="cb128-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb128-8" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.eu, <span class="st">&quot;Delta&quot;</span>, dtStart, base.env)</span></code></pre></div>
<p>The price is <span class="math inline">\(P=3.99\)</span>, delta is <span class="math inline">\(D=0.26\)</span>.</p>
<p>The strike and payoff of the binary option are set in order to match the
price and delta of the European call, so as to make a meaningful
comparison of hedging error. This involves solving a set of two
non-linear equations (price and delta) in two unknown (payoff and
strike). These equations are solved by means of the following function:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-1" aria-hidden="true" tabindex="-1"></a>price.delta.error <span class="ot">&lt;-</span> <span class="cf">function</span>(x, base.env) {</span>
<span id="cb129-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-2" aria-hidden="true" tabindex="-1"></a>    Q <span class="ot">&lt;-</span> x[<span class="dv">1</span>]</span>
<span id="cb129-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-3" aria-hidden="true" tabindex="-1"></a>    K.b <span class="ot">&lt;-</span> x[<span class="dv">2</span>]</span>
<span id="cb129-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-5" aria-hidden="true" tabindex="-1"></a>    op.bi <span class="ot">&lt;-</span> <span class="fu">fInstrumentFactory</span>(<span class="st">&quot;binary&quot;</span>, <span class="at">quantity =</span> Q,</span>
<span id="cb129-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">params =</span> <span class="fu">list</span>(<span class="at">cp =</span> <span class="st">&quot;c&quot;</span>, <span class="at">strike =</span> K.b,</span>
<span id="cb129-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">dtExpiry =</span> dtExpiry, <span class="at">underlying =</span> underlying,</span>
<span id="cb129-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">discountRef =</span> <span class="st">&quot;USD.LIBOR&quot;</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>))</span>
<span id="cb129-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-10" aria-hidden="true" tabindex="-1"></a>    Pa <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.bi, <span class="st">&quot;Price&quot;</span>, dtStart, base.env)</span>
<span id="cb129-11"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-11" aria-hidden="true" tabindex="-1"></a>    Da <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.bi, <span class="st">&quot;Delta&quot;</span>, dtStart, base.env)</span>
<span id="cb129-12"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-13"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-13" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">2</span>)</span>
<span id="cb129-14"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-14" aria-hidden="true" tabindex="-1"></a>    f[<span class="dv">1</span>] <span class="ot">&lt;-</span> (P <span class="sc">-</span> Pa)</span>
<span id="cb129-15"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-15" aria-hidden="true" tabindex="-1"></a>    f[<span class="dv">2</span>] <span class="ot">&lt;-</span> (D <span class="sc">-</span> Da)</span>
<span id="cb129-16"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-16" aria-hidden="true" tabindex="-1"></a>    f</span>
<span id="cb129-17"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb129-18"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-19"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-19" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> <span class="fu">dfsane</span>(<span class="at">par =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>), <span class="at">fn =</span> price.delta.error,</span>
<span id="cb129-20"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb129-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">base.env =</span> base.env)</span></code></pre></div>
<pre><code>## Iteration:  0  ||F(x0)||:  31.38328 
## iteration:  10  ||F(xn)|| =   0.01664841 
## iteration:  20  ||F(xn)|| =   0.1147432 
## iteration:  30  ||F(xn)|| =   0.04243755 
## iteration:  40  ||F(xn)|| =   0.009005428 
## iteration:  50  ||F(xn)|| =   0.001379282 
## iteration:  60  ||F(xn)|| =   6.250002e-06</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb131-1" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> ans<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb131-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb131-2" aria-hidden="true" tabindex="-1"></a>K.b <span class="ot">&lt;-</span> ans<span class="sc">$</span>par[<span class="dv">2</span>]</span></code></pre></div>
<p>The solution is a binary call with payoff <span class="math inline">\(Q=58.45\)</span> and
strike <span class="math inline">\(K=155.06\)</span>.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb132-1" aria-hidden="true" tabindex="-1"></a>op.bi <span class="ot">&lt;-</span> <span class="fu">fInstrumentFactory</span>(<span class="st">&quot;binary&quot;</span>, <span class="at">quantity =</span> Q,</span>
<span id="cb132-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb132-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">cp =</span> <span class="st">&quot;c&quot;</span>, <span class="at">strike =</span> K.b, <span class="at">dtExpiry =</span> dtExpiry,</span>
<span id="cb132-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb132-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">underlying =</span> underlying, <span class="at">discountRef =</span> <span class="st">&quot;USD.LIBOR&quot;</span>,</span>
<span id="cb132-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb132-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">trace =</span> <span class="cn">FALSE</span>))</span>
<span id="cb132-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb132-6" aria-hidden="true" tabindex="-1"></a>G.bi <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.bi, <span class="st">&quot;Gamma&quot;</span>, dtStart, base.env)</span>
<span id="cb132-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb132-7" aria-hidden="true" tabindex="-1"></a>G.eu <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.eu, <span class="st">&quot;Gamma&quot;</span>, dtStart, base.env)</span></code></pre></div>
<p>The Gammas of the two options are not identical, but within 10% of each
others: <span class="math inline">\(0.0107\)</span> for European option,
<span class="math inline">\(0.01\)</span> for the binary option.</p>
<p>To illustrate the similarity between the two derivatives, we plot in
Figure<span class="math display">\[fig:eu-vanilla-binary\]</span> the prices of both options for a range
of underlying values, with a zoom around the current spot price.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-1" aria-hidden="true" tabindex="-1"></a>sce<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">seq</span>(<span class="dv">60</span>, <span class="dv">160</span>, <span class="at">length.out =</span> <span class="dv">50</span>)))</span>
<span id="cb133-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-2" aria-hidden="true" tabindex="-1"></a>sce<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">seq</span>(<span class="dv">60</span>, <span class="dv">350</span>, <span class="at">length.out =</span> <span class="dv">50</span>)))</span>
<span id="cb133-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># derived data provider with price scenarii</span></span>
<span id="cb133-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-5" aria-hidden="true" tabindex="-1"></a>sim.env<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>(<span class="at">parent =</span> base.env)</span>
<span id="cb133-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(sim.env<span class="fl">.1</span>, underlying, <span class="st">&quot;Price&quot;</span>, dtStart,</span>
<span id="cb133-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-7" aria-hidden="true" tabindex="-1"></a>    sce<span class="fl">.1</span>)</span>
<span id="cb133-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-9" aria-hidden="true" tabindex="-1"></a>sim.env<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>(<span class="at">parent =</span> base.env)</span>
<span id="cb133-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(sim.env<span class="fl">.2</span>, underlying, <span class="st">&quot;Price&quot;</span>, dtStart,</span>
<span id="cb133-11"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-11" aria-hidden="true" tabindex="-1"></a>    sce<span class="fl">.2</span>)</span>
<span id="cb133-12"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-13"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute and plot NPV per scenario for</span></span>
<span id="cb133-14"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-14" aria-hidden="true" tabindex="-1"></a><span class="co"># underlying spot price</span></span>
<span id="cb133-15"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-15" aria-hidden="true" tabindex="-1"></a>p.eu<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.eu, <span class="st">&quot;Price&quot;</span>, dtStart, sim.env<span class="fl">.1</span>)</span>
<span id="cb133-16"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-16" aria-hidden="true" tabindex="-1"></a>p.bi<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.bi, <span class="st">&quot;Price&quot;</span>, dtStart, sim.env<span class="fl">.1</span>)</span>
<span id="cb133-17"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-18"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-18" aria-hidden="true" tabindex="-1"></a>p.eu<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.eu, <span class="st">&quot;Price&quot;</span>, dtStart, sim.env<span class="fl">.2</span>)</span>
<span id="cb133-19"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb133-19" aria-hidden="true" tabindex="-1"></a>p.bi<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">getValue</span>(op.bi, <span class="st">&quot;Price&quot;</span>, dtStart, sim.env<span class="fl">.2</span>)</span></code></pre></div>
<p><img src="305-BS-DynamicHedging_files/figure-html/fig-VanillaBinary-1.png" width="480"  /></p>
<p>A delta hedging strategy is next simulated for both derivatives, using
100 steps, 5000 paths.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb134-1" aria-hidden="true" tabindex="-1"></a>nbSteps <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb134-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb134-2" aria-hidden="true" tabindex="-1"></a>nbPaths <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb134-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb134-4" aria-hidden="true" tabindex="-1"></a>dtSim <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.timeDate</span>(dtStart), <span class="fu">as.timeDate</span>(dtExpiry),</span>
<span id="cb134-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">length.out =</span> nbSteps <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># price paths</span></span>
<span id="cb135-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-2" aria-hidden="true" tabindex="-1"></a>tSpot <span class="ot">&lt;-</span> <span class="fu">pathSimulator</span>(<span class="at">dtSim =</span> dtSim, <span class="at">nbPaths =</span> nbPaths,</span>
<span id="cb135-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">innovations.gen =</span> sobolInnovations, <span class="at">path.gen =</span> logNormal,</span>
<span id="cb135-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">path.param =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> sigma),</span>
<span id="cb135-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">S0 =</span> <span class="dv">100</span>, <span class="at">antithetic =</span> F, <span class="at">standardization =</span> <span class="cn">TRUE</span>,</span>
<span id="cb135-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb135-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co"># derived environment for scenario analysis</span></span>
<span id="cb135-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-9" aria-hidden="true" tabindex="-1"></a>sce.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>(<span class="at">parent =</span> base.env)</span>
<span id="cb135-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(sce.env, underlying, <span class="st">&quot;Price&quot;</span>, <span class="fu">time</span>(tSpot),</span>
<span id="cb135-11"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(tSpot))</span>
<span id="cb135-12"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-13"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-13" aria-hidden="true" tabindex="-1"></a>assets <span class="ot">=</span> <span class="fu">list</span>(op.eu)</span>
<span id="cb135-14"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-14" aria-hidden="true" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> <span class="fu">deltaHedge</span>(assets, sce.env, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">dtSim =</span> <span class="fu">time</span>(tSpot),</span>
<span id="cb135-15"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">transaction.cost =</span> <span class="dv">0</span>), <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb135-16"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-17"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-17" aria-hidden="true" tabindex="-1"></a>assets <span class="ot">=</span> <span class="fu">list</span>(op.bi)</span>
<span id="cb135-18"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-18" aria-hidden="true" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> <span class="fu">deltaHedge</span>(assets, sce.env, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">dtSim =</span> <span class="fu">time</span>(tSpot),</span>
<span id="cb135-19"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb135-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">transaction.cost =</span> <span class="dv">0</span>), <span class="at">trace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Figure <span class="math display">\[fig:vanilla-binary-error\]</span> displays the histograms of residual
errors.</p>
<p><img src="305-BS-DynamicHedging_files/figure-html/fig-VanillaBinaryError-1.png" width="480"  /></p>
<p>Statistics on the hedging error at expiry are summarized in
Table <span class="math display">\[tab:euro-bin\]</span>. The standard deviation of the binary hedging
error is about three times larger than for the vanilla option. Most
importantly, the excess kurtosis is almost 10 times larger, indicating
the possibilily that applying a standard delta-hedging strategy to a
binary option can result in extreme losses (or gains!). All of this in a
context where the only departure from the Black-Scholes assumptions is a
discrete rather than continuous hedging. We next investigate the impact
of transaction costs.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb136-1" aria-hidden="true" tabindex="-1"></a>w1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">tail</span>(res1<span class="sc">$</span>wealth, <span class="dv">1</span>))</span>
<span id="cb136-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb136-2" aria-hidden="true" tabindex="-1"></a>w2 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">tail</span>(res2<span class="sc">$</span>wealth, <span class="dv">2</span>))</span>
<span id="cb136-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb136-3" aria-hidden="true" tabindex="-1"></a>df.tmp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Vanilla =</span> w1, <span class="at">Binary =</span> w2)</span>
<span id="cb136-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb136-4" aria-hidden="true" tabindex="-1"></a>funs <span class="ot">&lt;-</span> <span class="fu">list</span>(mean, stdev, kurtosis, skewness)</span>
<span id="cb136-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb136-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">sapply</span>(funs, mapply, df.tmp)</span>
<span id="cb136-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;$</span><span class="sc">\\</span><span class="st">sigma$&quot;</span>, <span class="st">&quot;skewness&quot;</span>,</span>
<span id="cb136-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb136-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;kurtosis&quot;</span>)</span>
<span id="cb136-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb136-8" aria-hidden="true" tabindex="-1"></a>xm <span class="ot">&lt;-</span> <span class="fu">xtable</span>(res)</span></code></pre></div>
% latex table generated in R 4.2.2 by xtable 1.8-4 package
% Sun Jan 15 22:58:19 2023
</div>
</div>
<div id="hedging-error-due-to-transaction-cost" class="section level2" number="11.3">
<h2><span class="header-section-number">11.3</span> Hedging Error due to Transaction Cost</h2>
<p>Let <span class="math inline">\(S_t\)</span> be the mid price of the underlying asset and <span class="math inline">\(k\)</span> the
proportional transaction cost: the hedger buys at the ask price:
<span class="math display">\[S_t^a = S_t (1+\frac{k}{2})\]</span></p>
<p>and sells at the bid: <span class="math display">\[S_t^a = S_t (1-\frac{k}{2})\]</span></p>
<p>Clearly, transaction costs increase the cost of replication. To
compensate for that, one needs to start with a higher budget, that is,
the option seller should change a higher option premium than the one
given by the Black-Scholes model. This higher option premium can be
obtained in the Black-Scholes framework by increasing volatility.
<span class="citation">Leland (<label for="tufte-mn-7" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-7" class="margin-toggle">1985<span class="marginnote">Leland, H E. 1985. <span>“<span class="nocase">Option Pricing and Replication with Transactions Costs</span>.”</span> <em>The Journal of Finance</em> 40 (5): 1283–1301.</span>)</span> shows that one can adjust the Black-Scholes volatility as
follows:</p>
<p><span class="math display">\[\sigma^{+2} = \sigma^2 \left( 1+\sqrt{\frac{2}{\pi}} \frac{k}{\sigma \sqrt{\Delta t}}\right)\]</span></p>
<p>where <span class="math inline">\(\sigma\)</span> is the Black-Scholes volatility, and <span class="math inline">\(\sigma+\)</span> the
volatility adjusted for transaction costs.</p>
<div id="empirical-test-1" class="section level3" number="11.3.1">
<h3><span class="header-section-number">11.3.1</span> Empirical Test</h3>
<p>To test Leland’s formula, we simulate the delta-hedging of a
at-the-money European option, struck at 100, for transaction costs <span class="math inline">\(k\)</span>
ranging from <span class="math inline">\(0\)</span> to <span class="math inline">\(1\%\)</span>. The simulation is performed as follows:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-1" aria-hidden="true" tabindex="-1"></a>tr.range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb137-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-2" aria-hidden="true" tabindex="-1"></a>nbSteps <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb137-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-4" aria-hidden="true" tabindex="-1"></a>dtSim <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.timeDate</span>(dtStart), <span class="fu">as.timeDate</span>(dtExpiry),</span>
<span id="cb137-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">length.out =</span> nbSteps <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb137-6"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-7" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">as.double</span>(dtExpiry <span class="sc">-</span> dtStart)<span class="sc">/</span>(<span class="dv">365</span> <span class="sc">*</span> nbSteps)</span>
<span id="cb137-8"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-9"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co"># price paths</span></span>
<span id="cb137-10"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-10" aria-hidden="true" tabindex="-1"></a>tSpot <span class="ot">&lt;-</span> <span class="fu">pathSimulator</span>(<span class="at">dtSim =</span> dtSim, <span class="at">nbPaths =</span> nbPaths,</span>
<span id="cb137-11"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">innovations.gen =</span> sobolInnovations, <span class="at">path.gen =</span> logNormal,</span>
<span id="cb137-12"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">path.param =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> sigma),</span>
<span id="cb137-13"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">S0 =</span> <span class="dv">100</span>, <span class="at">antithetic =</span> <span class="cn">FALSE</span>, <span class="at">standardization =</span> <span class="cn">TRUE</span>,</span>
<span id="cb137-14"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb137-15"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-16"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-16" aria-hidden="true" tabindex="-1"></a><span class="co"># derived environment for scenario analysis</span></span>
<span id="cb137-17"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-17" aria-hidden="true" tabindex="-1"></a>sce.env <span class="ot">&lt;-</span> <span class="fu">DataProvider</span>(<span class="at">parent =</span> base.env)</span>
<span id="cb137-18"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-18" aria-hidden="true" tabindex="-1"></a><span class="fu">setData</span>(sce.env, underlying, <span class="st">&quot;Price&quot;</span>, <span class="fu">time</span>(tSpot),</span>
<span id="cb137-19"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(tSpot))</span>
<span id="cb137-20"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-21"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-21" aria-hidden="true" tabindex="-1"></a>mean.error <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> tr.range</span>
<span id="cb137-22"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-22" aria-hidden="true" tabindex="-1"></a>sd.error <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">*</span> tr.range</span>
<span id="cb137-23"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-24"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(tr.range)) {</span>
<span id="cb137-25"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-26"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate a delta-hedge strategy along</span></span>
<span id="cb137-27"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># each path</span></span>
<span id="cb137-28"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-29"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-29" aria-hidden="true" tabindex="-1"></a>    assets <span class="ot">=</span> <span class="fu">list</span>(a)</span>
<span id="cb137-30"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-30" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">deltaHedge</span>(assets, sce.env, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">dtSim =</span> <span class="fu">time</span>(tSpot),</span>
<span id="cb137-31"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">transaction.cost =</span> tr.range[i]<span class="sc">/</span><span class="dv">2</span>), <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb137-32"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-33"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-33" aria-hidden="true" tabindex="-1"></a>    expiry.error <span class="ot">&lt;-</span> <span class="fu">tail</span>(res<span class="sc">$</span>wealth, <span class="dv">1</span>)</span>
<span id="cb137-34"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-35"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-35" aria-hidden="true" tabindex="-1"></a>    mean.error[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(expiry.error)</span>
<span id="cb137-36"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-36" aria-hidden="true" tabindex="-1"></a>    sd.error[i] <span class="ot">&lt;-</span> <span class="fu">sd</span>(<span class="fu">as.vector</span>(expiry.error))</span>
<span id="cb137-37"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb137-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We next compare the expected hedging error to the value predicted by
Leland’s formula. To do so, we convert the expected hedging error into a
volatility adjustment, using the first order approximation:</p>
<p><span class="math display">\[P(\sigma) = P(\sigma^*) + (\sigma-\sigma^*) \frac{\partial P}{\partial \sigma}\]</span></p>
<p>where <span class="math inline">\(P(\sigma)\)</span> is the price of the option with volatility <span class="math inline">\(\sigma\)</span>.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb138-1" aria-hidden="true" tabindex="-1"></a>sigma.leland <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">/</span>pi) <span class="sc">*</span></span>
<span id="cb138-2"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb138-2" aria-hidden="true" tabindex="-1"></a>    (tr.range<span class="sc">/</span>(sigma <span class="sc">*</span> <span class="fu">sqrt</span>(dt))))</span>
<span id="cb138-3"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb138-4" aria-hidden="true" tabindex="-1"></a>vega <span class="ot">&lt;-</span> <span class="fu">getValue</span>(a, <span class="st">&quot;Vega&quot;</span>, dtStart, base.env)</span>
<span id="cb138-5"><a href="dynamic-hedging-in-the-black-scholes-framework.html#cb138-5" aria-hidden="true" tabindex="-1"></a>sigma.sim <span class="ot">&lt;-</span> sigma <span class="sc">-</span> mean.error<span class="sc">/</span>vega</span></code></pre></div>
<p>The results are presented in Figure <span class="math display">\[fig:delta-leland\]</span>. We find very
good agreement between the empirical result and Leland’s formula.</p>
<p><img src="305-BS-DynamicHedging_files/figure-html/Leland-plot-1.png" width="672"  /></p>
<p><img src="305-BS-DynamicHedging_files/figure-html/fig-Leland-1.png" width="480"  /></p>
</div>
</div>
<div id="hedging-error-due-to-unknown-volatility" class="section level2" number="11.4">
<h2><span class="header-section-number">11.4</span> Hedging Error due to Unknown Volatility</h2>
<p>The strongest assumption of the Black-Scholes model is arguably the
assumption that volatility is known and constant. we next investigate
the impact of unknown volatility of hedging error, following a landmark
paper by <span class="citation">(<a href="#ref-Karoui1998" role="doc-biblioref"><strong>Karoui1998?</strong></a>)</span>.</p>
<p>To simplify the notation, assume now that hedging is done continuously,
but that the volatility of the underlying asset is unknown. The dynamic
of the underlying asset is:</p>
<p><span class="math display">\[dS_t = \mu dt + \sigma_t dW_t\]</span></p>
<p>The derivative is priced with an estimated volatility <span class="math inline">\(\Sigma\)</span>.</p>
<p>The dynamic of the hedge portfolio is:</p>
<p><span class="math display">\[dV_t = \frac{\partial C_t^\Sigma}{\partial S_t} dS_t\]</span></p>
<p>By Itô’s lemma:</p>
<p><span class="math display">\[dC(S_t, t) = \left( \frac{\partial C}{\partial t} + \frac{1}{2} \frac{\partial^2 C}{\partial S^2} \sigma_t^2 S_t^2 \right) dt + \frac{\partial C}{\partial S} dS_t\]</span></p>
<p>The price of the derivative verifies the Black-Scholes EDP:</p>
<p><span class="math display">\[\frac{\partial C}{\partial t} + \frac{1}{2} \Sigma^2 S_t^2 \frac{\partial^2 C}{\partial S^2} = 0\]</span></p>
<p>this yields,</p>
<p><span class="math display">\[d \epsilon_t = dV_t - dC_t = \frac{1}{2} \left[ \Sigma^2 - \sigma_t^2 \right] \frac{\partial^2 C}{\partial S^2} S^2 dt\]</span></p>
<p>and the hedging error at expiry is thus,</p>
<p><span class="math display">\[\epsilon_T = \frac{1}{2} \int_0^T \left[ \Sigma^2 - \sigma_t^2 \right] \frac{\partial^2 C}{\partial S^2} S^2 dt\]</span></p>
<p>We identify three components in the above equation:</p>
<ol style="list-style-type: decimal">
<li><p>the nature of the option, characterized by its Gamma.</p></li>
<li><p>the behavior of the market, characterized by <span class="math inline">\(\sigma_t\)</span>,</p></li>
<li><p>the model calibration, summarized here by the Black-Scholes
volatility <span class="math inline">\(\Sigma\)</span></p></li>
</ol>
<p>If the Gamma keeps a constant sign, we can compute the fair value of the
Black-Scholes volatility that sets the expected hedging error to 0 is</p>
<p><span class="math display">\[\sigma_{BS}^2 = \frac{E\int_0^T \Gamma S^2 \frac{\Delta S}{S}^2}{E\int_0^T \Gamma_{BS} S^2 dt}\]</span></p>
<p>Equation (<span class="math display">\[eq:ElKaroui-JB-S\]</span>) also shows that, when the gamma keeps a
constant sign, we can choose a pricing volatility <span class="math inline">\(\Sigma\)</span> such that
<span class="math inline">\(E(\epsilon_T)\)</span> is positive.</p>
</div>
<div id="conclusion" class="section level2" number="11.5">
<h2><span class="header-section-number">11.5</span> Conclusion</h2>
<p>The experiments of this chapter highlight the crucial role of Gamma in
dynamic hedging. In short, the original Black-Scholes framework remains
adapted for options for which the Gamma does not change sign. This is
summarized in Table <span class="math display">\[tab:bs-adapted\]</span>. In such case, a positive
expected hedging error can be ensured by setting the pricing volatility
sufficiently high or low, as the case may be. Moreover, the Gamma of
these options often vanishes in deep in the money or out of the money
scenarios, and this renders of course the delta hedging strategy very
effective. This may explain why the Black-Scholes model remains so
widely used, despite its well documented shortcomings. Next chapter
describes a framework for dealing with Gamma risk, while remainning in
the Black-Scholes framework.</p>
<table>
<thead>
<tr class="header">
<th align="left">Payoff</th>
<th align="center">Is BS Adapted?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Vanilla</td>
<td align="center">Yes</td>
</tr>
<tr class="even">
<td align="left">European Binary</td>
<td align="center">No</td>
</tr>
<tr class="odd">
<td align="left">Up and Out Barrier</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="left">Asian</td>
<td align="center">Yes</td>
</tr>
</tbody>
</table>
</div>
<div id="second-order-hedging-2" class="section level2" number="11.6">
<h2><span class="header-section-number">11.6</span> Second-Order Hedging</h2>
<p>In the previous section, we have determined that hedging error is
determined by three factors: the hedging frequency, the magnitude of the
option gamma, and finally the difference between <span class="math inline">\(\Sigma\)</span> (the BS
volatility used for pricing and hedging) and the volatility that is
actually experienced, <span class="math inline">\(\sigma_t\)</span>.</p>
<p>In this section, we investigate strategies for controlling the risk
associated with the magnitude of the gamma.</p>

</div>
</div>
<p style="text-align: center;">
<a href="dynamic-hedging-with-the-black-scholes-model.html"><button class="btn btn-default">Previous</button></a>
<a href="the-implied-volatility.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
