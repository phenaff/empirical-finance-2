<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="13 Vanna-Volga Pricing and Hedging | Topics in Empirical Finance" />
<meta property="og:type" content="book" />
<meta property="og:image" content="/img/frontCover.pdf" />
<meta property="og:description" content="An open access textbook on empirical finance" />
<meta name="github-repo" content="phenaff/empirical-finance-2" />

<meta name="author" content="Patrick HÃ©naff" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="An open access textbook on empirical finance">

<title>13 Vanna-Volga Pricing and Hedging | Topics in Empirical Finance</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<!--
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@jweisber" />
<meta name="twitter:creator" content="@jweisber" />
<meta name="twitter:title" content="Odds &amp; Ends" />
<meta name="twitter:description" content="An open access textbook for introductory philosophy courses on probability and inductive logic." />
<meta name="twitter:image" content="img/social_image.png" />
-->


<!--
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["output/HTML-CSS"],
  "HTML-CSS": {
    availableFonts: ["Gyre-Pagella"],
    preferredFont: "Gyre-Pagella",
    webFont: "Gyre-Pagella",
    imageFont: "Gyre-Pagella"
  }
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
      extensions: ["color.js"]
    }
  });
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />
<link rel="stylesheet" href="custom.css" type="text/css" />

</head>

<body>


<div style="display: none;">
$$
  \newcommand{\given}{\mid}
  \renewcommand{\neg}{\mathbin{\sim}}
  \renewcommand{\wedge}{\mathbin{\&}}
  \newcommand{\p}{Pr}
  \newcommand{\degr}{^{\circ}}
  \newcommand{\E}{E}
  \newcommand{\EU}{EU}
  \newcommand{\u}{U}
  \newcommand{\pr}{Pr}
  \newcommand{\po}{Pr^*}
  \definecolor{bookred}{RGB}{228,6,19}
  \definecolor{bookblue}{RGB}{0,92,169}
  \definecolor{bookpurple}{RGB}{114,49,94} 
$$
</div>

<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#preface-to-the-second-edition">Preface to the second edition</a></li>
<li><a href="preface-to-the-first-edition.html#preface-to-the-first-edition">Preface to the first edition</a></li>
<li class="part"><span><b>Computational Framework</b></span></li>
<li class="has-sub"><a href="basic-components.html#basic-components"><span class="toc-section-number">1</span> Basic Components</a>
<ul>
<li class="has-sub"><a href="basic-components.html#the-class"><span class="toc-section-number">1.1</span> The Class</a>
<ul>
<li><a href="basic-components.html#illustration"><span class="toc-section-number">1.1.1</span> Illustration</a></li>
<li><a href="basic-components.html#design-and-implementation"><span class="toc-section-number">1.1.2</span> Design and Implementation</a></li>
</ul></li>
<li class="has-sub"><a href="basic-components.html#the-class-1"><span class="toc-section-number">1.2</span> The Class</a>
<ul>
<li><a href="basic-components.html#the-model-for-market-data"><span class="toc-section-number">1.2.1</span> The Model for Market Data</a></li>
<li><a href="basic-components.html#the-search-algorithm"><span class="toc-section-number">1.2.2</span> The Search Algorithm</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="sim-framework.html#sim-framework"><span class="toc-section-number">2</span> The Simulation Framework</a>
<ul>
<li><a href="sim-framework.html#scenario-simulator"><span class="toc-section-number">2.1</span> Scenario Simulator</a></li>
<li class="has-sub"><a href="sim-framework.html#a-delta-hedging-experiment"><span class="toc-section-number">2.2</span> A Delta Hedging Experiment</a>
<ul>
<li><a href="sim-framework.html#design-considerations"><span class="toc-section-number">2.2.1</span> Design Considerations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Discreet Models</b></span></li>
<li class="has-sub"><a href="arb-free-pricing.html#arb-free-pricing"><span class="toc-section-number">3</span> Arbitrage-Free Pricing and Risk Neutral Valuation</a>
<ul>
<li class="has-sub"><a href="arb-free-pricing.html#arbitrage-free-pricing"><span class="toc-section-number">3.1</span> Arbitrage-free Pricing</a>
<ul>
<li><a href="arb-free-pricing.html#arrow-debreu-securities"><span class="toc-section-number">3.1.1</span> Arrow-Debreu Securities</a></li>
<li><a href="arb-free-pricing.html#the-price-of-traded-securities"><span class="toc-section-number">3.1.2</span> The Price of Traded Securities</a></li>
<li><a href="arb-free-pricing.html#complete-market"><span class="toc-section-number">3.1.3</span> Complete Market</a></li>
<li><a href="arb-free-pricing.html#equivalent-probability-measures"><span class="toc-section-number">3.1.4</span> Equivalent Probability Measures</a></li>
<li><a href="arb-free-pricing.html#the-impact-of-interest-rate"><span class="toc-section-number">3.1.5</span> The Impact of Interest Rate</a></li>
<li><a href="arb-free-pricing.html#trading-strategy-and-dynamic-completeness"><span class="toc-section-number">3.1.6</span> Trading Strategy and Dynamic Completeness</a></li>
<li><a href="arb-free-pricing.html#discounted-asset-prices-as-martingales"><span class="toc-section-number">3.1.7</span> Discounted Asset Prices as Martingales</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="binomial.html#binomial"><span class="toc-section-number">4</span> Risk-Neutral Pricing in a Binomial Framework</a>
<ul>
<li class="has-sub"><a href="binomial.html#introduction"><span class="toc-section-number">4.1</span> Introduction</a>
<ul>
<li><a href="binomial.html#subsec:binomial"><span class="toc-section-number">4.1.1</span> The Binomial Model for Stocks</a></li>
</ul></li>
<li><a href="binomial.html#pricing-with-arrow-debreu-securities"><span class="toc-section-number">4.2</span> Pricing With Arrow-Debreu Securities</a></li>
<li><a href="binomial.html#multi-period-binomial-model"><span class="toc-section-number">4.3</span> Multi-Period Binomial Model</a></li>
<li><a href="binomial.html#american-exercise"><span class="toc-section-number">4.4</span> American Exercise</a></li>
<li class="has-sub"><a href="binomial.html#calibration-of-the-binomial-model"><span class="toc-section-number">4.5</span> Calibration of the Binomial Model</a>
<ul>
<li><a href="binomial.html#tree-geometry"><span class="toc-section-number">4.5.1</span> Tree Geometry</a></li>
</ul></li>
</ul></li>
<li><a href="stability-of-the-binomial-model.html#stability-of-the-binomial-model"><span class="toc-section-number">5</span> Stability of the Binomial Model</a></li>
<li class="has-sub"><a href="sec:trinomial.html#sec:trinomial"><span class="toc-section-number">6</span> Trinomial Models</a>
<ul>
<li><a href="sec:trinomial.html#the-trinomial-tree"><span class="toc-section-number">6.1</span> The Trinomial Tree</a></li>
</ul></li>
<li class="part"><span><b>Derivatives in the Black-Scholes Framework</b></span></li>
<li class="has-sub"><a href="pricing-with-black-scholes.html#pricing-with-black-scholes"><span class="toc-section-number">7</span> Pricing with Black-Scholes</a>
<ul>
<li><a href="pricing-with-black-scholes.html#relationships-among-greeks"><span class="toc-section-number">7.1</span> Relationships Among Greeks</a></li>
</ul></li>
<li class="has-sub"><a href="applicability-of-the-black-scholes-model.html#applicability-of-the-black-scholes-model"><span class="toc-section-number">8</span> Applicability of the Black-Scholes Model</a>
<ul>
<li><a href="applicability-of-the-black-scholes-model.html#self-financing-replicating-portfolio"><span class="toc-section-number">8.1</span> Self-Financing Replicating Portfolio</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#hedging-error-due-to-discrete-hedging"><span class="toc-section-number">8.2</span> Hedging Error due to Discrete Hedging</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#error-due-to-unknown-volatility"><span class="toc-section-number">8.3</span> Error due to Unknown Volatility</a></li>
<li class="has-sub"><a href="applicability-of-the-black-scholes-model.html#second-order-hedging"><span class="toc-section-number">8.4</span> Second-Order Hedging</a>
<ul>
<li><a href="applicability-of-the-black-scholes-model.html#gamma-smoothing"><span class="toc-section-number">8.4.1</span> Gamma Smoothing</a></li>
<li><a href="applicability-of-the-black-scholes-model.html#dynamic-delta-gamma-hedge"><span class="toc-section-number">8.4.2</span> Dynamic Delta-Gamma hedge</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="price-and-greeks-in-the-black-scholes-model.html#price-and-greeks-in-the-black-scholes-model"><span class="toc-section-number">9</span> Price and Greeks in the Black-Scholes Model</a>
<ul>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#solving-the-pricing-equation"><span class="toc-section-number">9.1</span> Solving the Pricing Equation</a></li>
<li class="has-sub"><a href="price-and-greeks-in-the-black-scholes-model.html#an-option-dashboard"><span class="toc-section-number">9.2</span> An Option Dashboard</a>
<ul>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#vanilla-option"><span class="toc-section-number">9.2.1</span> Vanilla Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#binary-option"><span class="toc-section-number">9.2.2</span> Binary Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#barrier-option"><span class="toc-section-number">9.2.3</span> Barrier Option</a></li>
<li><a href="price-and-greeks-in-the-black-scholes-model.html#asian-option"><span class="toc-section-number">9.2.4</span> Asian Option</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-with-the-black-scholes-model.html#dynamic-hedging-with-the-black-scholes-model"><span class="toc-section-number">10</span> Dynamic Hedging with the Black-Scholes Model</a>
<ul>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#self-financing-replicating-portfolio-1"><span class="toc-section-number">10.1</span> Self-Financing Replicating Portfolio</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#hedging-error-due-to-discrete-hedging-1"><span class="toc-section-number">10.2</span> Hedging Error due to Discrete Hedging</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#error-due-to-unknown-volatility-1"><span class="toc-section-number">10.3</span> Error due to Unknown Volatility</a></li>
<li class="has-sub"><a href="dynamic-hedging-with-the-black-scholes-model.html#second-order-hedging-1"><span class="toc-section-number">10.4</span> Second-Order Hedging</a>
<ul>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#gamma-smoothing-1"><span class="toc-section-number">10.4.1</span> Gamma Smoothing</a></li>
<li><a href="dynamic-hedging-with-the-black-scholes-model.html#dynamic-delta-gamma-hedge-1"><span class="toc-section-number">10.4.2</span> Dynamic Delta-Gamma hedge</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#dynamic-hedging-in-the-black-scholes-framework"><span class="toc-section-number">11</span> Dynamic Hedging in the Black-Scholes Framework</a>
<ul>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#self-financing-replicating-portfolio-2"><span class="toc-section-number">11.1</span> Self-Financing Replicating Portfolio</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#continuous-rebalancing"><span class="toc-section-number">11.1.1</span> Continuous rebalancing</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#discreet-rebalancing"><span class="toc-section-number">11.1.2</span> Discreet rebalancing</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#illustration-1"><span class="toc-section-number">11.1.3</span> Illustration</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#a-more-realistic-example"><span class="toc-section-number">11.1.4</span> A More Realistic Example</a></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-discrete-hedging-2"><span class="toc-section-number">11.2</span> Hedging Error due to Discrete Hedging</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#empirical-test"><span class="toc-section-number">11.2.1</span> Empirical Test</a></li>
</ul></li>
<li class="has-sub"><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-transaction-cost"><span class="toc-section-number">11.3</span> Hedging Error due to Transaction Cost</a>
<ul>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#empirical-test-1"><span class="toc-section-number">11.3.1</span> Empirical Test</a></li>
</ul></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#hedging-error-due-to-unknown-volatility"><span class="toc-section-number">11.4</span> Hedging Error due to Unknown Volatility</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#conclusion"><span class="toc-section-number">11.5</span> Conclusion</a></li>
<li><a href="dynamic-hedging-in-the-black-scholes-framework.html#second-order-hedging-2"><span class="toc-section-number">11.6</span> Second-Order Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="the-implied-volatility.html#the-implied-volatility"><span class="toc-section-number">12</span> The implied volatility</a>
<ul>
<li><a href="the-implied-volatility.html#market-data"><span class="toc-section-number">12.1</span> Market Data</a></li>
<li class="has-sub"><a href="the-implied-volatility.html#calculation-of-implied-volatility"><span class="toc-section-number">12.2</span> Calculation of implied volatility</a>
<ul>
<li><a href="the-implied-volatility.html#newtons-method"><span class="toc-section-number">12.2.1</span> Newtonâs method</a></li>
<li><a href="the-implied-volatility.html#implied-volatility-by-newtons-method"><span class="toc-section-number">12.2.2</span> Implied Volatility by Newtonâs Method</a></li>
<li><a href="the-implied-volatility.html#secant-method"><span class="toc-section-number">12.2.3</span> Secant Method</a></li>
<li><a href="the-implied-volatility.html#jaeckels-method"><span class="toc-section-number">12.2.4</span> Jaeckelâs method</a></li>
<li><a href="the-implied-volatility.html#normalized-call-price-as-a-function-of-sigma"><span class="toc-section-number">12.2.5</span> Normalized Call price as a function of <span class="math inline">\(\sigma\)</span></a></li>
<li><a href="the-implied-volatility.html#transformed-objective-function"><span class="toc-section-number">12.2.6</span> Transformed objective function</a></li>
<li><a href="the-implied-volatility.html#impact-of-dividends"><span class="toc-section-number">12.2.7</span> Impact of Dividends</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-pricing-and-hedging"><span class="toc-section-number">13</span> Vanna-Volga Pricing and Hedging</a>
<ul>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#principle"><span class="toc-section-number">13.1</span> Principle</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-dynamic-hedging"><span class="toc-section-number">13.1.1</span> Vanna-Volga Dynamic Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#implementation"><span class="toc-section-number">13.2</span> Implementation</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#vanna-volga-dynamic-hedging-1"><span class="toc-section-number">13.2.1</span> Vanna-Volga Dynamic Hedging</a></li>
</ul></li>
<li class="has-sub"><a href="vanna-volga-pricing-and-hedging.html#illustrations"><span class="toc-section-number">13.3</span> Illustrations</a>
<ul>
<li><a href="vanna-volga-pricing-and-hedging.html#volatility-interpolation"><span class="toc-section-number">13.3.1</span> Volatility Interpolation</a></li>
<li><a href="vanna-volga-pricing-and-hedging.html#pricing-a-binary-option"><span class="toc-section-number">13.3.2</span> Pricing a Binary Option</a></li>
</ul></li>
</ul></li>
<li><a href="bibliography.html#bibliography"><span class="toc-section-number">14</span> Bibliography</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="vanna-volga-pricing-and-hedging" class="section level1" number="13">
<h1><span class="header-section-number">13</span> Vanna-Volga Pricing and Hedging</h1>
<pre><code>## Loading required package: timeDate</code></pre>
<pre><code>## Loading required package: timeSeries</code></pre>
<pre><code>## Loading required package: fBasics</code></pre>
<pre><code>## Loading required package: fAsianOptions</code></pre>
<pre><code>## Loading required package: lubridate</code></pre>
<pre><code>## Loading required package: timechange</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<pre><code>## Loading required package: Hmisc</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## Loading required package: survival</code></pre>
<pre><code>## Loading required package: Formula</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## 
## Attaching package: &#39;Hmisc&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     format.pval, units</code></pre>
<pre><code>## Loading required package: xtable</code></pre>
<pre><code>## 
## Attaching package: &#39;xtable&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:Hmisc&#39;:
## 
##     label, label&lt;-</code></pre>
<pre><code>## The following object is masked from &#39;package:timeSeries&#39;:
## 
##     align</code></pre>
<pre><code>## The following object is masked from &#39;package:timeDate&#39;:
## 
##     align</code></pre>
<pre><code>## Loading required package: empfin</code></pre>
<pre><code>## Loading required package: fImport</code></pre>
<pre><code>## Loading required package: RCurl</code></pre>
<p><span><em>If you want to know the value of a security, use the price of another<br />
security thatâs similar to it. All the rest is strategy.</em></span><br />
E. Derman</p>
<p>This chapter presents a practical method for pricing and hedging
derivatives, taking into account an uncertain volatility. This method is
very popular for Foreign Exchange derivatives, but beyond that it
illustrates an important principle of asset pricing, which is to relate
the price of a complex derivative to the known price of simpler, liquid
instruments.</p>
<div id="principle" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Principle</h2>
<p>Assume a Ito dynamic for volatility, and consider a derivative security
<span class="math inline">\(O(t)\)</span>, which is now subject to two sources of randomness: the
underlying asset <span class="math inline">\(S_t\)</span> and the volatility <span class="math inline">\(\sigma_t\)</span>. An extended
version of Itoâs lemma give: <span class="math display">\[\begin{aligned}
  dO(t,K) &amp;=&amp; \frac{\partial O}{\partial t} dt + \frac{\partial O}{\partial S} dS_t + \frac{\partial O}{\partial \sigma} d\sigma_t \\
  &amp; &amp; + \frac{\partial^2 O}{\partial S^2} (dS_t)^2 + \frac{\partial^2 O}{\partial \sigma^2} (d\sigma_t)^2 + \frac{\partial^2 O}{\partial S \partial \sigma} dS_t d\sigma_t\end{aligned}\]</span></p>
<p>We now construct a portfolio made of option <span class="math inline">\(O(t,K)\)</span>, and a hedge made
of <span class="math inline">\(\Delta_t\)</span> units of the underlying asset and 3 delta-hedged vanilla
options <span class="math inline">\(C_i(t,K_i)\)</span>:</p>
<p><span class="math display">\[\begin{aligned}
  \lefteqn{dO(t,K) - \Delta_t dS_t - \sum_{i=1}^3 x_i dC_i(t,K_i) =} \\
  &amp;&amp; \left[ \frac{\partial O}{\partial t} - \sum_i x_i \frac{\partial C_i}{\partial t}  \right] dt  \\
  &amp;&amp; + \left[ \frac{\partial O}{\partial S} - \Delta_t - \sum_i x_i \frac{\partial C_i}{\partial S}  \right] dS_t \\
  &amp;&amp; + \left[ \frac{\partial O}{\partial \sigma} - \sum_i x_i \frac{\partial C_i}{\partial \sigma}  \right] d\sigma_t \\
  &amp;&amp; + \frac{1}{2} \left[ \frac{\partial^2 O}{\partial S^2} - \sum_i x_i \frac{\partial^2 C_i}{\partial S^2}  \right] (dS_t)^2 \\
  &amp;&amp; + \frac{1}{2} \left[ \frac{\partial^2 O}{\partial \sigma^2} - \sum_i x_i \frac{\partial^2 C_i}{\partial \sigma^2}  \right] (d\sigma_t)^2  \\
  &amp;&amp; + \left[ \frac{\partial^2 O}{\partial S \partial \sigma} - \sum_i x_i \frac{\partial^2 C_i}{\partial S \partial \sigma}  \right] dS_t d\sigma_t
\end{aligned}\]</span></p>
<p>We can choose <span class="math inline">\(\Delta_t\)</span> and <span class="math inline">\(x_i\)</span> to zero out the terms
<span class="math inline">\(dS_t, d\sigma_t, (d\sigma_t)^2\)</span> and <span class="math inline">\(dS_t d\sigma_t\)</span>. We are left with:</p>
<p><span class="math display">\[\begin{aligned}
  \lefteqn{dO(t,K) - \Delta_t dS_t - \sum_{i=1}^3 x_i dC_i(t,K_i) =} \\
  &amp;&amp; \left[ \frac{\partial O}{\partial t} - \sum_i x_i \frac{\partial C_i}{\partial t}  \right] dt \\
  &amp;&amp; +\frac{1}{2} \left[ \frac{\partial^2 O}{\partial S^2} - \sum_i x_i \frac{\partial^2 C_i}{\partial S^2}  \right] (dS_t)^2
\end{aligned}\]</span></p>
<p>Using the definition of <span class="math inline">\(dS_t\)</span> and retaining the first-order terms, we
have, for all securities function of <span class="math inline">\(S_t\)</span>:</p>
<p><span class="math display">\[\frac{\partial f}{\partial t} dt + \frac{1}{2} \frac{\partial^2 f}{\partial S^2} =
\left( \frac{\partial f}{\partial t} + \frac{1}{2} \frac{\partial^2 f}{\partial S^2} S_t^2 \sigma^2 \right) dt\]</span></p>
<p>Moreover, each asset satisfies the Black-Scholes PDE:
<span class="math display">\[\frac{\partial f}{\partial t} + rS_t \frac{\partial f}{\partial S} + \sigma^2 S^2 \frac{\partial^2 f}{\partial S^2} = rf\]</span></p>
<p>For each asset, <span class="math inline">\(\frac{\partial f}{\partial S}=0\)</span>, and we get:</p>
<p><span class="math display">\[\frac{\partial f}{\partial t} dt + \frac{1}{2} \frac{\partial^2 f}{\partial S^2} = rf dt\]</span></p>
<p>The hedged portfolio is thus riskless:</p>
<p><span class="math display">\[\begin{aligned}
  \lefteqn{dO(t,K) - \Delta_t dS_t - \sum_{i=1}^3 x_i dC_i(t,K_i) =} \nonumber \\
  &amp;&amp; r \left[ O(t,K) - \sum_i x_i C_i(t,K_i) \right] dt
\label{eq:vv-1}\end{aligned}\]</span></p>
<p>In summary, we can still have a locally perfect hedge when volatility is
stochastic, as long as the prices <span class="math inline">\(O(t,K)\)</span> and <span class="math inline">\(C_I(t,K_i)\)</span> follow the
Black-Scholes equation.</p>
<p>Discretize equationÂ <span class="math display">\[eq:vv-1\]</span> at time <span class="math inline">\(t=T-\delta t\)</span>, where <span class="math inline">\(T\)</span> is the
option expiry. We get:</p>
<p><span class="math display">\[\begin{aligned}
&amp; &amp; O(T, K) - O(t, K) - \Delta_t (S_T-S_t) - \sum_i x_i(t) \left[C_i(T, K_i) - C_i(t,K_i) \right] = \\
&amp; &amp; r \left[ O(t,K) - \Delta_t S_t - \sum_i x_i(t) C(t,K_i) \right] \delta t\end{aligned}\]</span></p>
<p>Up to now, we have assumed that all assets are priced with the same
volatility <span class="math inline">\(\sigma_t\)</span>. In practice, we observe market prices
<span class="math inline">\(C_i^M(t,K_i)\)</span> that differ from the theoretical Black-Scholes prices
<span class="math inline">\(C_i(t,K_i)\)</span>. The hedge described above must be implemented with options
traded at market price. What are the implications for the price
<span class="math inline">\(O(t,K)\)</span>? An approximate argument is presented below; see <span class="citation">Shkolnikov (<label for="tufte-mn-9" class="margin-toggle">&#8853;</label><input type="checkbox" id="tufte-mn-9" class="margin-toggle">2009<span class="marginnote">Shkolnikov, Yuriy. 2009. <span>â<span class="nocase">Generalized Vanna-Volga Method and its Applications</span>.â</span> <em>NumeriX Research Paper</em>. <a href="http://ssrn.com/abstract=1186383">http://ssrn.com/abstract=1186383</a>.</span>)</span>
for a rigorous treatment.</p>
<p>Consider a hedged position at time <span class="math inline">\(T-\delta t\)</span>: long the exotic
derivative <span class="math inline">\(O\)</span> with market value <span class="math inline">\(O^M(t)\)</span> and short the hedge portfolio.
The value of the hedged position at expiry is:</p>
<p><span class="math display">\[W_T = O(T) - \Delta_t S_T - \sum_i x_i C_i(T) - r \left(O^M(t) - \sum_i x_i C^M_i(t) - \Delta S_t \right) \delta t\]</span></p>
<p>Set
<span class="math display">\[O^M(t,K) = O(t,K) + \sum_i x_i \left[ C^M_i(t,K_i) - C_i(t,K_i) \right]
\label{eq:vv-2}\]</span></p>
<p>to obtain <span class="math inline">\(W_T = 0\)</span>.</p>
<p>In summary, if we have a wealth <span class="math inline">\(O^M(t,K)\)</span> defined byÂ <span class="math display">\[eq:vv-2\]</span> at
time <span class="math inline">\(T-\delta t\)</span>, then we can replicate the payoff <span class="math inline">\(O(T,K)\)</span> at expiry,
with a hedge at market price. The argument made on the interval
<span class="math inline">\([T-\delta t, T]\)</span> can be applied by backward recursion for each time
interval until <span class="math inline">\(t=0\)</span>.</p>
<p>We have both a hedging strategy and a process for adjusting the price of
any derivative to account for the smile. letâs now consider some
implementation details.</p>
<div id="vanna-volga-dynamic-hedging" class="section level3" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Vanna-Volga Dynamic Hedging</h3>
<p><span class="math display">\[\begin{aligned}
O(T,K) &amp;= &amp;O^M(t,K) + \Delta_t (S_T-S_t) \\
&amp;+&amp; \sum_i x_i \left[C_i(T, K_i) - C_i^M(t, K_i) \right] \\
&amp;+&amp; r \left[ O(t,K) - \Delta_t S_t - \sum_i x_i C_i^M(t,K_i) \right] \end{aligned}\]</span></p>
<p>If we have a wealth <span class="math inline">\(O(t,K)\)</span> at time <span class="math inline">\(T-\delta t\)</span>, then we can replicate
the payoff <span class="math inline">\(O(T,K)\)</span> at expiry, with a hedge at market price.</p>
</div>
</div>
<div id="implementation" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Implementation</h2>
<p>The weights <span class="math inline">\(x_i\)</span> are obtained by solving the system of linear
equations:</p>
<p><span class="math display">\[\begin{aligned}
\frac{\partial O}{\partial \sigma} &amp;=&amp; \sum_i x_i \frac{\partial C_i}{\partial \sigma} \\
\frac{\partial^2 O}{\partial \sigma^2} &amp;=&amp; \sum_i x_i \frac{\partial^2 C_i}{\partial \sigma^2} \\
\frac{\partial^2 O}{\partial S \partial \sigma} &amp;=&amp; \sum_i x_i \frac{\partial^2 C_i}{\partial S \partial \sigma}\end{aligned}\]</span></p>
<p>or, <span class="math display">\[b = Ax
\label{eq:A-matrix}\]</span></p>
<p>Since the result of the previous section holds for any derivative that
verifies the Black-Scholes equation, we can choose the benchmark
securities <span class="math inline">\(C_i(t,K_i)\)</span> as we see fit.</p>
<p>A popular set of benchmark securities, commonly used in the FX market is
described next. To simplify notation, we denote <span class="math inline">\(C(K), P(K)\)</span> the call
and put of strike <span class="math inline">\(K\)</span>, maturity <span class="math inline">\(T\)</span>:</p>
<ul>
<li><p>An at-the-money straddle: <span class="math display">\[C_1 = C(S) + P(S)\]</span></p></li>
<li><p>A ârisk reversalâ, traditionally defined as
<span class="math display">\[C_2 = P(K_1) - C(K_2)\]</span> with <span class="math inline">\(K_1\)</span> and <span class="math inline">\(K_2\)</span> chosen so that the
options have a Delta of .25 in absolute value.</p></li>
<li><p>A âbutterflyâ, defined as
<span class="math display">\[C_3 = \beta ( P(K_1) + C(K_2) ) -(P(S)+C(S))\]</span> with <span class="math inline">\(\beta\)</span>
determined to set the Vega of the butterfly to 0.</p></li>
</ul>
<p>This system is popular because the benchmark securities are very liquid,
and because the resulting <span class="math inline">\(A\)</span> matrix of (<span class="math display">\[eq:A-matrix\]</span>) is almost
diagonal, which allows an intuitive interpretation of the coefficients
<span class="math inline">\(x_i\)</span>.</p>
<p>To summarize, the calculation steps for pricing an option, taking the
smile cost into account, are as follows:</p>
<ol style="list-style-type: decimal">
<li><p>compute the risk indicators for the option <span class="math inline">\(O\)</span> to be priced:
<span class="math display">\[b =  \begin{pmatrix}
          \frac{\partial O}{\partial \sigma} \\
          \frac{\partial^2 O}{\partial \sigma^2} \\
          \frac{\partial^2 O}{\partial \sigma \partial S}
        \end{pmatrix}\]</span></p></li>
<li><p>compute the A matrix <span class="math display">\[A =
      \begin{pmatrix}
          \frac{\partial C_1}{\partial \sigma} &amp; \ldots &amp; \frac{\partial C_3}{\partial \sigma}\\
          \frac{\partial^2 C_1}{\partial \sigma^2} &amp; \ldots &amp; \frac{\partial^2 C_3}{\partial \sigma^2}  \\
          \frac{\partial^2 C_1}{\partial \sigma \partial S}
&amp; \ldots &amp; \frac{\partial^2 C_3}{\partial \sigma \partial S}
\end{pmatrix}\]</span></p></li>
<li><p>solve for <span class="math inline">\(x\)</span>: <span class="math display">\[b = Ax\]</span></p></li>
<li><p>the corrected price for <span class="math inline">\(O\)</span> is:
<span class="math display" id="eq:vv-4">\[O^M(t,K) = O^{BS}(t,K) + \sum_{i=2}^3 x_i \left( C_i^M(t) - C_i^{BS}(t) \right)
        \tag{13.1}\]</span>
where <span class="math inline">\(C^M_i(t)\)</span> is the market price and
<span class="math inline">\(C^{BS}_i(t)\)</span> the Black-Scholes price (i.e.Â with flat volatility).</p></li>
</ol>
<p>The term in <span class="math inline">\(x_1\)</span> is omitted in <a href="vanna-volga-pricing-and-hedging.html#eq:vv-4">(13.1)</a> since, by definition,
the Black-Scholes price and market price of an ATM straddle are
identical.</p>
<p>Neglecting the off diagonal terms in <span class="math inline">\(A\)</span>, a simplified procedure is to
estimate <span class="math inline">\(x_i\)</span> by: <span class="math display">\[\begin{aligned}
  x_2 &amp;=&amp; \frac{\frac{\partial^2 O}{\partial \sigma^2}}{\frac{\partial^2 C_2}{\partial \sigma^2}} \\
  x_3 &amp;=&amp;  \frac{\frac{\partial^2 O}{\partial \sigma \partial S}}{\frac{\partial^2 C_3}{\partial \sigma \partial S}}\end{aligned}\]</span></p>
<p>In practice, the weights <span class="math inline">\(x_i\)</span> are scaled to better fit market prices.</p>
<div id="vanna-volga-dynamic-hedging-1" class="section level3" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Vanna-Volga Dynamic Hedging</h3>
<p>Neglecting the off diagonal terms in <span class="math inline">\(A\)</span>, a simplified procedure is to
estimate <span class="math inline">\(x_i\)</span> by: <span class="math display">\[\begin{aligned}
  x_2 &amp;=&amp; \frac{\frac{\partial^2 O}{\partial \sigma^2}}{\frac{\partial^2 C_2}{\partial \sigma^2}} \\
  x_3 &amp;=&amp;  \frac{\frac{\partial^2 O}{\partial \sigma \partial S}}{\frac{\partial^2 C_3}{\partial \sigma \partial S}}\end{aligned}\]</span></p>
<p>In practice, the weights <span class="math inline">\(x_i\)</span> are scaled to better fit market prices.</p>
</div>
</div>
<div id="illustrations" class="section level2" number="13.3">
<h2><span class="header-section-number">13.3</span> Illustrations</h2>
<div id="volatility-interpolation" class="section level3" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Volatility Interpolation</h3>
<p>The simplest use of this method is volality interpolation. Given the ATM
volatility and at two other strikes, we want to determine the volatility
at an arbitrary strike <span class="math inline">\(K\)</span>.</p>
<p>The process is illustrated below, with the market data summarized in
TableÂ <span class="math display">\[tab:vv-1\]</span> for European options with maturity <span class="math inline">\(T=1\)</span> year.
Interest rate is set to 0 for simplicity.</p>
<p>Volatility data is summarized in TableÂ <span class="math display">\[tab:vv-1\]</span>.</p>
<table>
<thead>
<tr class="header">
<th align="center">Strike</th>
<th align="center">Volatility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">80</td>
<td align="center">.32</td>
</tr>
<tr class="even">
<td align="center">100</td>
<td align="center">.30</td>
</tr>
<tr class="odd">
<td align="center">120</td>
<td align="center">.315</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="vanna-volga-pricing-and-hedging.html#cb192-1" aria-hidden="true" tabindex="-1"></a>  T <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb192-2"><a href="vanna-volga-pricing-and-hedging.html#cb192-2" aria-hidden="true" tabindex="-1"></a>  Spot <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb192-3"><a href="vanna-volga-pricing-and-hedging.html#cb192-3" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb192-4"><a href="vanna-volga-pricing-and-hedging.html#cb192-4" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb192-5"><a href="vanna-volga-pricing-and-hedging.html#cb192-5" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> .<span class="dv">001</span></span>
<span id="cb192-6"><a href="vanna-volga-pricing-and-hedging.html#cb192-6" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> .<span class="dv">3</span></span>
<span id="cb192-7"><a href="vanna-volga-pricing-and-hedging.html#cb192-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-8"><a href="vanna-volga-pricing-and-hedging.html#cb192-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Benchmark data: (strike, volatility)</span></span>
<span id="cb192-9"><a href="vanna-volga-pricing-and-hedging.html#cb192-9" aria-hidden="true" tabindex="-1"></a>  VolData <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">80</span>, .<span class="dv">32</span>), <span class="fu">c</span>(<span class="dv">100</span>, .<span class="dv">30</span>), <span class="fu">c</span>(<span class="dv">120</span>, .<span class="dv">315</span>))</span></code></pre></div>
<p>Define an array of pricing functions for the three benchmark
instruments:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="vanna-volga-pricing-and-hedging.html#cb193-1" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb193-2"><a href="vanna-volga-pricing-and-hedging.html#cb193-2" aria-hidden="true" tabindex="-1"></a>         <span class="cf">function</span>(<span class="at">vol=</span>sigma, <span class="at">spot=</span>Spot) <span class="fu">GBSOption</span>(<span class="at">TypeFlag=</span><span class="st">&#39;c&#39;</span>, <span class="at">S=</span>spot, <span class="at">X=</span>VolData[[<span class="dv">1</span>]][<span class="dv">1</span>], <span class="at">Time=</span>T, <span class="at">r=</span>r, <span class="at">b=</span>b, <span class="at">sigma=</span>vol)<span class="sc">@</span>price,</span>
<span id="cb193-3"><a href="vanna-volga-pricing-and-hedging.html#cb193-3" aria-hidden="true" tabindex="-1"></a>         <span class="cf">function</span>(<span class="at">vol=</span>sigma, <span class="at">spot=</span>Spot) <span class="fu">GBSOption</span>(<span class="at">TypeFlag=</span><span class="st">&#39;c&#39;</span>, <span class="at">S=</span>spot, <span class="at">X=</span>VolData[[<span class="dv">2</span>]][<span class="dv">1</span>], <span class="at">Time=</span>T, <span class="at">r=</span>r, <span class="at">b=</span>b, <span class="at">sigma=</span>vol)<span class="sc">@</span>price,</span>
<span id="cb193-4"><a href="vanna-volga-pricing-and-hedging.html#cb193-4" aria-hidden="true" tabindex="-1"></a>         <span class="cf">function</span>(<span class="at">vol=</span>sigma, <span class="at">spot=</span>Spot) <span class="fu">GBSOption</span>(<span class="at">TypeFlag=</span><span class="st">&#39;c&#39;</span>, <span class="at">S=</span>spot, <span class="at">X=</span>VolData[[<span class="dv">3</span>]][<span class="dv">1</span>], <span class="at">Time=</span>T, <span class="at">r=</span>r, <span class="at">b=</span>b, <span class="at">sigma=</span>vol)<span class="sc">@</span>price)</span></code></pre></div>
<p>Next, define utility functions to compute the risk indicators, all by
finite difference:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="vanna-volga-pricing-and-hedging.html#cb194-1" aria-hidden="true" tabindex="-1"></a>  Vega <span class="ot">&lt;-</span> <span class="cf">function</span>(f, vol, <span class="at">spot=</span>Spot) (<span class="fu">f</span>(vol<span class="sc">+</span>eps, spot)<span class="sc">-</span><span class="fu">f</span>(vol<span class="sc">-</span>eps, spot))<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>eps)</span>
<span id="cb194-2"><a href="vanna-volga-pricing-and-hedging.html#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="vanna-volga-pricing-and-hedging.html#cb194-3" aria-hidden="true" tabindex="-1"></a>  Vanna <span class="ot">&lt;-</span> <span class="cf">function</span>(f, vol, <span class="at">spot=</span>Spot) {</span>
<span id="cb194-4"><a href="vanna-volga-pricing-and-hedging.html#cb194-4" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">Vega</span>(f, vol, spot<span class="sc">+</span><span class="dv">1</span>)<span class="sc">-</span><span class="fu">Vega</span>(f, vol, spot<span class="dv">-1</span>))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb194-5"><a href="vanna-volga-pricing-and-hedging.html#cb194-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-6"><a href="vanna-volga-pricing-and-hedging.html#cb194-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-7"><a href="vanna-volga-pricing-and-hedging.html#cb194-7" aria-hidden="true" tabindex="-1"></a>  Volga <span class="ot">&lt;-</span> <span class="cf">function</span>(f, vol) {</span>
<span id="cb194-8"><a href="vanna-volga-pricing-and-hedging.html#cb194-8" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">Vega</span>(f,vol<span class="sc">+</span>eps)<span class="sc">-</span><span class="fu">Vega</span>(f,vol<span class="sc">-</span>eps))<span class="sc">/</span>(eps)</span>
<span id="cb194-9"><a href="vanna-volga-pricing-and-hedging.html#cb194-9" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>Finally, the following function computes the Vanna-Volga adjustment to
the Black-Scholes price, and the corresponding implied volatility:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="vanna-volga-pricing-and-hedging.html#cb195-1" aria-hidden="true" tabindex="-1"></a>  VVVol <span class="ot">&lt;-</span> <span class="cf">function</span>(X) {</span>
<span id="cb195-2"><a href="vanna-volga-pricing-and-hedging.html#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="vanna-volga-pricing-and-hedging.html#cb195-3" aria-hidden="true" tabindex="-1"></a>  O <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">vol=</span>sigma, <span class="at">spot=</span>Spot) <span class="fu">GBSOption</span>(<span class="at">TypeFlag=</span><span class="st">&#39;c&#39;</span>, <span class="at">S=</span>spot,</span>
<span id="cb195-4"><a href="vanna-volga-pricing-and-hedging.html#cb195-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">X=</span>X, <span class="at">Time=</span>T, <span class="at">r=</span>r, <span class="at">b=</span>b, <span class="at">sigma=</span>vol)<span class="sc">@</span>price</span>
<span id="cb195-5"><a href="vanna-volga-pricing-and-hedging.html#cb195-5" aria-hidden="true" tabindex="-1"></a>  TV.BS <span class="ot">&lt;-</span> <span class="fu">O</span>()</span>
<span id="cb195-6"><a href="vanna-volga-pricing-and-hedging.html#cb195-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-7"><a href="vanna-volga-pricing-and-hedging.html#cb195-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># risk indicators for benchmark instruments</span></span>
<span id="cb195-8"><a href="vanna-volga-pricing-and-hedging.html#cb195-8" aria-hidden="true" tabindex="-1"></a>  B.vega <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="cf">function</span>(i) <span class="fu">Vega</span>(C[[i]], sigma))</span>
<span id="cb195-9"><a href="vanna-volga-pricing-and-hedging.html#cb195-9" aria-hidden="true" tabindex="-1"></a>  B.vanna <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="cf">function</span>(i) <span class="fu">Vanna</span>(C[[i]], sigma))</span>
<span id="cb195-10"><a href="vanna-volga-pricing-and-hedging.html#cb195-10" aria-hidden="true" tabindex="-1"></a>  B.volga <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="cf">function</span>(i) <span class="fu">Volga</span>(C[[i]], sigma))</span>
<span id="cb195-11"><a href="vanna-volga-pricing-and-hedging.html#cb195-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-12"><a href="vanna-volga-pricing-and-hedging.html#cb195-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># risk indicators for new option</span></span>
<span id="cb195-13"><a href="vanna-volga-pricing-and-hedging.html#cb195-13" aria-hidden="true" tabindex="-1"></a>  O.vega <span class="ot">&lt;-</span> <span class="fu">Vega</span>(O, sigma)</span>
<span id="cb195-14"><a href="vanna-volga-pricing-and-hedging.html#cb195-14" aria-hidden="true" tabindex="-1"></a>  O.vanna <span class="ot">&lt;-</span> <span class="fu">Vanna</span>(O, sigma)</span>
<span id="cb195-15"><a href="vanna-volga-pricing-and-hedging.html#cb195-15" aria-hidden="true" tabindex="-1"></a>  O.volga <span class="ot">&lt;-</span> <span class="fu">Volga</span>(O, sigma)</span>
<span id="cb195-16"><a href="vanna-volga-pricing-and-hedging.html#cb195-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-17"><a href="vanna-volga-pricing-and-hedging.html#cb195-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Benchmark costs</span></span>
<span id="cb195-18"><a href="vanna-volga-pricing-and-hedging.html#cb195-18" aria-hidden="true" tabindex="-1"></a>  B.cost <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="cf">function</span>(i) C[[i]](VolData[[i]][<span class="dv">2</span>]) <span class="sc">-</span> C[[i]](sigma))</span>
<span id="cb195-19"><a href="vanna-volga-pricing-and-hedging.html#cb195-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-20"><a href="vanna-volga-pricing-and-hedging.html#cb195-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculation of price adjustment</span></span>
<span id="cb195-21"><a href="vanna-volga-pricing-and-hedging.html#cb195-21" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(B.vega, B.vanna, B.volga),  <span class="at">nrow=</span><span class="dv">3</span>))</span>
<span id="cb195-22"><a href="vanna-volga-pricing-and-hedging.html#cb195-22" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(O.vega, O.vanna, O.volga), <span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb195-23"><a href="vanna-volga-pricing-and-hedging.html#cb195-23" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">&lt;-</span> <span class="fu">solve</span>(A, x)</span>
<span id="cb195-24"><a href="vanna-volga-pricing-and-hedging.html#cb195-24" aria-hidden="true" tabindex="-1"></a>  CF <span class="ot">&lt;-</span> <span class="fu">t</span>(w) <span class="sc">%*%</span> <span class="fu">matrix</span>(B.cost, <span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb195-25"><a href="vanna-volga-pricing-and-hedging.html#cb195-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-26"><a href="vanna-volga-pricing-and-hedging.html#cb195-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># implied volatility</span></span>
<span id="cb195-27"><a href="vanna-volga-pricing-and-hedging.html#cb195-27" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fu">GBSVolatility</span>(TV.BS<span class="sc">+</span>CF, <span class="st">&#39;c&#39;</span>, Spot, X, T, r, b, <span class="dv">1</span>.e<span class="dv">-5</span>)</span>
<span id="cb195-28"><a href="vanna-volga-pricing-and-hedging.html#cb195-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-29"><a href="vanna-volga-pricing-and-hedging.html#cb195-29" aria-hidden="true" tabindex="-1"></a>  v}</span></code></pre></div>
<p>We finally use the vanna-volga interpolating function to construct the
interpolated smile curve.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="vanna-volga-pricing-and-hedging.html#cb196-1" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="dv">70</span>, <span class="dv">130</span>, <span class="dv">2</span>), VVVol)</span>
<span id="cb196-2"><a href="vanna-volga-pricing-and-hedging.html#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">70</span>, <span class="dv">130</span>,<span class="dv">2</span>), v, <span class="at">type=</span><span class="st">&#39;l&#39;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">xlab=</span><span class="st">&#39;Strike&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;Implied Volatility&#39;</span>)</span>
<span id="cb196-3"><a href="vanna-volga-pricing-and-hedging.html#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(<span class="fu">sapply</span>(VolData, <span class="cf">function</span>(v) v[<span class="dv">1</span>]),</span>
<span id="cb196-4"><a href="vanna-volga-pricing-and-hedging.html#cb196-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sapply</span>(VolData, <span class="cf">function</span>(v) v[<span class="dv">2</span>]), <span class="at">pch=</span><span class="dv">19</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p>The result is shown in FigureÂ <span class="math display">\[fig:vv-1\]</span>.</p>
<p><img src="307-BS-VannaVolga_files/figure-html/vv-plot-1-1.png" width="672"  /></p>
</div>
<div id="pricing-a-binary-option" class="section level3" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> Pricing a Binary Option</h3>
<p>Consider a one-year binary call, struck at the money. Assume that the
smile is quadratic. Again, we assume a null interest rate for
simplicity.</p>
<p>This time, we use the traditional benchmark instruments of the FX
market: straddle, risk-reversal and butterfly, and compute the price of
the binary option, adjusted for the smile effect.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="vanna-volga-pricing-and-hedging.html#cb197-1" aria-hidden="true" tabindex="-1"></a>  T <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb197-2"><a href="vanna-volga-pricing-and-hedging.html#cb197-2" aria-hidden="true" tabindex="-1"></a>  Spot <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb197-3"><a href="vanna-volga-pricing-and-hedging.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb197-4"><a href="vanna-volga-pricing-and-hedging.html#cb197-4" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb197-5"><a href="vanna-volga-pricing-and-hedging.html#cb197-5" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> r<span class="sc">-</span>d</span>
<span id="cb197-6"><a href="vanna-volga-pricing-and-hedging.html#cb197-6" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> <span class="dv">30</span><span class="sc">/</span><span class="dv">100</span></span>
<span id="cb197-7"><a href="vanna-volga-pricing-and-hedging.html#cb197-7" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fl">110.50</span></span>
<span id="cb197-8"><a href="vanna-volga-pricing-and-hedging.html#cb197-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-9"><a href="vanna-volga-pricing-and-hedging.html#cb197-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># smile function</span></span>
<span id="cb197-10"><a href="vanna-volga-pricing-and-hedging.html#cb197-10" aria-hidden="true" tabindex="-1"></a>  smile <span class="ot">&lt;-</span> <span class="cf">function</span>(X) (<span class="sc">-</span>(<span class="dv">0</span><span class="sc">/</span><span class="dv">20</span>)<span class="sc">*</span>(X<span class="sc">-</span>Spot) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">300</span>)<span class="sc">*</span>(X<span class="sc">-</span>Spot)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">100</span></span></code></pre></div>
<p>The strikes corresponding to a <span class="math inline">\(25\Delta\)</span> call and put are computed by
inverting the formulae for the Delta of European options. Recall that
for a call, the Delta is given by:</p>
<p><span class="math display">\[\Delta = e^{-dT} N(d_1)\]</span></p>
<p>The strike corresponding to a <span class="math inline">\(25\Delta\)</span> call is therefore:</p>
<p><span class="math display">\[K_{25\Delta} = S e^{- \left( \sigma \sqrt{T} N^{-1}(e^{dT}.25) -(r-d+\frac{\sigma^2}{2})T \right)}\]</span></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="vanna-volga-pricing-and-hedging.html#cb198-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># strikes at +/- 25 deltas</span></span>
<span id="cb198-2"><a href="vanna-volga-pricing-and-hedging.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">qnorm</span>(.<span class="dv">25</span><span class="sc">*</span><span class="fu">exp</span>(d<span class="sc">*</span>T))</span>
<span id="cb198-3"><a href="vanna-volga-pricing-and-hedging.html#cb198-3" aria-hidden="true" tabindex="-1"></a>  Kp <span class="ot">&lt;-</span> Spot<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>alpha <span class="sc">*</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(T)<span class="sc">+</span>(r<span class="sc">-</span>d<span class="sc">+</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>T)</span>
<span id="cb198-4"><a href="vanna-volga-pricing-and-hedging.html#cb198-4" aria-hidden="true" tabindex="-1"></a>  Kc <span class="ot">&lt;-</span> Spot<span class="sc">*</span><span class="fu">exp</span>(alpha <span class="sc">*</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(T)<span class="sc">+</span>(r<span class="sc">-</span>d<span class="sc">+</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>sigma<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>T)</span></code></pre></div>
<p>Define a wrapper function to facilitate calculations on the binary
option:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="vanna-volga-pricing-and-hedging.html#cb199-1" aria-hidden="true" tabindex="-1"></a>  O <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">vol=</span>sigma, <span class="at">spot=</span>Spot) <span class="fu">CashOrNothingOption</span>(<span class="at">TypeFlag=</span><span class="st">&#39;c&#39;</span>, <span class="at">S=</span>spot,</span>
<span id="cb199-2"><a href="vanna-volga-pricing-and-hedging.html#cb199-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">X=</span>X, <span class="at">K=</span><span class="dv">100</span>, <span class="at">Time=</span>T, <span class="at">r=</span>r, <span class="at">b=</span>b, <span class="at">sigma=</span>vol)<span class="sc">@</span>price</span></code></pre></div>
<p>The Black-Scholes value, using ATM volatility is:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="vanna-volga-pricing-and-hedging.html#cb200-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Theoretical BS value</span></span>
<span id="cb200-2"><a href="vanna-volga-pricing-and-hedging.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  TV.BS <span class="ot">&lt;-</span> <span class="fu">O</span>()</span>
<span id="cb200-3"><a href="vanna-volga-pricing-and-hedging.html#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&#39;BS value:&#39;</span>, <span class="fu">round</span>(TV.BS,<span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;BS value: 31.46&quot;</code></pre>
<p>For comparison, we can approximate the binary option with a call spread,
giving a value of:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="vanna-volga-pricing-and-hedging.html#cb202-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replication value with call spread</span></span>
<span id="cb202-2"><a href="vanna-volga-pricing-and-hedging.html#cb202-2" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb202-3"><a href="vanna-volga-pricing-and-hedging.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  TV.CS <span class="ot">&lt;-</span> N<span class="sc">*</span>(<span class="fu">GBSOption</span>(<span class="st">&#39;c&#39;</span>, Spot, X<span class="dv">-100</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>N), T, r, b, sigma<span class="sc">+</span><span class="fu">smile</span>(X<span class="dv">-100</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>N)))<span class="sc">@</span>price <span class="sc">-</span></span>
<span id="cb202-4"><a href="vanna-volga-pricing-and-hedging.html#cb202-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">GBSOption</span>(<span class="st">&#39;c&#39;</span>, Spot, X<span class="sc">+</span><span class="dv">100</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>N), T, r, b, sigma<span class="sc">+</span><span class="fu">smile</span>(X<span class="sc">+</span><span class="dv">100</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>N)))<span class="sc">@</span>price)</span>
<span id="cb202-5"><a href="vanna-volga-pricing-and-hedging.html#cb202-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-6"><a href="vanna-volga-pricing-and-hedging.html#cb202-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&#39;Value, approximated by a call spread:&#39;</span>, <span class="fu">round</span>(TV.BS,<span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;Value, approximated by a call spread: 31.46&quot;</code></pre>
<p>We next define the benchmark instruments:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="vanna-volga-pricing-and-hedging.html#cb204-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Put</span></span>
<span id="cb204-2"><a href="vanna-volga-pricing-and-hedging.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  P <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">vol=</span>sigma, <span class="at">spot=</span>Spot) <span class="fu">GBSOption</span>(<span class="at">TypeFlag=</span><span class="st">&#39;p&#39;</span>, <span class="at">S=</span>spot, <span class="at">X=</span>Kp,</span>
<span id="cb204-3"><a href="vanna-volga-pricing-and-hedging.html#cb204-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Time=</span>T, <span class="at">r=</span>r, <span class="at">b=</span>b, <span class="at">sigma=</span>vol)<span class="sc">@</span>price</span>
<span id="cb204-4"><a href="vanna-volga-pricing-and-hedging.html#cb204-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-5"><a href="vanna-volga-pricing-and-hedging.html#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Call</span></span>
<span id="cb204-6"><a href="vanna-volga-pricing-and-hedging.html#cb204-6" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">vol=</span>sigma, <span class="at">spot=</span>Spot) <span class="fu">GBSOption</span>(<span class="at">TypeFlag=</span><span class="st">&#39;c&#39;</span>, <span class="at">S=</span>spot, <span class="at">X=</span>Kc,</span>
<span id="cb204-7"><a href="vanna-volga-pricing-and-hedging.html#cb204-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Time=</span>T, <span class="at">r=</span>r, <span class="at">b=</span>b, <span class="at">sigma=</span>vol)<span class="sc">@</span>price</span>
<span id="cb204-8"><a href="vanna-volga-pricing-and-hedging.html#cb204-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-9"><a href="vanna-volga-pricing-and-hedging.html#cb204-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Straddle</span></span>
<span id="cb204-10"><a href="vanna-volga-pricing-and-hedging.html#cb204-10" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">vol=</span>sigma, <span class="at">spot=</span>Spot) {</span>
<span id="cb204-11"><a href="vanna-volga-pricing-and-hedging.html#cb204-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">GBSOption</span>(<span class="at">TypeFlag=</span><span class="st">&#39;c&#39;</span>, <span class="at">S=</span>spot, <span class="at">X=</span>Spot, <span class="at">Time=</span>T, <span class="at">r=</span>r, <span class="at">b=</span>b, <span class="at">sigma=</span>vol)<span class="sc">@</span>price <span class="sc">+</span></span>
<span id="cb204-12"><a href="vanna-volga-pricing-and-hedging.html#cb204-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">GBSOption</span>(<span class="at">TypeFlag=</span><span class="st">&#39;p&#39;</span>, <span class="at">S=</span>spot, <span class="at">X=</span>Spot, <span class="at">Time=</span>T, <span class="at">r=</span>r, <span class="at">b=</span>b, <span class="at">sigma=</span>vol)<span class="sc">@</span>price</span>
<span id="cb204-13"><a href="vanna-volga-pricing-and-hedging.html#cb204-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb204-14"><a href="vanna-volga-pricing-and-hedging.html#cb204-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-15"><a href="vanna-volga-pricing-and-hedging.html#cb204-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Risk Reversal</span></span>
<span id="cb204-16"><a href="vanna-volga-pricing-and-hedging.html#cb204-16" aria-hidden="true" tabindex="-1"></a>  RR <span class="ot">&lt;-</span> <span class="cf">function</span>(vol, <span class="at">spot=</span>Spot) {</span>
<span id="cb204-17"><a href="vanna-volga-pricing-and-hedging.html#cb204-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">P</span>(vol, spot)<span class="sc">-</span><span class="fu">C</span>(vol, spot)</span>
<span id="cb204-18"><a href="vanna-volga-pricing-and-hedging.html#cb204-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb204-19"><a href="vanna-volga-pricing-and-hedging.html#cb204-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-20"><a href="vanna-volga-pricing-and-hedging.html#cb204-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Butterfly</span></span>
<span id="cb204-21"><a href="vanna-volga-pricing-and-hedging.html#cb204-21" aria-hidden="true" tabindex="-1"></a>  BF <span class="ot">&lt;-</span> <span class="cf">function</span>(vol, <span class="at">spot=</span>Spot, <span class="at">beta=</span><span class="dv">1</span>) {</span>
<span id="cb204-22"><a href="vanna-volga-pricing-and-hedging.html#cb204-22" aria-hidden="true" tabindex="-1"></a>    beta<span class="sc">*</span>(<span class="fu">P</span>(vol, spot)<span class="sc">+</span><span class="fu">C</span>(vol, spot))<span class="sc">-</span><span class="fu">S</span>(vol,spot)</span>
<span id="cb204-23"><a href="vanna-volga-pricing-and-hedging.html#cb204-23" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>The butterfly must be vega-neutral. This is obtained by solving for
<span class="math inline">\(\beta\)</span>:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="vanna-volga-pricing-and-hedging.html#cb205-1" aria-hidden="true" tabindex="-1"></a>  BF.V <span class="ot">&lt;-</span> <span class="cf">function</span>(vol, beta) {</span>
<span id="cb205-2"><a href="vanna-volga-pricing-and-hedging.html#cb205-2" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">BF</span>(vol<span class="sc">+</span>eps, <span class="at">beta=</span>beta)<span class="sc">-</span><span class="fu">BF</span>(vol<span class="sc">-</span>eps, <span class="at">beta=</span>beta))<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>eps)</span>
<span id="cb205-3"><a href="vanna-volga-pricing-and-hedging.html#cb205-3" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb205-4"><a href="vanna-volga-pricing-and-hedging.html#cb205-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-5"><a href="vanna-volga-pricing-and-hedging.html#cb205-5" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="cf">function</span>(b) <span class="fu">BF.V</span>(sigma, b), <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>))<span class="sc">$</span>root</span></code></pre></div>
<p>Next, we compute the risk indicators for the binary option:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="vanna-volga-pricing-and-hedging.html#cb206-1" aria-hidden="true" tabindex="-1"></a>  O.vega <span class="ot">&lt;-</span> <span class="fu">Vega</span>(O, sigma)</span>
<span id="cb206-2"><a href="vanna-volga-pricing-and-hedging.html#cb206-2" aria-hidden="true" tabindex="-1"></a>  O.vanna <span class="ot">&lt;-</span> <span class="fu">Vanna</span>(O, sigma)</span>
<span id="cb206-3"><a href="vanna-volga-pricing-and-hedging.html#cb206-3" aria-hidden="true" tabindex="-1"></a>  O.volga <span class="ot">&lt;-</span> <span class="fu">Volga</span>(O, sigma)</span></code></pre></div>
<p>and for the benchmark instruments:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="vanna-volga-pricing-and-hedging.html#cb207-1" aria-hidden="true" tabindex="-1"></a>  S.vega <span class="ot">&lt;-</span> <span class="fu">Vega</span>(S, sigma)</span>
<span id="cb207-2"><a href="vanna-volga-pricing-and-hedging.html#cb207-2" aria-hidden="true" tabindex="-1"></a>  S.vanna <span class="ot">&lt;-</span> <span class="fu">Vanna</span>(S, sigma)</span>
<span id="cb207-3"><a href="vanna-volga-pricing-and-hedging.html#cb207-3" aria-hidden="true" tabindex="-1"></a>  S.volga <span class="ot">&lt;-</span> <span class="fu">Volga</span>(S, sigma)</span>
<span id="cb207-4"><a href="vanna-volga-pricing-and-hedging.html#cb207-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-5"><a href="vanna-volga-pricing-and-hedging.html#cb207-5" aria-hidden="true" tabindex="-1"></a>  RR.vega <span class="ot">&lt;-</span> <span class="fu">Vega</span>(RR, sigma)</span>
<span id="cb207-6"><a href="vanna-volga-pricing-and-hedging.html#cb207-6" aria-hidden="true" tabindex="-1"></a>  RR.vanna <span class="ot">&lt;-</span> <span class="fu">Vanna</span>(RR, sigma)</span>
<span id="cb207-7"><a href="vanna-volga-pricing-and-hedging.html#cb207-7" aria-hidden="true" tabindex="-1"></a>  RR.volga <span class="ot">&lt;-</span> <span class="fu">Volga</span>(RR, sigma)</span>
<span id="cb207-8"><a href="vanna-volga-pricing-and-hedging.html#cb207-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-9"><a href="vanna-volga-pricing-and-hedging.html#cb207-9" aria-hidden="true" tabindex="-1"></a>  BF.vega <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb207-10"><a href="vanna-volga-pricing-and-hedging.html#cb207-10" aria-hidden="true" tabindex="-1"></a>  BF.vanna <span class="ot">&lt;-</span> <span class="fu">Vanna</span>(BF, sigma)</span>
<span id="cb207-11"><a href="vanna-volga-pricing-and-hedging.html#cb207-11" aria-hidden="true" tabindex="-1"></a>  BF.volga <span class="ot">&lt;-</span> <span class="fu">Volga</span>(BF, sigma)</span></code></pre></div>
<p>By definition the smile cost of the straddle is zero, since it is priced
with ATM volatility. For the other two benchmark instruments, the smile
cost is the difference between the price with the smile effect and the
price at the ATM volatility:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="vanna-volga-pricing-and-hedging.html#cb208-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># RR and BF cost</span></span>
<span id="cb208-2"><a href="vanna-volga-pricing-and-hedging.html#cb208-2" aria-hidden="true" tabindex="-1"></a>  RR.cost <span class="ot">&lt;-</span> (<span class="fu">P</span>(sigma<span class="sc">+</span><span class="fu">smile</span>(Kp))<span class="sc">-</span><span class="fu">C</span>(sigma<span class="sc">+</span><span class="fu">smile</span>(Kc)))<span class="sc">-</span>(<span class="fu">P</span>(sigma)<span class="sc">-</span><span class="fu">C</span>(sigma))</span>
<span id="cb208-3"><a href="vanna-volga-pricing-and-hedging.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  BF.cost <span class="ot">&lt;-</span> beta<span class="sc">*</span>(<span class="fu">P</span>(sigma<span class="sc">+</span><span class="fu">smile</span>(Kp))<span class="sc">+</span><span class="fu">C</span>(sigma<span class="sc">+</span><span class="fu">smile</span>(Kc)))<span class="sc">-</span> beta<span class="sc">*</span>(<span class="fu">P</span>(sigma)<span class="sc">+</span><span class="fu">C</span>(sigma))</span></code></pre></div>
<p>We can now compute the price correction for the binary option. First the
approximate method, ignoring the off-diagonal terms in matrix <span class="math inline">\(A\)</span>:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="vanna-volga-pricing-and-hedging.html#cb209-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># approximate method</span></span>
<span id="cb209-2"><a href="vanna-volga-pricing-and-hedging.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  CA <span class="ot">&lt;-</span> RR.cost <span class="sc">*</span> (O.vanna<span class="sc">/</span>RR.vanna) <span class="sc">+</span> BF.cost<span class="sc">*</span>(O.volga<span class="sc">/</span>BF.volga)</span></code></pre></div>
<p>then the more accurate method, solving the <span class="math inline">\(3\times3\)</span> linear system:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="vanna-volga-pricing-and-hedging.html#cb210-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># full calculation</span></span>
<span id="cb210-2"><a href="vanna-volga-pricing-and-hedging.html#cb210-2" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(S.vega, S.vanna, S.volga,</span>
<span id="cb210-3"><a href="vanna-volga-pricing-and-hedging.html#cb210-3" aria-hidden="true" tabindex="-1"></a>                RR.vega, RR.vanna, RR.volga,</span>
<span id="cb210-4"><a href="vanna-volga-pricing-and-hedging.html#cb210-4" aria-hidden="true" tabindex="-1"></a>                BF.vega, BF.vanna, BF.volga), <span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb210-5"><a href="vanna-volga-pricing-and-hedging.html#cb210-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-6"><a href="vanna-volga-pricing-and-hedging.html#cb210-6" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(O.vega, O.vanna, O.volga), <span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb210-7"><a href="vanna-volga-pricing-and-hedging.html#cb210-7" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">&lt;-</span> <span class="fu">solve</span>(A, x)</span>
<span id="cb210-8"><a href="vanna-volga-pricing-and-hedging.html#cb210-8" aria-hidden="true" tabindex="-1"></a>  CF <span class="ot">&lt;-</span> <span class="fu">t</span>(w) <span class="sc">%*%</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, RR.cost, BF.cost), <span class="at">nrow=</span><span class="dv">3</span>)</span></code></pre></div>
<p>In summary, we get:</p>
<ul>
<li><p>Black-Scholes price: <span class="math inline">\(31.46\)</span></p></li>
<li><p>With approximate Vanna-Volga correction:
<span class="math inline">\(31.46 + -4.95 = 26.51\)</span></p></li>
<li><p>With acurate Vanna-Volga correction:
<span class="math inline">\(31.46 + -3.5 = 27.96\)</span></p></li>
<li><p>the approximation by a call spread is: <span class="math inline">\(28.79\)</span></p></li>
</ul>
<p>It is worth noting that a naive calculation, where one would plug the
ATM volatility plus smile into the binary option pricing model would
yield a very inaccurate result:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="vanna-volga-pricing-and-hedging.html#cb211-1" aria-hidden="true" tabindex="-1"></a>  P.smile <span class="ot">&lt;-</span> <span class="fu">O</span>(<span class="at">vol=</span>sigma<span class="sc">+</span><span class="fu">smile</span>(X))</span></code></pre></div>
<p>which yields a value of <span class="math inline">\(31.54\)</span>. FigureÂ <span class="math display">\[fig:vv-6\]</span>
compares the values of binary options for a range of strikes, computed
with four methods. :</p>
<p><img src="307-BS-VannaVolga_files/figure-html/unnamed-chunk-19-1.png" width="672"  /></p>

</div>
</div>
</div>
<p style="text-align: center;">
<a href="the-implied-volatility.html"><button class="btn btn-default">Previous</button></a>
<a href="bibliography.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
